{"ast":null,"code":"var tape = require('tape');\n\nvar through = require('through2');\n\nvar pumpify = require('./');\n\nvar stream = require('stream');\n\nvar duplexify = require('duplexify');\n\ntape('basic', function (t) {\n  t.plan(3);\n  var pipeline = pumpify(through(function (data, enc, cb) {\n    t.same(data.toString(), 'hello');\n    cb(null, data.toString().toUpperCase());\n  }), through(function (data, enc, cb) {\n    t.same(data.toString(), 'HELLO');\n    cb(null, data.toString().toLowerCase());\n  }));\n  pipeline.write('hello');\n  pipeline.on('data', function (data) {\n    t.same(data.toString(), 'hello');\n    t.end();\n  });\n});\ntape('3 times', function (t) {\n  t.plan(4);\n  var pipeline = pumpify(through(function (data, enc, cb) {\n    t.same(data.toString(), 'hello');\n    cb(null, data.toString().toUpperCase());\n  }), through(function (data, enc, cb) {\n    t.same(data.toString(), 'HELLO');\n    cb(null, data.toString().toLowerCase());\n  }), through(function (data, enc, cb) {\n    t.same(data.toString(), 'hello');\n    cb(null, data.toString().toUpperCase());\n  }));\n  pipeline.write('hello');\n  pipeline.on('data', function (data) {\n    t.same(data.toString(), 'HELLO');\n    t.end();\n  });\n});\ntape('destroy', function (t) {\n  var test = through();\n\n  test.destroy = function () {\n    t.ok(true);\n    t.end();\n  };\n\n  var pipeline = pumpify(through(), test);\n  pipeline.destroy();\n});\ntape('close', function (t) {\n  var test = through();\n  var pipeline = pumpify(through(), test);\n  pipeline.on('error', function (err) {\n    t.same(err.message, 'lol');\n    t.end();\n  });\n  test.emit('error', new Error('lol'));\n});\ntape('end waits for last one', function (t) {\n  var ran = false;\n  var a = through();\n  var b = through();\n  var c = through(function (data, enc, cb) {\n    setTimeout(function () {\n      ran = true;\n      cb();\n    }, 100);\n  });\n  var pipeline = pumpify(a, b, c);\n  pipeline.write('foo');\n  pipeline.end(function () {\n    t.ok(ran);\n    t.end();\n  });\n  t.ok(!ran);\n});\ntape('always wait for finish', function (t) {\n  var a = new stream.Readable();\n\n  a._read = function () {};\n\n  a.push('hello');\n  var pipeline = pumpify(a, through(), through());\n  var ran = false;\n  pipeline.on('finish', function () {\n    t.ok(ran);\n    t.end();\n  });\n  setTimeout(function () {\n    ran = true;\n    a.push(null);\n  }, 100);\n});\ntape('async', function (t) {\n  var pipeline = pumpify();\n  t.plan(4);\n  pipeline.write('hello');\n  pipeline.on('data', function (data) {\n    t.same(data.toString(), 'HELLO');\n    t.end();\n  });\n  setTimeout(function () {\n    pipeline.setPipeline(through(function (data, enc, cb) {\n      t.same(data.toString(), 'hello');\n      cb(null, data.toString().toUpperCase());\n    }), through(function (data, enc, cb) {\n      t.same(data.toString(), 'HELLO');\n      cb(null, data.toString().toLowerCase());\n    }), through(function (data, enc, cb) {\n      t.same(data.toString(), 'hello');\n      cb(null, data.toString().toUpperCase());\n    }));\n  }, 100);\n});\ntape('early destroy', function (t) {\n  var a = through();\n  var b = through();\n  var c = through();\n\n  b.destroy = function () {\n    t.ok(true);\n    t.end();\n  };\n\n  var pipeline = pumpify();\n  pipeline.destroy();\n  setTimeout(function () {\n    pipeline.setPipeline(a, b, c);\n  }, 100);\n});\ntape('preserves error', function (t) {\n  var a = through();\n  var b = through(function (data, enc, cb) {\n    cb(new Error('stop'));\n  });\n  var c = through();\n  var s = pumpify();\n  s.on('error', function (err) {\n    t.same(err.message, 'stop');\n    t.end();\n  });\n  s.setPipeline(a, b, c);\n  s.resume();\n  s.write('hi');\n});\ntape('preserves error again', function (t) {\n  var ws = new stream.Writable();\n  var rs = new stream.Readable({\n    highWaterMark: 16\n  });\n\n  ws._write = function (data, enc, cb) {\n    cb(null);\n  };\n\n  rs._read = function () {\n    process.nextTick(function () {\n      rs.push('hello world');\n    });\n  };\n\n  var pumpifyErr = pumpify(through(), through(function (chunk, _, cb) {\n    cb(new Error('test'));\n  }), ws);\n  rs.pipe(pumpifyErr).on('error', function (err) {\n    t.ok(err);\n    t.ok(err.message !== 'premature close', 'does not close with premature close');\n    t.end();\n  });\n});\ntape('returns error from duplexify', function (t) {\n  var a = through();\n  var b = duplexify();\n  var s = pumpify();\n  s.setPipeline(a, b);\n  s.on('error', function (err) {\n    t.same(err.message, 'stop');\n    t.end();\n  });\n  s.write('data'); // Test passes if `.end()` is not called\n\n  s.end();\n  b.setWritable(through());\n  setImmediate(function () {\n    b.destroy(new Error('stop'));\n  });\n});","map":{"version":3,"sources":["/Users/nguyenquytoan/Desktop/PTUDW-17TN-Nhom05-USFL/react-usfl/PTUDW-17TN-Nhom05/node_modules/pumpify/test.js"],"names":["tape","require","through","pumpify","stream","duplexify","t","plan","pipeline","data","enc","cb","same","toString","toUpperCase","toLowerCase","write","on","end","test","destroy","ok","err","message","emit","Error","ran","a","b","c","setTimeout","Readable","_read","push","setPipeline","s","resume","ws","Writable","rs","highWaterMark","_write","process","nextTick","pumpifyErr","chunk","_","pipe","setWritable","setImmediate"],"mappings":"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","sourcesContent":["var tape = require('tape')\nvar through = require('through2')\nvar pumpify = require('./')\nvar stream = require('stream')\nvar duplexify = require('duplexify')\n\ntape('basic', function(t) {\n  t.plan(3)\n\n  var pipeline = pumpify(\n    through(function(data, enc, cb) {\n      t.same(data.toString(), 'hello')\n      cb(null, data.toString().toUpperCase())\n    }),\n    through(function(data, enc, cb) {\n      t.same(data.toString(), 'HELLO')\n      cb(null, data.toString().toLowerCase())\n    })\n  )\n\n  pipeline.write('hello')\n  pipeline.on('data', function(data) {\n    t.same(data.toString(), 'hello')\n    t.end()\n  })\n})\n\ntape('3 times', function(t) {\n  t.plan(4)\n\n  var pipeline = pumpify(\n    through(function(data, enc, cb) {\n      t.same(data.toString(), 'hello')\n      cb(null, data.toString().toUpperCase())\n    }),\n    through(function(data, enc, cb) {\n      t.same(data.toString(), 'HELLO')\n      cb(null, data.toString().toLowerCase())\n    }),\n    through(function(data, enc, cb) {\n      t.same(data.toString(), 'hello')\n      cb(null, data.toString().toUpperCase())\n    })\n  )\n\n  pipeline.write('hello')\n  pipeline.on('data', function(data) {\n    t.same(data.toString(), 'HELLO')\n    t.end()\n  })\n})\n\ntape('destroy', function(t) {\n  var test = through()\n  test.destroy = function() {\n    t.ok(true)\n    t.end()\n  }\n\n  var pipeline = pumpify(through(), test)\n\n  pipeline.destroy()\n})\n\ntape('close', function(t) {\n  var test = through()\n  var pipeline = pumpify(through(), test)\n\n  pipeline.on('error', function(err) {\n    t.same(err.message, 'lol')\n    t.end()\n  })\n\n  test.emit('error', new Error('lol'))\n})\n\ntape('end waits for last one', function(t) {\n  var ran = false\n\n  var a = through()\n  var b = through()\n  var c = through(function(data, enc, cb) {\n    setTimeout(function() {\n      ran = true\n      cb()\n    }, 100)\n  })\n\n  var pipeline = pumpify(a, b, c)\n\n  pipeline.write('foo')\n  pipeline.end(function() {\n    t.ok(ran)\n    t.end()\n  })\n\n  t.ok(!ran)\n})\n\ntape('always wait for finish', function(t) {\n  var a = new stream.Readable()\n  a._read = function() {}\n  a.push('hello')\n\n  var pipeline = pumpify(a, through(), through())\n  var ran = false\n\n  pipeline.on('finish', function() {\n    t.ok(ran)\n    t.end()\n  })\n\n  setTimeout(function() {\n    ran = true\n    a.push(null)\n  }, 100)\n})\n\ntape('async', function(t) {\n  var pipeline = pumpify()\n\n  t.plan(4)\n\n  pipeline.write('hello')\n  pipeline.on('data', function(data) {\n    t.same(data.toString(), 'HELLO')\n    t.end()\n  })\n\n  setTimeout(function() {\n    pipeline.setPipeline(\n      through(function(data, enc, cb) {\n        t.same(data.toString(), 'hello')\n        cb(null, data.toString().toUpperCase())\n      }),\n      through(function(data, enc, cb) {\n        t.same(data.toString(), 'HELLO')\n        cb(null, data.toString().toLowerCase())\n      }),\n      through(function(data, enc, cb) {\n        t.same(data.toString(), 'hello')\n        cb(null, data.toString().toUpperCase())\n      })\n    )\n  }, 100)\n})\n\ntape('early destroy', function(t) {\n  var a = through()\n  var b = through()\n  var c = through()\n\n  b.destroy = function() {\n    t.ok(true)\n    t.end()\n  }\n\n  var pipeline = pumpify()\n\n  pipeline.destroy()\n  setTimeout(function() {\n    pipeline.setPipeline(a, b, c)\n  }, 100)\n})\n\ntape('preserves error', function (t) {\n  var a = through()\n  var b = through(function (data, enc, cb) {\n    cb(new Error('stop'))\n  })\n  var c = through()\n  var s = pumpify()\n\n  s.on('error', function (err) {\n    t.same(err.message, 'stop')\n    t.end()\n  })\n\n  s.setPipeline(a, b, c)\n  s.resume()\n  s.write('hi')\n})\n\ntape('preserves error again', function (t) {\n  var ws = new stream.Writable()\n  var rs = new stream.Readable({highWaterMark: 16})\n\n  ws._write = function (data, enc, cb) {\n    cb(null)\n  }\n\n  rs._read = function () {\n    process.nextTick(function () {\n      rs.push('hello world')\n    })\n  }\n\n  var pumpifyErr = pumpify(\n    through(),\n    through(function(chunk, _, cb) {\n      cb(new Error('test'))\n    }),\n    ws\n  )\n\n  rs.pipe(pumpifyErr)\n    .on('error', function (err) {\n      t.ok(err)\n      t.ok(err.message !== 'premature close', 'does not close with premature close')\n      t.end()\n    })\n})\n\ntape('returns error from duplexify', function (t) {\n  var a = through()\n  var b = duplexify()\n  var s = pumpify()\n\n  s.setPipeline(a, b)\n\n  s.on('error', function (err) {\n    t.same(err.message, 'stop')\n    t.end()\n  })\n\n  s.write('data')\n  // Test passes if `.end()` is not called\n  s.end()\n\n  b.setWritable(through())\n\n  setImmediate(function () {\n    b.destroy(new Error('stop'))\n  })\n})\n"]},"metadata":{},"sourceType":"script"}