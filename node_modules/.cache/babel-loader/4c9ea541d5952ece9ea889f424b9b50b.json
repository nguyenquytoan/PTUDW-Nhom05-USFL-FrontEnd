{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar root_1 = require(\"../../util/root\");\n\nvar Observable_1 = require(\"../../Observable\");\n\nvar Subscriber_1 = require(\"../../Subscriber\");\n\nvar map_1 = require(\"../../operators/map\");\n\nfunction getCORSRequest() {\n  if (root_1.root.XMLHttpRequest) {\n    return new root_1.root.XMLHttpRequest();\n  } else if (!!root_1.root.XDomainRequest) {\n    return new root_1.root.XDomainRequest();\n  } else {\n    throw new Error('CORS is not supported by your browser');\n  }\n}\n\nfunction getXMLHttpRequest() {\n  if (root_1.root.XMLHttpRequest) {\n    return new root_1.root.XMLHttpRequest();\n  } else {\n    var progId = void 0;\n\n    try {\n      var progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'];\n\n      for (var i = 0; i < 3; i++) {\n        try {\n          progId = progIds[i];\n\n          if (new root_1.root.ActiveXObject(progId)) {\n            break;\n          }\n        } catch (e) {}\n      }\n\n      return new root_1.root.ActiveXObject(progId);\n    } catch (e) {\n      throw new Error('XMLHttpRequest is not supported by your browser');\n    }\n  }\n}\n\nfunction ajaxGet(url, headers) {\n  if (headers === void 0) {\n    headers = null;\n  }\n\n  return new AjaxObservable({\n    method: 'GET',\n    url: url,\n    headers: headers\n  });\n}\n\nexports.ajaxGet = ajaxGet;\n\nfunction ajaxPost(url, body, headers) {\n  return new AjaxObservable({\n    method: 'POST',\n    url: url,\n    body: body,\n    headers: headers\n  });\n}\n\nexports.ajaxPost = ajaxPost;\n\nfunction ajaxDelete(url, headers) {\n  return new AjaxObservable({\n    method: 'DELETE',\n    url: url,\n    headers: headers\n  });\n}\n\nexports.ajaxDelete = ajaxDelete;\n\nfunction ajaxPut(url, body, headers) {\n  return new AjaxObservable({\n    method: 'PUT',\n    url: url,\n    body: body,\n    headers: headers\n  });\n}\n\nexports.ajaxPut = ajaxPut;\n\nfunction ajaxPatch(url, body, headers) {\n  return new AjaxObservable({\n    method: 'PATCH',\n    url: url,\n    body: body,\n    headers: headers\n  });\n}\n\nexports.ajaxPatch = ajaxPatch;\nvar mapResponse = map_1.map(function (x, index) {\n  return x.response;\n});\n\nfunction ajaxGetJSON(url, headers) {\n  return mapResponse(new AjaxObservable({\n    method: 'GET',\n    url: url,\n    responseType: 'json',\n    headers: headers\n  }));\n}\n\nexports.ajaxGetJSON = ajaxGetJSON;\n\nvar AjaxObservable = function (_super) {\n  __extends(AjaxObservable, _super);\n\n  function AjaxObservable(urlOrRequest) {\n    var _this = _super.call(this) || this;\n\n    var request = {\n      async: true,\n      createXHR: function () {\n        return this.crossDomain ? getCORSRequest() : getXMLHttpRequest();\n      },\n      crossDomain: true,\n      withCredentials: false,\n      headers: {},\n      method: 'GET',\n      responseType: 'json',\n      timeout: 0\n    };\n\n    if (typeof urlOrRequest === 'string') {\n      request.url = urlOrRequest;\n    } else {\n      for (var prop in urlOrRequest) {\n        if (urlOrRequest.hasOwnProperty(prop)) {\n          request[prop] = urlOrRequest[prop];\n        }\n      }\n    }\n\n    _this.request = request;\n    return _this;\n  }\n\n  AjaxObservable.prototype._subscribe = function (subscriber) {\n    return new AjaxSubscriber(subscriber, this.request);\n  };\n\n  AjaxObservable.create = function () {\n    var create = function (urlOrRequest) {\n      return new AjaxObservable(urlOrRequest);\n    };\n\n    create.get = ajaxGet;\n    create.post = ajaxPost;\n    create.delete = ajaxDelete;\n    create.put = ajaxPut;\n    create.patch = ajaxPatch;\n    create.getJSON = ajaxGetJSON;\n    return create;\n  }();\n\n  return AjaxObservable;\n}(Observable_1.Observable);\n\nexports.AjaxObservable = AjaxObservable;\n\nvar AjaxSubscriber = function (_super) {\n  __extends(AjaxSubscriber, _super);\n\n  function AjaxSubscriber(destination, request) {\n    var _this = _super.call(this, destination) || this;\n\n    _this.request = request;\n    _this.done = false;\n    var headers = request.headers = request.headers || {};\n\n    if (!request.crossDomain && !_this.getHeader(headers, 'X-Requested-With')) {\n      headers['X-Requested-With'] = 'XMLHttpRequest';\n    }\n\n    var contentTypeHeader = _this.getHeader(headers, 'Content-Type');\n\n    if (!contentTypeHeader && !(root_1.root.FormData && request.body instanceof root_1.root.FormData) && typeof request.body !== 'undefined') {\n      headers['Content-Type'] = 'application/x-www-form-urlencoded; charset=UTF-8';\n    }\n\n    request.body = _this.serializeBody(request.body, _this.getHeader(request.headers, 'Content-Type'));\n\n    _this.send();\n\n    return _this;\n  }\n\n  AjaxSubscriber.prototype.next = function (e) {\n    this.done = true;\n\n    var _a = this,\n        xhr = _a.xhr,\n        request = _a.request,\n        destination = _a.destination;\n\n    var result;\n\n    try {\n      result = new AjaxResponse(e, xhr, request);\n    } catch (err) {\n      return destination.error(err);\n    }\n\n    destination.next(result);\n  };\n\n  AjaxSubscriber.prototype.send = function () {\n    var _a = this,\n        request = _a.request,\n        _b = _a.request,\n        user = _b.user,\n        method = _b.method,\n        url = _b.url,\n        async = _b.async,\n        password = _b.password,\n        headers = _b.headers,\n        body = _b.body;\n\n    try {\n      var xhr = this.xhr = request.createXHR();\n      this.setupEvents(xhr, request);\n\n      if (user) {\n        xhr.open(method, url, async, user, password);\n      } else {\n        xhr.open(method, url, async);\n      }\n\n      if (async) {\n        xhr.timeout = request.timeout;\n        xhr.responseType = request.responseType;\n      }\n\n      if ('withCredentials' in xhr) {\n        xhr.withCredentials = !!request.withCredentials;\n      }\n\n      this.setHeaders(xhr, headers);\n\n      if (body) {\n        xhr.send(body);\n      } else {\n        xhr.send();\n      }\n    } catch (err) {\n      this.error(err);\n    }\n  };\n\n  AjaxSubscriber.prototype.serializeBody = function (body, contentType) {\n    if (!body || typeof body === 'string') {\n      return body;\n    } else if (root_1.root.FormData && body instanceof root_1.root.FormData) {\n      return body;\n    }\n\n    if (contentType) {\n      var splitIndex = contentType.indexOf(';');\n\n      if (splitIndex !== -1) {\n        contentType = contentType.substring(0, splitIndex);\n      }\n    }\n\n    switch (contentType) {\n      case 'application/x-www-form-urlencoded':\n        return Object.keys(body).map(function (key) {\n          return encodeURIComponent(key) + \"=\" + encodeURIComponent(body[key]);\n        }).join('&');\n\n      case 'application/json':\n        return JSON.stringify(body);\n\n      default:\n        return body;\n    }\n  };\n\n  AjaxSubscriber.prototype.setHeaders = function (xhr, headers) {\n    for (var key in headers) {\n      if (headers.hasOwnProperty(key)) {\n        xhr.setRequestHeader(key, headers[key]);\n      }\n    }\n  };\n\n  AjaxSubscriber.prototype.getHeader = function (headers, headerName) {\n    for (var key in headers) {\n      if (key.toLowerCase() === headerName.toLowerCase()) {\n        return headers[key];\n      }\n    }\n\n    return undefined;\n  };\n\n  AjaxSubscriber.prototype.setupEvents = function (xhr, request) {\n    var progressSubscriber = request.progressSubscriber;\n\n    function xhrTimeout(e) {\n      var _a = xhrTimeout,\n          subscriber = _a.subscriber,\n          progressSubscriber = _a.progressSubscriber,\n          request = _a.request;\n\n      if (progressSubscriber) {\n        progressSubscriber.error(e);\n      }\n\n      var error;\n\n      try {\n        error = new exports.AjaxTimeoutError(this, request);\n      } catch (err) {\n        error = err;\n      }\n\n      subscriber.error(error);\n    }\n\n    xhr.ontimeout = xhrTimeout;\n    xhrTimeout.request = request;\n    xhrTimeout.subscriber = this;\n    xhrTimeout.progressSubscriber = progressSubscriber;\n\n    if (xhr.upload && 'withCredentials' in xhr) {\n      if (progressSubscriber) {\n        var xhrProgress_1;\n\n        xhrProgress_1 = function (e) {\n          var progressSubscriber = xhrProgress_1.progressSubscriber;\n          progressSubscriber.next(e);\n        };\n\n        if (root_1.root.XDomainRequest) {\n          xhr.onprogress = xhrProgress_1;\n        } else {\n          xhr.upload.onprogress = xhrProgress_1;\n        }\n\n        xhrProgress_1.progressSubscriber = progressSubscriber;\n      }\n\n      var xhrError_1;\n\n      xhrError_1 = function (e) {\n        var _a = xhrError_1,\n            progressSubscriber = _a.progressSubscriber,\n            subscriber = _a.subscriber,\n            request = _a.request;\n\n        if (progressSubscriber) {\n          progressSubscriber.error(e);\n        }\n\n        var error;\n\n        try {\n          error = new exports.AjaxError('ajax error', this, request);\n        } catch (err) {\n          error = err;\n        }\n\n        subscriber.error(error);\n      };\n\n      xhr.onerror = xhrError_1;\n      xhrError_1.request = request;\n      xhrError_1.subscriber = this;\n      xhrError_1.progressSubscriber = progressSubscriber;\n    }\n\n    function xhrReadyStateChange(e) {\n      return;\n    }\n\n    xhr.onreadystatechange = xhrReadyStateChange;\n    xhrReadyStateChange.subscriber = this;\n    xhrReadyStateChange.progressSubscriber = progressSubscriber;\n    xhrReadyStateChange.request = request;\n\n    function xhrLoad(e) {\n      var _a = xhrLoad,\n          subscriber = _a.subscriber,\n          progressSubscriber = _a.progressSubscriber,\n          request = _a.request;\n\n      if (this.readyState === 4) {\n        var status_1 = this.status === 1223 ? 204 : this.status;\n        var response = this.responseType === 'text' ? this.response || this.responseText : this.response;\n\n        if (status_1 === 0) {\n          status_1 = response ? 200 : 0;\n        }\n\n        if (status_1 < 400) {\n          if (progressSubscriber) {\n            progressSubscriber.complete();\n          }\n\n          subscriber.next(e);\n          subscriber.complete();\n        } else {\n          if (progressSubscriber) {\n            progressSubscriber.error(e);\n          }\n\n          var error = void 0;\n\n          try {\n            error = new exports.AjaxError('ajax error ' + status_1, this, request);\n          } catch (err) {\n            error = err;\n          }\n\n          subscriber.error(error);\n        }\n      }\n    }\n\n    xhr.onload = xhrLoad;\n    xhrLoad.subscriber = this;\n    xhrLoad.progressSubscriber = progressSubscriber;\n    xhrLoad.request = request;\n  };\n\n  AjaxSubscriber.prototype.unsubscribe = function () {\n    var _a = this,\n        done = _a.done,\n        xhr = _a.xhr;\n\n    if (!done && xhr && xhr.readyState !== 4 && typeof xhr.abort === 'function') {\n      xhr.abort();\n    }\n\n    _super.prototype.unsubscribe.call(this);\n  };\n\n  return AjaxSubscriber;\n}(Subscriber_1.Subscriber);\n\nexports.AjaxSubscriber = AjaxSubscriber;\n\nvar AjaxResponse = function () {\n  function AjaxResponse(originalEvent, xhr, request) {\n    this.originalEvent = originalEvent;\n    this.xhr = xhr;\n    this.request = request;\n    this.status = xhr.status;\n    this.responseType = xhr.responseType || request.responseType;\n    this.response = parseXhrResponse(this.responseType, xhr);\n  }\n\n  return AjaxResponse;\n}();\n\nexports.AjaxResponse = AjaxResponse;\n\nvar AjaxErrorImpl = function () {\n  function AjaxErrorImpl(message, xhr, request) {\n    Error.call(this);\n    this.message = message;\n    this.name = 'AjaxError';\n    this.xhr = xhr;\n    this.request = request;\n    this.status = xhr.status;\n    this.responseType = xhr.responseType || request.responseType;\n    this.response = parseXhrResponse(this.responseType, xhr);\n    return this;\n  }\n\n  AjaxErrorImpl.prototype = Object.create(Error.prototype);\n  return AjaxErrorImpl;\n}();\n\nexports.AjaxError = AjaxErrorImpl;\n\nfunction parseJson(xhr) {\n  if ('response' in xhr) {\n    return xhr.responseType ? xhr.response : JSON.parse(xhr.response || xhr.responseText || 'null');\n  } else {\n    return JSON.parse(xhr.responseText || 'null');\n  }\n}\n\nfunction parseXhrResponse(responseType, xhr) {\n  switch (responseType) {\n    case 'json':\n      return parseJson(xhr);\n\n    case 'xml':\n      return xhr.responseXML;\n\n    case 'text':\n    default:\n      return 'response' in xhr ? xhr.response : xhr.responseText;\n  }\n}\n\nfunction AjaxTimeoutErrorImpl(xhr, request) {\n  exports.AjaxError.call(this, 'ajax timeout', xhr, request);\n  this.name = 'AjaxTimeoutError';\n  return this;\n}\n\nexports.AjaxTimeoutError = AjaxTimeoutErrorImpl;","map":{"version":3,"sources":["../../../src/internal/observable/dom/AjaxObservable.ts"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar root_1 = require(\"../../util/root\");\nvar Observable_1 = require(\"../../Observable\");\nvar Subscriber_1 = require(\"../../Subscriber\");\nvar map_1 = require(\"../../operators/map\");\nfunction getCORSRequest() {\n    if (root_1.root.XMLHttpRequest) {\n        return new root_1.root.XMLHttpRequest();\n    }\n    else if (!!root_1.root.XDomainRequest) {\n        return new root_1.root.XDomainRequest();\n    }\n    else {\n        throw new Error('CORS is not supported by your browser');\n    }\n}\nfunction getXMLHttpRequest() {\n    if (root_1.root.XMLHttpRequest) {\n        return new root_1.root.XMLHttpRequest();\n    }\n    else {\n        var progId = void 0;\n        try {\n            var progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'];\n            for (var i = 0; i < 3; i++) {\n                try {\n                    progId = progIds[i];\n                    if (new root_1.root.ActiveXObject(progId)) {\n                        break;\n                    }\n                }\n                catch (e) {\n                }\n            }\n            return new root_1.root.ActiveXObject(progId);\n        }\n        catch (e) {\n            throw new Error('XMLHttpRequest is not supported by your browser');\n        }\n    }\n}\nfunction ajaxGet(url, headers) {\n    if (headers === void 0) { headers = null; }\n    return new AjaxObservable({ method: 'GET', url: url, headers: headers });\n}\nexports.ajaxGet = ajaxGet;\nfunction ajaxPost(url, body, headers) {\n    return new AjaxObservable({ method: 'POST', url: url, body: body, headers: headers });\n}\nexports.ajaxPost = ajaxPost;\nfunction ajaxDelete(url, headers) {\n    return new AjaxObservable({ method: 'DELETE', url: url, headers: headers });\n}\nexports.ajaxDelete = ajaxDelete;\nfunction ajaxPut(url, body, headers) {\n    return new AjaxObservable({ method: 'PUT', url: url, body: body, headers: headers });\n}\nexports.ajaxPut = ajaxPut;\nfunction ajaxPatch(url, body, headers) {\n    return new AjaxObservable({ method: 'PATCH', url: url, body: body, headers: headers });\n}\nexports.ajaxPatch = ajaxPatch;\nvar mapResponse = map_1.map(function (x, index) { return x.response; });\nfunction ajaxGetJSON(url, headers) {\n    return mapResponse(new AjaxObservable({\n        method: 'GET',\n        url: url,\n        responseType: 'json',\n        headers: headers\n    }));\n}\nexports.ajaxGetJSON = ajaxGetJSON;\nvar AjaxObservable = (function (_super) {\n    __extends(AjaxObservable, _super);\n    function AjaxObservable(urlOrRequest) {\n        var _this = _super.call(this) || this;\n        var request = {\n            async: true,\n            createXHR: function () {\n                return this.crossDomain ? getCORSRequest() : getXMLHttpRequest();\n            },\n            crossDomain: true,\n            withCredentials: false,\n            headers: {},\n            method: 'GET',\n            responseType: 'json',\n            timeout: 0\n        };\n        if (typeof urlOrRequest === 'string') {\n            request.url = urlOrRequest;\n        }\n        else {\n            for (var prop in urlOrRequest) {\n                if (urlOrRequest.hasOwnProperty(prop)) {\n                    request[prop] = urlOrRequest[prop];\n                }\n            }\n        }\n        _this.request = request;\n        return _this;\n    }\n    AjaxObservable.prototype._subscribe = function (subscriber) {\n        return new AjaxSubscriber(subscriber, this.request);\n    };\n    AjaxObservable.create = (function () {\n        var create = function (urlOrRequest) {\n            return new AjaxObservable(urlOrRequest);\n        };\n        create.get = ajaxGet;\n        create.post = ajaxPost;\n        create.delete = ajaxDelete;\n        create.put = ajaxPut;\n        create.patch = ajaxPatch;\n        create.getJSON = ajaxGetJSON;\n        return create;\n    })();\n    return AjaxObservable;\n}(Observable_1.Observable));\nexports.AjaxObservable = AjaxObservable;\nvar AjaxSubscriber = (function (_super) {\n    __extends(AjaxSubscriber, _super);\n    function AjaxSubscriber(destination, request) {\n        var _this = _super.call(this, destination) || this;\n        _this.request = request;\n        _this.done = false;\n        var headers = request.headers = request.headers || {};\n        if (!request.crossDomain && !_this.getHeader(headers, 'X-Requested-With')) {\n            headers['X-Requested-With'] = 'XMLHttpRequest';\n        }\n        var contentTypeHeader = _this.getHeader(headers, 'Content-Type');\n        if (!contentTypeHeader && !(root_1.root.FormData && request.body instanceof root_1.root.FormData) && typeof request.body !== 'undefined') {\n            headers['Content-Type'] = 'application/x-www-form-urlencoded; charset=UTF-8';\n        }\n        request.body = _this.serializeBody(request.body, _this.getHeader(request.headers, 'Content-Type'));\n        _this.send();\n        return _this;\n    }\n    AjaxSubscriber.prototype.next = function (e) {\n        this.done = true;\n        var _a = this, xhr = _a.xhr, request = _a.request, destination = _a.destination;\n        var result;\n        try {\n            result = new AjaxResponse(e, xhr, request);\n        }\n        catch (err) {\n            return destination.error(err);\n        }\n        destination.next(result);\n    };\n    AjaxSubscriber.prototype.send = function () {\n        var _a = this, request = _a.request, _b = _a.request, user = _b.user, method = _b.method, url = _b.url, async = _b.async, password = _b.password, headers = _b.headers, body = _b.body;\n        try {\n            var xhr = this.xhr = request.createXHR();\n            this.setupEvents(xhr, request);\n            if (user) {\n                xhr.open(method, url, async, user, password);\n            }\n            else {\n                xhr.open(method, url, async);\n            }\n            if (async) {\n                xhr.timeout = request.timeout;\n                xhr.responseType = request.responseType;\n            }\n            if ('withCredentials' in xhr) {\n                xhr.withCredentials = !!request.withCredentials;\n            }\n            this.setHeaders(xhr, headers);\n            if (body) {\n                xhr.send(body);\n            }\n            else {\n                xhr.send();\n            }\n        }\n        catch (err) {\n            this.error(err);\n        }\n    };\n    AjaxSubscriber.prototype.serializeBody = function (body, contentType) {\n        if (!body || typeof body === 'string') {\n            return body;\n        }\n        else if (root_1.root.FormData && body instanceof root_1.root.FormData) {\n            return body;\n        }\n        if (contentType) {\n            var splitIndex = contentType.indexOf(';');\n            if (splitIndex !== -1) {\n                contentType = contentType.substring(0, splitIndex);\n            }\n        }\n        switch (contentType) {\n            case 'application/x-www-form-urlencoded':\n                return Object.keys(body).map(function (key) { return encodeURIComponent(key) + \"=\" + encodeURIComponent(body[key]); }).join('&');\n            case 'application/json':\n                return JSON.stringify(body);\n            default:\n                return body;\n        }\n    };\n    AjaxSubscriber.prototype.setHeaders = function (xhr, headers) {\n        for (var key in headers) {\n            if (headers.hasOwnProperty(key)) {\n                xhr.setRequestHeader(key, headers[key]);\n            }\n        }\n    };\n    AjaxSubscriber.prototype.getHeader = function (headers, headerName) {\n        for (var key in headers) {\n            if (key.toLowerCase() === headerName.toLowerCase()) {\n                return headers[key];\n            }\n        }\n        return undefined;\n    };\n    AjaxSubscriber.prototype.setupEvents = function (xhr, request) {\n        var progressSubscriber = request.progressSubscriber;\n        function xhrTimeout(e) {\n            var _a = xhrTimeout, subscriber = _a.subscriber, progressSubscriber = _a.progressSubscriber, request = _a.request;\n            if (progressSubscriber) {\n                progressSubscriber.error(e);\n            }\n            var error;\n            try {\n                error = new exports.AjaxTimeoutError(this, request);\n            }\n            catch (err) {\n                error = err;\n            }\n            subscriber.error(error);\n        }\n        xhr.ontimeout = xhrTimeout;\n        xhrTimeout.request = request;\n        xhrTimeout.subscriber = this;\n        xhrTimeout.progressSubscriber = progressSubscriber;\n        if (xhr.upload && 'withCredentials' in xhr) {\n            if (progressSubscriber) {\n                var xhrProgress_1;\n                xhrProgress_1 = function (e) {\n                    var progressSubscriber = xhrProgress_1.progressSubscriber;\n                    progressSubscriber.next(e);\n                };\n                if (root_1.root.XDomainRequest) {\n                    xhr.onprogress = xhrProgress_1;\n                }\n                else {\n                    xhr.upload.onprogress = xhrProgress_1;\n                }\n                xhrProgress_1.progressSubscriber = progressSubscriber;\n            }\n            var xhrError_1;\n            xhrError_1 = function (e) {\n                var _a = xhrError_1, progressSubscriber = _a.progressSubscriber, subscriber = _a.subscriber, request = _a.request;\n                if (progressSubscriber) {\n                    progressSubscriber.error(e);\n                }\n                var error;\n                try {\n                    error = new exports.AjaxError('ajax error', this, request);\n                }\n                catch (err) {\n                    error = err;\n                }\n                subscriber.error(error);\n            };\n            xhr.onerror = xhrError_1;\n            xhrError_1.request = request;\n            xhrError_1.subscriber = this;\n            xhrError_1.progressSubscriber = progressSubscriber;\n        }\n        function xhrReadyStateChange(e) {\n            return;\n        }\n        xhr.onreadystatechange = xhrReadyStateChange;\n        xhrReadyStateChange.subscriber = this;\n        xhrReadyStateChange.progressSubscriber = progressSubscriber;\n        xhrReadyStateChange.request = request;\n        function xhrLoad(e) {\n            var _a = xhrLoad, subscriber = _a.subscriber, progressSubscriber = _a.progressSubscriber, request = _a.request;\n            if (this.readyState === 4) {\n                var status_1 = this.status === 1223 ? 204 : this.status;\n                var response = (this.responseType === 'text' ? (this.response || this.responseText) : this.response);\n                if (status_1 === 0) {\n                    status_1 = response ? 200 : 0;\n                }\n                if (status_1 < 400) {\n                    if (progressSubscriber) {\n                        progressSubscriber.complete();\n                    }\n                    subscriber.next(e);\n                    subscriber.complete();\n                }\n                else {\n                    if (progressSubscriber) {\n                        progressSubscriber.error(e);\n                    }\n                    var error = void 0;\n                    try {\n                        error = new exports.AjaxError('ajax error ' + status_1, this, request);\n                    }\n                    catch (err) {\n                        error = err;\n                    }\n                    subscriber.error(error);\n                }\n            }\n        }\n        xhr.onload = xhrLoad;\n        xhrLoad.subscriber = this;\n        xhrLoad.progressSubscriber = progressSubscriber;\n        xhrLoad.request = request;\n    };\n    AjaxSubscriber.prototype.unsubscribe = function () {\n        var _a = this, done = _a.done, xhr = _a.xhr;\n        if (!done && xhr && xhr.readyState !== 4 && typeof xhr.abort === 'function') {\n            xhr.abort();\n        }\n        _super.prototype.unsubscribe.call(this);\n    };\n    return AjaxSubscriber;\n}(Subscriber_1.Subscriber));\nexports.AjaxSubscriber = AjaxSubscriber;\nvar AjaxResponse = (function () {\n    function AjaxResponse(originalEvent, xhr, request) {\n        this.originalEvent = originalEvent;\n        this.xhr = xhr;\n        this.request = request;\n        this.status = xhr.status;\n        this.responseType = xhr.responseType || request.responseType;\n        this.response = parseXhrResponse(this.responseType, xhr);\n    }\n    return AjaxResponse;\n}());\nexports.AjaxResponse = AjaxResponse;\nvar AjaxErrorImpl = (function () {\n    function AjaxErrorImpl(message, xhr, request) {\n        Error.call(this);\n        this.message = message;\n        this.name = 'AjaxError';\n        this.xhr = xhr;\n        this.request = request;\n        this.status = xhr.status;\n        this.responseType = xhr.responseType || request.responseType;\n        this.response = parseXhrResponse(this.responseType, xhr);\n        return this;\n    }\n    AjaxErrorImpl.prototype = Object.create(Error.prototype);\n    return AjaxErrorImpl;\n})();\nexports.AjaxError = AjaxErrorImpl;\nfunction parseJson(xhr) {\n    if ('response' in xhr) {\n        return xhr.responseType ? xhr.response : JSON.parse(xhr.response || xhr.responseText || 'null');\n    }\n    else {\n        return JSON.parse(xhr.responseText || 'null');\n    }\n}\nfunction parseXhrResponse(responseType, xhr) {\n    switch (responseType) {\n        case 'json':\n            return parseJson(xhr);\n        case 'xml':\n            return xhr.responseXML;\n        case 'text':\n        default:\n            return ('response' in xhr) ? xhr.response : xhr.responseText;\n    }\n}\nfunction AjaxTimeoutErrorImpl(xhr, request) {\n    exports.AjaxError.call(this, 'ajax timeout', xhr, request);\n    this.name = 'AjaxTimeoutError';\n    return this;\n}\nexports.AjaxTimeoutError = AjaxTimeoutErrorImpl;\n//# sourceMappingURL=AjaxObservable.js.map"]},"metadata":{},"sourceType":"script"}