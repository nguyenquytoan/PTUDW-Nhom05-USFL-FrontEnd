{"ast":null,"code":"'use strict';\n\nconst Module = require('module');\n\nconst crypto = require('crypto');\n\nconst fs = require('fs');\n\nconst path = require('path');\n\nconst vm = require('vm');\n\nconst os = require('os');\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty; //------------------------------------------------------------------------------\n// FileSystemBlobStore\n//------------------------------------------------------------------------------\n\nclass FileSystemBlobStore {\n  constructor(directory, prefix) {\n    const name = prefix ? slashEscape(prefix + '.') : '';\n    this._blobFilename = path.join(directory, name + 'BLOB');\n    this._mapFilename = path.join(directory, name + 'MAP');\n    this._lockFilename = path.join(directory, name + 'LOCK');\n    this._directory = directory;\n\n    this._load();\n  }\n\n  has(key, invalidationKey) {\n    if (hasOwnProperty.call(this._memoryBlobs, key)) {\n      return this._invalidationKeys[key] === invalidationKey;\n    } else if (hasOwnProperty.call(this._storedMap, key)) {\n      return this._storedMap[key][0] === invalidationKey;\n    }\n\n    return false;\n  }\n\n  get(key, invalidationKey) {\n    if (hasOwnProperty.call(this._memoryBlobs, key)) {\n      if (this._invalidationKeys[key] === invalidationKey) {\n        return this._memoryBlobs[key];\n      }\n    } else if (hasOwnProperty.call(this._storedMap, key)) {\n      const mapping = this._storedMap[key];\n\n      if (mapping[0] === invalidationKey) {\n        return this._storedBlob.slice(mapping[1], mapping[2]);\n      }\n    }\n  }\n\n  set(key, invalidationKey, buffer) {\n    this._invalidationKeys[key] = invalidationKey;\n    this._memoryBlobs[key] = buffer;\n    this._dirty = true;\n  }\n\n  delete(key) {\n    if (hasOwnProperty.call(this._memoryBlobs, key)) {\n      this._dirty = true;\n      delete this._memoryBlobs[key];\n    }\n\n    if (hasOwnProperty.call(this._invalidationKeys, key)) {\n      this._dirty = true;\n      delete this._invalidationKeys[key];\n    }\n\n    if (hasOwnProperty.call(this._storedMap, key)) {\n      this._dirty = true;\n      delete this._storedMap[key];\n    }\n  }\n\n  isDirty() {\n    return this._dirty;\n  }\n\n  save() {\n    const dump = this._getDump();\n\n    const blobToStore = Buffer.concat(dump[0]);\n    const mapToStore = JSON.stringify(dump[1]);\n\n    try {\n      mkdirpSync(this._directory);\n      fs.writeFileSync(this._lockFilename, 'LOCK', {\n        flag: 'wx'\n      });\n    } catch (error) {\n      // Swallow the exception if we fail to acquire the lock.\n      return false;\n    }\n\n    try {\n      fs.writeFileSync(this._blobFilename, blobToStore);\n      fs.writeFileSync(this._mapFilename, mapToStore);\n    } catch (error) {\n      throw error;\n    } finally {\n      fs.unlinkSync(this._lockFilename);\n    }\n\n    return true;\n  }\n\n  _load() {\n    try {\n      this._storedBlob = fs.readFileSync(this._blobFilename);\n      this._storedMap = JSON.parse(fs.readFileSync(this._mapFilename));\n    } catch (e) {\n      this._storedBlob = Buffer.alloc(0);\n      this._storedMap = {};\n    }\n\n    this._dirty = false;\n    this._memoryBlobs = {};\n    this._invalidationKeys = {};\n  }\n\n  _getDump() {\n    const buffers = [];\n    const newMap = {};\n    let offset = 0;\n\n    function push(key, invalidationKey, buffer) {\n      buffers.push(buffer);\n      newMap[key] = [invalidationKey, offset, offset + buffer.length];\n      offset += buffer.length;\n    }\n\n    for (const key of Object.keys(this._memoryBlobs)) {\n      const buffer = this._memoryBlobs[key];\n      const invalidationKey = this._invalidationKeys[key];\n      push(key, invalidationKey, buffer);\n    }\n\n    for (const key of Object.keys(this._storedMap)) {\n      if (hasOwnProperty.call(newMap, key)) continue;\n      const mapping = this._storedMap[key];\n\n      const buffer = this._storedBlob.slice(mapping[1], mapping[2]);\n\n      push(key, mapping[0], buffer);\n    }\n\n    return [buffers, newMap];\n  }\n\n} //------------------------------------------------------------------------------\n// NativeCompileCache\n//------------------------------------------------------------------------------\n\n\nclass NativeCompileCache {\n  constructor() {\n    this._cacheStore = null;\n    this._previousModuleCompile = null;\n  }\n\n  setCacheStore(cacheStore) {\n    this._cacheStore = cacheStore;\n  }\n\n  install() {\n    const self = this;\n    const hasRequireResolvePaths = typeof require.resolve.paths === 'function';\n    this._previousModuleCompile = Module.prototype._compile;\n\n    Module.prototype._compile = function (content, filename) {\n      const mod = this;\n\n      function require(id) {\n        return mod.require(id);\n      } // https://github.com/nodejs/node/blob/v10.15.3/lib/internal/modules/cjs/helpers.js#L28\n\n\n      function resolve(request, options) {\n        return Module._resolveFilename(request, mod, false, options);\n      }\n\n      require.resolve = resolve; // https://github.com/nodejs/node/blob/v10.15.3/lib/internal/modules/cjs/helpers.js#L37\n      // resolve.resolve.paths was added in v8.9.0\n\n      if (hasRequireResolvePaths) {\n        resolve.paths = function paths(request) {\n          return Module._resolveLookupPaths(request, mod, true);\n        };\n      }\n\n      require.main = process.mainModule; // Enable support to add extra extension types\n\n      require.extensions = Module._extensions;\n      require.cache = Module._cache;\n      const dirname = path.dirname(filename);\n\n      const compiledWrapper = self._moduleCompile(filename, content); // We skip the debugger setup because by the time we run, node has already\n      // done that itself.\n      // `Buffer` is included for Electron.\n      // See https://github.com/zertosh/v8-compile-cache/pull/10#issuecomment-518042543\n\n\n      const args = [mod.exports, require, mod, filename, dirname, process, global, Buffer];\n      return compiledWrapper.apply(mod.exports, args);\n    };\n  }\n\n  uninstall() {\n    Module.prototype._compile = this._previousModuleCompile;\n  }\n\n  _moduleCompile(filename, content) {\n    // https://github.com/nodejs/node/blob/v7.5.0/lib/module.js#L511\n    // Remove shebang\n    var contLen = content.length;\n\n    if (contLen >= 2) {\n      if (content.charCodeAt(0) === 35\n      /*#*/\n      && content.charCodeAt(1) === 33\n      /*!*/\n      ) {\n          if (contLen === 2) {\n            // Exact match\n            content = '';\n          } else {\n            // Find end of shebang line and slice it off\n            var i = 2;\n\n            for (; i < contLen; ++i) {\n              var code = content.charCodeAt(i);\n              if (code === 10\n              /*\\n*/\n              || code === 13\n              /*\\r*/\n              ) break;\n            }\n\n            if (i === contLen) {\n              content = '';\n            } else {\n              // Note that this actually includes the newline character(s) in the\n              // new output. This duplicates the behavior of the regular\n              // expression that was previously used to replace the shebang line\n              content = content.slice(i);\n            }\n          }\n        }\n    } // create wrapper function\n\n\n    var wrapper = Module.wrap(content);\n    var invalidationKey = crypto.createHash('sha1').update(content, 'utf8').digest('hex');\n\n    var buffer = this._cacheStore.get(filename, invalidationKey);\n\n    var script = new vm.Script(wrapper, {\n      filename: filename,\n      lineOffset: 0,\n      displayErrors: true,\n      cachedData: buffer,\n      produceCachedData: true\n    });\n\n    if (script.cachedDataProduced) {\n      this._cacheStore.set(filename, invalidationKey, script.cachedData);\n    } else if (script.cachedDataRejected) {\n      this._cacheStore.delete(filename);\n    }\n\n    var compiledWrapper = script.runInThisContext({\n      filename: filename,\n      lineOffset: 0,\n      columnOffset: 0,\n      displayErrors: true\n    });\n    return compiledWrapper;\n  }\n\n} //------------------------------------------------------------------------------\n// utilities\n//\n// https://github.com/substack/node-mkdirp/blob/f2003bb/index.js#L55-L98\n// https://github.com/zertosh/slash-escape/blob/e7ebb99/slash-escape.js\n//------------------------------------------------------------------------------\n\n\nfunction mkdirpSync(p_) {\n  _mkdirpSync(path.resolve(p_), 0o777);\n}\n\nfunction _mkdirpSync(p, mode) {\n  try {\n    fs.mkdirSync(p, mode);\n  } catch (err0) {\n    if (err0.code === 'ENOENT') {\n      _mkdirpSync(path.dirname(p));\n\n      _mkdirpSync(p);\n    } else {\n      try {\n        const stat = fs.statSync(p);\n\n        if (!stat.isDirectory()) {\n          throw err0;\n        }\n      } catch (err1) {\n        throw err0;\n      }\n    }\n  }\n}\n\nfunction slashEscape(str) {\n  const ESCAPE_LOOKUP = {\n    '\\\\': 'zB',\n    ':': 'zC',\n    '/': 'zS',\n    '\\x00': 'z0',\n    'z': 'zZ'\n  };\n  return str.replace(/[\\\\:\\/\\x00z]/g, match => ESCAPE_LOOKUP[match]);\n}\n\nfunction supportsCachedData() {\n  const script = new vm.Script('\"\"', {\n    produceCachedData: true\n  }); // chakracore, as of v1.7.1.0, returns `false`.\n\n  return script.cachedDataProduced === true;\n}\n\nfunction getCacheDir() {\n  // Avoid cache ownership issues on POSIX systems.\n  const dirname = typeof process.getuid === 'function' ? 'v8-compile-cache-' + process.getuid() : 'v8-compile-cache';\n  const version = typeof process.versions.v8 === 'string' ? process.versions.v8 : typeof process.versions.chakracore === 'string' ? 'chakracore-' + process.versions.chakracore : 'node-' + process.version;\n  const cacheDir = path.join(os.tmpdir(), dirname, version);\n  return cacheDir;\n}\n\nfunction getParentName() {\n  // `module.parent.filename` is undefined or null when:\n  //    * node -e 'require(\"v8-compile-cache\")'\n  //    * node -r 'v8-compile-cache'\n  //    * Or, requiring from the REPL.\n  const parentName = module.parent && typeof module.parent.filename === 'string' ? module.parent.filename : process.cwd();\n  return parentName;\n} //------------------------------------------------------------------------------\n// main\n//------------------------------------------------------------------------------\n\n\nif (!process.env.DISABLE_V8_COMPILE_CACHE && supportsCachedData()) {\n  const cacheDir = getCacheDir();\n  const prefix = getParentName();\n  const blobStore = new FileSystemBlobStore(cacheDir, prefix);\n  const nativeCompileCache = new NativeCompileCache();\n  nativeCompileCache.setCacheStore(blobStore);\n  nativeCompileCache.install();\n  process.once('exit', code => {\n    if (blobStore.isDirty()) {\n      blobStore.save();\n    }\n\n    nativeCompileCache.uninstall();\n  });\n}\n\nmodule.exports.__TEST__ = {\n  FileSystemBlobStore,\n  NativeCompileCache,\n  mkdirpSync,\n  slashEscape,\n  supportsCachedData,\n  getCacheDir,\n  getParentName\n};","map":{"version":3,"sources":["/Users/nguyenquytoan/Desktop/PTUDW-17TN-Nhom05-USFL/react-usfl/PTUDW-17TN-Nhom05/node_modules/v8-compile-cache/v8-compile-cache.js"],"names":["Module","require","crypto","fs","path","vm","os","hasOwnProperty","Object","prototype","FileSystemBlobStore","constructor","directory","prefix","name","slashEscape","_blobFilename","join","_mapFilename","_lockFilename","_directory","_load","has","key","invalidationKey","call","_memoryBlobs","_invalidationKeys","_storedMap","get","mapping","_storedBlob","slice","set","buffer","_dirty","delete","isDirty","save","dump","_getDump","blobToStore","Buffer","concat","mapToStore","JSON","stringify","mkdirpSync","writeFileSync","flag","error","unlinkSync","readFileSync","parse","e","alloc","buffers","newMap","offset","push","length","keys","NativeCompileCache","_cacheStore","_previousModuleCompile","setCacheStore","cacheStore","install","self","hasRequireResolvePaths","resolve","paths","_compile","content","filename","mod","id","request","options","_resolveFilename","_resolveLookupPaths","main","process","mainModule","extensions","_extensions","cache","_cache","dirname","compiledWrapper","_moduleCompile","args","exports","global","apply","uninstall","contLen","charCodeAt","i","code","wrapper","wrap","createHash","update","digest","script","Script","lineOffset","displayErrors","cachedData","produceCachedData","cachedDataProduced","cachedDataRejected","runInThisContext","columnOffset","p_","_mkdirpSync","p","mode","mkdirSync","err0","stat","statSync","isDirectory","err1","str","ESCAPE_LOOKUP","replace","match","supportsCachedData","getCacheDir","getuid","version","versions","v8","chakracore","cacheDir","tmpdir","getParentName","parentName","module","parent","cwd","env","DISABLE_V8_COMPILE_CACHE","blobStore","nativeCompileCache","once","__TEST__"],"mappings":"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","sourcesContent":["'use strict';\n\nconst Module = require('module');\nconst crypto = require('crypto');\nconst fs = require('fs');\nconst path = require('path');\nconst vm = require('vm');\nconst os = require('os');\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\n\n//------------------------------------------------------------------------------\n// FileSystemBlobStore\n//------------------------------------------------------------------------------\n\nclass FileSystemBlobStore {\n  constructor(directory, prefix) {\n    const name = prefix ? slashEscape(prefix + '.') : '';\n    this._blobFilename = path.join(directory, name + 'BLOB');\n    this._mapFilename = path.join(directory, name + 'MAP');\n    this._lockFilename = path.join(directory, name + 'LOCK');\n    this._directory = directory;\n    this._load();\n  }\n\n  has(key, invalidationKey) {\n    if (hasOwnProperty.call(this._memoryBlobs, key)) {\n      return this._invalidationKeys[key] === invalidationKey;\n    } else if (hasOwnProperty.call(this._storedMap, key)) {\n      return this._storedMap[key][0] === invalidationKey;\n    }\n    return false;\n  }\n\n  get(key, invalidationKey) {\n    if (hasOwnProperty.call(this._memoryBlobs, key)) {\n      if (this._invalidationKeys[key] === invalidationKey) {\n        return this._memoryBlobs[key];\n      }\n    } else if (hasOwnProperty.call(this._storedMap, key)) {\n      const mapping = this._storedMap[key];\n      if (mapping[0] === invalidationKey) {\n        return this._storedBlob.slice(mapping[1], mapping[2]);\n      }\n    }\n  }\n\n  set(key, invalidationKey, buffer) {\n    this._invalidationKeys[key] = invalidationKey;\n    this._memoryBlobs[key] = buffer;\n    this._dirty = true;\n  }\n\n  delete(key) {\n    if (hasOwnProperty.call(this._memoryBlobs, key)) {\n      this._dirty = true;\n      delete this._memoryBlobs[key];\n    }\n    if (hasOwnProperty.call(this._invalidationKeys, key)) {\n      this._dirty = true;\n      delete this._invalidationKeys[key];\n    }\n    if (hasOwnProperty.call(this._storedMap, key)) {\n      this._dirty = true;\n      delete this._storedMap[key];\n    }\n  }\n\n  isDirty() {\n    return this._dirty;\n  }\n\n  save() {\n    const dump = this._getDump();\n    const blobToStore = Buffer.concat(dump[0]);\n    const mapToStore = JSON.stringify(dump[1]);\n\n    try {\n      mkdirpSync(this._directory);\n      fs.writeFileSync(this._lockFilename, 'LOCK', {flag: 'wx'});\n    } catch (error) {\n      // Swallow the exception if we fail to acquire the lock.\n      return false;\n    }\n\n    try {\n      fs.writeFileSync(this._blobFilename, blobToStore);\n      fs.writeFileSync(this._mapFilename, mapToStore);\n    } catch (error) {\n      throw error;\n    } finally {\n      fs.unlinkSync(this._lockFilename);\n    }\n\n    return true;\n  }\n\n  _load() {\n    try {\n      this._storedBlob = fs.readFileSync(this._blobFilename);\n      this._storedMap = JSON.parse(fs.readFileSync(this._mapFilename));\n    } catch (e) {\n      this._storedBlob = Buffer.alloc(0);\n      this._storedMap = {};\n    }\n    this._dirty = false;\n    this._memoryBlobs = {};\n    this._invalidationKeys = {};\n  }\n\n  _getDump() {\n    const buffers = [];\n    const newMap = {};\n    let offset = 0;\n\n    function push(key, invalidationKey, buffer) {\n      buffers.push(buffer);\n      newMap[key] = [invalidationKey, offset, offset + buffer.length];\n      offset += buffer.length;\n    }\n\n    for (const key of Object.keys(this._memoryBlobs)) {\n      const buffer = this._memoryBlobs[key];\n      const invalidationKey = this._invalidationKeys[key];\n      push(key, invalidationKey, buffer);\n    }\n\n    for (const key of Object.keys(this._storedMap)) {\n      if (hasOwnProperty.call(newMap, key)) continue;\n      const mapping = this._storedMap[key];\n      const buffer = this._storedBlob.slice(mapping[1], mapping[2]);\n      push(key, mapping[0], buffer);\n    }\n\n    return [buffers, newMap];\n  }\n}\n\n//------------------------------------------------------------------------------\n// NativeCompileCache\n//------------------------------------------------------------------------------\n\nclass NativeCompileCache {\n  constructor() {\n    this._cacheStore = null;\n    this._previousModuleCompile = null;\n  }\n\n  setCacheStore(cacheStore) {\n    this._cacheStore = cacheStore;\n  }\n\n  install() {\n    const self = this;\n    const hasRequireResolvePaths = typeof require.resolve.paths === 'function';\n    this._previousModuleCompile = Module.prototype._compile;\n    Module.prototype._compile = function(content, filename) {\n      const mod = this;\n\n      function require(id) {\n        return mod.require(id);\n      }\n\n      // https://github.com/nodejs/node/blob/v10.15.3/lib/internal/modules/cjs/helpers.js#L28\n      function resolve(request, options) {\n        return Module._resolveFilename(request, mod, false, options);\n      }\n      require.resolve = resolve;\n\n      // https://github.com/nodejs/node/blob/v10.15.3/lib/internal/modules/cjs/helpers.js#L37\n      // resolve.resolve.paths was added in v8.9.0\n      if (hasRequireResolvePaths) {\n        resolve.paths = function paths(request) {\n          return Module._resolveLookupPaths(request, mod, true);\n        };\n      }\n\n      require.main = process.mainModule;\n\n      // Enable support to add extra extension types\n      require.extensions = Module._extensions;\n      require.cache = Module._cache;\n\n      const dirname = path.dirname(filename);\n\n      const compiledWrapper = self._moduleCompile(filename, content);\n\n      // We skip the debugger setup because by the time we run, node has already\n      // done that itself.\n\n      // `Buffer` is included for Electron.\n      // See https://github.com/zertosh/v8-compile-cache/pull/10#issuecomment-518042543\n      const args = [mod.exports, require, mod, filename, dirname, process, global, Buffer];\n      return compiledWrapper.apply(mod.exports, args);\n    };\n  }\n\n  uninstall() {\n    Module.prototype._compile = this._previousModuleCompile;\n  }\n\n  _moduleCompile(filename, content) {\n    // https://github.com/nodejs/node/blob/v7.5.0/lib/module.js#L511\n\n    // Remove shebang\n    var contLen = content.length;\n    if (contLen >= 2) {\n      if (content.charCodeAt(0) === 35/*#*/ &&\n          content.charCodeAt(1) === 33/*!*/) {\n        if (contLen === 2) {\n          // Exact match\n          content = '';\n        } else {\n          // Find end of shebang line and slice it off\n          var i = 2;\n          for (; i < contLen; ++i) {\n            var code = content.charCodeAt(i);\n            if (code === 10/*\\n*/ || code === 13/*\\r*/) break;\n          }\n          if (i === contLen) {\n            content = '';\n          } else {\n            // Note that this actually includes the newline character(s) in the\n            // new output. This duplicates the behavior of the regular\n            // expression that was previously used to replace the shebang line\n            content = content.slice(i);\n          }\n        }\n      }\n    }\n\n    // create wrapper function\n    var wrapper = Module.wrap(content);\n\n    var invalidationKey = crypto\n      .createHash('sha1')\n      .update(content, 'utf8')\n      .digest('hex');\n\n    var buffer = this._cacheStore.get(filename, invalidationKey);\n\n    var script = new vm.Script(wrapper, {\n      filename: filename,\n      lineOffset: 0,\n      displayErrors: true,\n      cachedData: buffer,\n      produceCachedData: true,\n    });\n\n    if (script.cachedDataProduced) {\n      this._cacheStore.set(filename, invalidationKey, script.cachedData);\n    } else if (script.cachedDataRejected) {\n      this._cacheStore.delete(filename);\n    }\n\n    var compiledWrapper = script.runInThisContext({\n      filename: filename,\n      lineOffset: 0,\n      columnOffset: 0,\n      displayErrors: true,\n    });\n\n    return compiledWrapper;\n  }\n}\n\n//------------------------------------------------------------------------------\n// utilities\n//\n// https://github.com/substack/node-mkdirp/blob/f2003bb/index.js#L55-L98\n// https://github.com/zertosh/slash-escape/blob/e7ebb99/slash-escape.js\n//------------------------------------------------------------------------------\n\nfunction mkdirpSync(p_) {\n  _mkdirpSync(path.resolve(p_), 0o777);\n}\n\nfunction _mkdirpSync(p, mode) {\n  try {\n    fs.mkdirSync(p, mode);\n  } catch (err0) {\n    if (err0.code === 'ENOENT') {\n      _mkdirpSync(path.dirname(p));\n      _mkdirpSync(p);\n    } else {\n      try {\n        const stat = fs.statSync(p);\n        if (!stat.isDirectory()) { throw err0; }\n      } catch (err1) {\n        throw err0;\n      }\n    }\n  }\n}\n\nfunction slashEscape(str) {\n  const ESCAPE_LOOKUP = {\n    '\\\\': 'zB',\n    ':': 'zC',\n    '/': 'zS',\n    '\\x00': 'z0',\n    'z': 'zZ',\n  };\n  return str.replace(/[\\\\:\\/\\x00z]/g, match => (ESCAPE_LOOKUP[match]));\n}\n\nfunction supportsCachedData() {\n  const script = new vm.Script('\"\"', {produceCachedData: true});\n  // chakracore, as of v1.7.1.0, returns `false`.\n  return script.cachedDataProduced === true;\n}\n\nfunction getCacheDir() {\n  // Avoid cache ownership issues on POSIX systems.\n  const dirname = typeof process.getuid === 'function'\n    ? 'v8-compile-cache-' + process.getuid()\n    : 'v8-compile-cache';\n  const version = typeof process.versions.v8 === 'string'\n    ? process.versions.v8\n    : typeof process.versions.chakracore === 'string'\n      ? 'chakracore-' + process.versions.chakracore\n      : 'node-' + process.version;\n  const cacheDir = path.join(os.tmpdir(), dirname, version);\n  return cacheDir;\n}\n\nfunction getParentName() {\n  // `module.parent.filename` is undefined or null when:\n  //    * node -e 'require(\"v8-compile-cache\")'\n  //    * node -r 'v8-compile-cache'\n  //    * Or, requiring from the REPL.\n  const parentName = module.parent && typeof module.parent.filename === 'string'\n    ? module.parent.filename\n    : process.cwd();\n  return parentName;\n}\n\n//------------------------------------------------------------------------------\n// main\n//------------------------------------------------------------------------------\n\nif (!process.env.DISABLE_V8_COMPILE_CACHE && supportsCachedData()) {\n  const cacheDir = getCacheDir();\n  const prefix = getParentName();\n  const blobStore = new FileSystemBlobStore(cacheDir, prefix);\n\n  const nativeCompileCache = new NativeCompileCache();\n  nativeCompileCache.setCacheStore(blobStore);\n  nativeCompileCache.install();\n\n  process.once('exit', code => {\n    if (blobStore.isDirty()) {\n      blobStore.save();\n    }\n    nativeCompileCache.uninstall();\n  });\n}\n\nmodule.exports.__TEST__ = {\n  FileSystemBlobStore,\n  NativeCompileCache,\n  mkdirpSync,\n  slashEscape,\n  supportsCachedData,\n  getCacheDir,\n  getParentName,\n};\n"]},"metadata":{},"sourceType":"script"}