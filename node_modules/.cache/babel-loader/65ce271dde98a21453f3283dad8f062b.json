{"ast":null,"code":"\"use strict\";\n\nconst DOMException = require(\"domexception\");\n\nconst StorageEvent = require(\"../generated/StorageEvent\");\n\nconst idlUtils = require(\"../generated/utils\");\n\nconst {\n  fireAnEvent\n} = require(\"../helpers/events\"); // https://html.spec.whatwg.org/multipage/webstorage.html#the-storage-interface\n\n\nclass StorageImpl {\n  constructor(args, {\n    associatedWindow,\n    storageArea,\n    url,\n    type,\n    storageQuota\n  }) {\n    this._associatedWindow = associatedWindow;\n    this._items = storageArea;\n    this._url = url;\n    this._type = type;\n    this._quota = storageQuota;\n  }\n\n  _dispatchStorageEvent(key, oldValue, newValue) {\n    return this._associatedWindow._currentOriginData.windowsInSameOrigin.filter(target => target !== this._associatedWindow).forEach(target => fireAnEvent(\"storage\", target, StorageEvent, {\n      key,\n      oldValue,\n      newValue,\n      url: this._url,\n      storageArea: target[\"_\" + this._type]\n    }));\n  }\n\n  get length() {\n    return this._items.size;\n  }\n\n  key(n) {\n    if (n >= this._items.size) {\n      return null;\n    }\n\n    return [...this._items.keys()][n];\n  }\n\n  getItem(key) {\n    if (this._items.has(key)) {\n      return this._items.get(key);\n    }\n\n    return null;\n  }\n\n  setItem(key, value) {\n    const oldValue = this._items.get(key) || null;\n\n    if (oldValue === value) {\n      return;\n    } // Concatenate all keys and values to measure their length against the quota\n\n\n    let itemsTotalLength = key.length + value.length;\n\n    for (const [curKey, curValue] of this._items) {\n      // If the key already exists, skip it as it will be set to the new value instead\n      if (key !== curKey) {\n        itemsTotalLength += curKey.length + curValue.length;\n      }\n    }\n\n    if (itemsTotalLength > this._quota) {\n      throw new DOMException(`The ${this._quota}-code unit storage quota has been exceeded.`, \"QuotaExceededError\");\n    }\n\n    setTimeout(this._dispatchStorageEvent.bind(this), 0, key, oldValue, value);\n\n    this._items.set(key, value);\n  }\n\n  removeItem(key) {\n    if (this._items.has(key)) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, key, this._items.get(key), null);\n\n      this._items.delete(key);\n    }\n  }\n\n  clear() {\n    if (this._items.size > 0) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, null, null, null);\n\n      this._items.clear();\n    }\n  }\n\n  get [idlUtils.supportedPropertyNames]() {\n    return this._items.keys();\n  }\n\n}\n\nmodule.exports = {\n  implementation: StorageImpl\n};","map":{"version":3,"sources":["/Users/nguyenquytoan/Desktop/PTUDW-17TN-Nhom05-USFL/react-usfl/PTUDW-17TN-Nhom05/node_modules/jest-environment-jsdom-fourteen/node_modules/jsdom/lib/jsdom/living/webstorage/Storage-impl.js"],"names":["DOMException","require","StorageEvent","idlUtils","fireAnEvent","StorageImpl","constructor","args","associatedWindow","storageArea","url","type","storageQuota","_associatedWindow","_items","_url","_type","_quota","_dispatchStorageEvent","key","oldValue","newValue","_currentOriginData","windowsInSameOrigin","filter","target","forEach","length","size","n","keys","getItem","has","get","setItem","value","itemsTotalLength","curKey","curValue","setTimeout","bind","set","removeItem","delete","clear","supportedPropertyNames","module","exports","implementation"],"mappings":"AAAA;;AAEA,MAAMA,YAAY,GAAGC,OAAO,CAAC,cAAD,CAA5B;;AACA,MAAMC,YAAY,GAAGD,OAAO,CAAC,2BAAD,CAA5B;;AACA,MAAME,QAAQ,GAAGF,OAAO,CAAC,oBAAD,CAAxB;;AACA,MAAM;AAAEG,EAAAA;AAAF,IAAkBH,OAAO,CAAC,mBAAD,CAA/B,C,CAEA;;;AACA,MAAMI,WAAN,CAAkB;AAChBC,EAAAA,WAAW,CAACC,IAAD,EAAO;AAAEC,IAAAA,gBAAF;AAAoBC,IAAAA,WAApB;AAAiCC,IAAAA,GAAjC;AAAsCC,IAAAA,IAAtC;AAA4CC,IAAAA;AAA5C,GAAP,EAAmE;AAC5E,SAAKC,iBAAL,GAAyBL,gBAAzB;AACA,SAAKM,MAAL,GAAcL,WAAd;AACA,SAAKM,IAAL,GAAYL,GAAZ;AACA,SAAKM,KAAL,GAAaL,IAAb;AACA,SAAKM,MAAL,GAAcL,YAAd;AACD;;AAEDM,EAAAA,qBAAqB,CAACC,GAAD,EAAMC,QAAN,EAAgBC,QAAhB,EAA0B;AAC7C,WAAO,KAAKR,iBAAL,CAAuBS,kBAAvB,CAA0CC,mBAA1C,CACJC,MADI,CACGC,MAAM,IAAIA,MAAM,KAAK,KAAKZ,iBAD7B,EAEJa,OAFI,CAEID,MAAM,IAAIrB,WAAW,CAAC,SAAD,EAAYqB,MAAZ,EAAoBvB,YAApB,EAAkC;AAC9DiB,MAAAA,GAD8D;AAE9DC,MAAAA,QAF8D;AAG9DC,MAAAA,QAH8D;AAI9DX,MAAAA,GAAG,EAAE,KAAKK,IAJoD;AAK9DN,MAAAA,WAAW,EAAEgB,MAAM,CAAC,MAAM,KAAKT,KAAZ;AAL2C,KAAlC,CAFzB,CAAP;AASD;;AAED,MAAIW,MAAJ,GAAa;AACX,WAAO,KAAKb,MAAL,CAAYc,IAAnB;AACD;;AAEDT,EAAAA,GAAG,CAACU,CAAD,EAAI;AACL,QAAIA,CAAC,IAAI,KAAKf,MAAL,CAAYc,IAArB,EAA2B;AACzB,aAAO,IAAP;AACD;;AACD,WAAO,CAAC,GAAG,KAAKd,MAAL,CAAYgB,IAAZ,EAAJ,EAAwBD,CAAxB,CAAP;AACD;;AAEDE,EAAAA,OAAO,CAACZ,GAAD,EAAM;AACX,QAAI,KAAKL,MAAL,CAAYkB,GAAZ,CAAgBb,GAAhB,CAAJ,EAA0B;AACxB,aAAO,KAAKL,MAAL,CAAYmB,GAAZ,CAAgBd,GAAhB,CAAP;AACD;;AACD,WAAO,IAAP;AACD;;AAEDe,EAAAA,OAAO,CAACf,GAAD,EAAMgB,KAAN,EAAa;AAClB,UAAMf,QAAQ,GAAG,KAAKN,MAAL,CAAYmB,GAAZ,CAAgBd,GAAhB,KAAwB,IAAzC;;AAEA,QAAIC,QAAQ,KAAKe,KAAjB,EAAwB;AACtB;AACD,KALiB,CAOlB;;;AACA,QAAIC,gBAAgB,GAAGjB,GAAG,CAACQ,MAAJ,GAAaQ,KAAK,CAACR,MAA1C;;AACA,SAAK,MAAM,CAACU,MAAD,EAASC,QAAT,CAAX,IAAiC,KAAKxB,MAAtC,EAA8C;AAC5C;AACA,UAAIK,GAAG,KAAKkB,MAAZ,EAAoB;AAClBD,QAAAA,gBAAgB,IAAIC,MAAM,CAACV,MAAP,GAAgBW,QAAQ,CAACX,MAA7C;AACD;AACF;;AACD,QAAIS,gBAAgB,GAAG,KAAKnB,MAA5B,EAAoC;AAClC,YAAM,IAAIjB,YAAJ,CAAkB,OAAM,KAAKiB,MAAO,6CAApC,EAAkF,oBAAlF,CAAN;AACD;;AAEDsB,IAAAA,UAAU,CAAC,KAAKrB,qBAAL,CAA2BsB,IAA3B,CAAgC,IAAhC,CAAD,EAAwC,CAAxC,EAA2CrB,GAA3C,EAAgDC,QAAhD,EAA0De,KAA1D,CAAV;;AAEA,SAAKrB,MAAL,CAAY2B,GAAZ,CAAgBtB,GAAhB,EAAqBgB,KAArB;AACD;;AAEDO,EAAAA,UAAU,CAACvB,GAAD,EAAM;AACd,QAAI,KAAKL,MAAL,CAAYkB,GAAZ,CAAgBb,GAAhB,CAAJ,EAA0B;AACxBoB,MAAAA,UAAU,CAAC,KAAKrB,qBAAL,CAA2BsB,IAA3B,CAAgC,IAAhC,CAAD,EAAwC,CAAxC,EAA2CrB,GAA3C,EAAgD,KAAKL,MAAL,CAAYmB,GAAZ,CAAgBd,GAAhB,CAAhD,EAAsE,IAAtE,CAAV;;AAEA,WAAKL,MAAL,CAAY6B,MAAZ,CAAmBxB,GAAnB;AACD;AACF;;AAEDyB,EAAAA,KAAK,GAAG;AACN,QAAI,KAAK9B,MAAL,CAAYc,IAAZ,GAAmB,CAAvB,EAA0B;AACxBW,MAAAA,UAAU,CAAC,KAAKrB,qBAAL,CAA2BsB,IAA3B,CAAgC,IAAhC,CAAD,EAAwC,CAAxC,EAA2C,IAA3C,EAAiD,IAAjD,EAAuD,IAAvD,CAAV;;AAEA,WAAK1B,MAAL,CAAY8B,KAAZ;AACD;AACF;;AAED,OAAKzC,QAAQ,CAAC0C,sBAAd,IAAwC;AACtC,WAAO,KAAK/B,MAAL,CAAYgB,IAAZ,EAAP;AACD;;AAjFe;;AAoFlBgB,MAAM,CAACC,OAAP,GAAiB;AACfC,EAAAA,cAAc,EAAE3C;AADD,CAAjB","sourcesContent":["\"use strict\";\n\nconst DOMException = require(\"domexception\");\nconst StorageEvent = require(\"../generated/StorageEvent\");\nconst idlUtils = require(\"../generated/utils\");\nconst { fireAnEvent } = require(\"../helpers/events\");\n\n// https://html.spec.whatwg.org/multipage/webstorage.html#the-storage-interface\nclass StorageImpl {\n  constructor(args, { associatedWindow, storageArea, url, type, storageQuota }) {\n    this._associatedWindow = associatedWindow;\n    this._items = storageArea;\n    this._url = url;\n    this._type = type;\n    this._quota = storageQuota;\n  }\n\n  _dispatchStorageEvent(key, oldValue, newValue) {\n    return this._associatedWindow._currentOriginData.windowsInSameOrigin\n      .filter(target => target !== this._associatedWindow)\n      .forEach(target => fireAnEvent(\"storage\", target, StorageEvent, {\n        key,\n        oldValue,\n        newValue,\n        url: this._url,\n        storageArea: target[\"_\" + this._type]\n      }));\n  }\n\n  get length() {\n    return this._items.size;\n  }\n\n  key(n) {\n    if (n >= this._items.size) {\n      return null;\n    }\n    return [...this._items.keys()][n];\n  }\n\n  getItem(key) {\n    if (this._items.has(key)) {\n      return this._items.get(key);\n    }\n    return null;\n  }\n\n  setItem(key, value) {\n    const oldValue = this._items.get(key) || null;\n\n    if (oldValue === value) {\n      return;\n    }\n\n    // Concatenate all keys and values to measure their length against the quota\n    let itemsTotalLength = key.length + value.length;\n    for (const [curKey, curValue] of this._items) {\n      // If the key already exists, skip it as it will be set to the new value instead\n      if (key !== curKey) {\n        itemsTotalLength += curKey.length + curValue.length;\n      }\n    }\n    if (itemsTotalLength > this._quota) {\n      throw new DOMException(`The ${this._quota}-code unit storage quota has been exceeded.`, \"QuotaExceededError\");\n    }\n\n    setTimeout(this._dispatchStorageEvent.bind(this), 0, key, oldValue, value);\n\n    this._items.set(key, value);\n  }\n\n  removeItem(key) {\n    if (this._items.has(key)) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, key, this._items.get(key), null);\n\n      this._items.delete(key);\n    }\n  }\n\n  clear() {\n    if (this._items.size > 0) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, null, null, null);\n\n      this._items.clear();\n    }\n  }\n\n  get [idlUtils.supportedPropertyNames]() {\n    return this._items.keys();\n  }\n}\n\nmodule.exports = {\n  implementation: StorageImpl\n};\n"]},"metadata":{},"sourceType":"script"}