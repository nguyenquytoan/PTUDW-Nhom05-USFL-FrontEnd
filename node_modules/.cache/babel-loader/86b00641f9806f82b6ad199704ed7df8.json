{"ast":null,"code":"var util = require('util'),\n    net = require('net'),\n    tls = require('tls'),\n    url = require('url'),\n    driver = require('websocket-driver'),\n    API = require('./api'),\n    Event = require('./api/event');\n\nvar DEFAULT_PORTS = {\n  'http:': 80,\n  'https:': 443,\n  'ws:': 80,\n  'wss:': 443\n},\n    SECURE_PROTOCOLS = ['https:', 'wss:'];\n\nvar Client = function (_url, protocols, options) {\n  options = options || {};\n  this.url = _url;\n  this._driver = driver.client(this.url, {\n    maxLength: options.maxLength,\n    protocols: protocols\n  });\n  ['open', 'error'].forEach(function (event) {\n    this._driver.on(event, function () {\n      self.headers = self._driver.headers;\n      self.statusCode = self._driver.statusCode;\n    });\n  }, this);\n\n  var proxy = options.proxy || {},\n      endpoint = url.parse(proxy.origin || this.url),\n      port = endpoint.port || DEFAULT_PORTS[endpoint.protocol],\n      secure = SECURE_PROTOCOLS.indexOf(endpoint.protocol) >= 0,\n      onConnect = function () {\n    self._onConnect();\n  },\n      originTLS = options.tls || {},\n      socketTLS = proxy.origin ? proxy.tls || {} : originTLS,\n      self = this;\n\n  originTLS.ca = originTLS.ca || options.ca;\n  this._stream = secure ? tls.connect(port, endpoint.hostname, socketTLS, onConnect) : net.connect(port, endpoint.hostname, onConnect);\n  if (proxy.origin) this._configureProxy(proxy, originTLS);\n  API.call(this, options);\n};\n\nutil.inherits(Client, API);\n\nClient.prototype._onConnect = function () {\n  var worker = this._proxy || this._driver;\n  worker.start();\n};\n\nClient.prototype._configureProxy = function (proxy, originTLS) {\n  var uri = url.parse(this.url),\n      secure = SECURE_PROTOCOLS.indexOf(uri.protocol) >= 0,\n      self = this,\n      name;\n  this._proxy = this._driver.proxy(proxy.origin);\n\n  if (proxy.headers) {\n    for (name in proxy.headers) this._proxy.setHeader(name, proxy.headers[name]);\n  }\n\n  this._proxy.pipe(this._stream, {\n    end: false\n  });\n\n  this._stream.pipe(this._proxy);\n\n  this._proxy.on('connect', function () {\n    if (secure) {\n      var options = {\n        socket: self._stream,\n        servername: uri.hostname\n      };\n\n      for (name in originTLS) options[name] = originTLS[name];\n\n      self._stream = tls.connect(options);\n\n      self._configureStream();\n    }\n\n    self._driver.io.pipe(self._stream);\n\n    self._stream.pipe(self._driver.io);\n\n    self._driver.start();\n  });\n\n  this._proxy.on('error', function (error) {\n    self._driver.emit('error', error);\n  });\n};\n\nmodule.exports = Client;","map":{"version":3,"sources":["/Users/nguyenquytoan/Desktop/PTUDW-17TN-Nhom05-USFL/react-usfl/PTUDW-17TN-Nhom05/node_modules/faye-websocket/lib/faye/websocket/client.js"],"names":["util","require","net","tls","url","driver","API","Event","DEFAULT_PORTS","SECURE_PROTOCOLS","Client","_url","protocols","options","_driver","client","maxLength","forEach","event","on","self","headers","statusCode","proxy","endpoint","parse","origin","port","protocol","secure","indexOf","onConnect","_onConnect","originTLS","socketTLS","ca","_stream","connect","hostname","_configureProxy","call","inherits","prototype","worker","_proxy","start","uri","name","setHeader","pipe","end","socket","servername","_configureStream","io","error","emit","module","exports"],"mappings":"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","sourcesContent":["var util   = require('util'),\n    net    = require('net'),\n    tls    = require('tls'),\n    url    = require('url'),\n    driver = require('websocket-driver'),\n    API    = require('./api'),\n    Event  = require('./api/event');\n\nvar DEFAULT_PORTS    = {'http:': 80, 'https:': 443, 'ws:':80, 'wss:': 443},\n    SECURE_PROTOCOLS = ['https:', 'wss:'];\n\nvar Client = function(_url, protocols, options) {\n  options = options || {};\n\n  this.url     = _url;\n  this._driver = driver.client(this.url, {maxLength: options.maxLength, protocols: protocols});\n\n  ['open', 'error'].forEach(function(event) {\n    this._driver.on(event, function() {\n      self.headers    = self._driver.headers;\n      self.statusCode = self._driver.statusCode;\n    });\n  }, this);\n\n  var proxy     = options.proxy || {},\n      endpoint  = url.parse(proxy.origin || this.url),\n      port      = endpoint.port || DEFAULT_PORTS[endpoint.protocol],\n      secure    = SECURE_PROTOCOLS.indexOf(endpoint.protocol) >= 0,\n      onConnect = function() { self._onConnect() },\n      originTLS = options.tls || {},\n      socketTLS = proxy.origin ? (proxy.tls || {}) : originTLS,\n      self      = this;\n\n  originTLS.ca = originTLS.ca || options.ca;\n\n  this._stream = secure\n               ? tls.connect(port, endpoint.hostname, socketTLS, onConnect)\n               : net.connect(port, endpoint.hostname, onConnect);\n\n  if (proxy.origin) this._configureProxy(proxy, originTLS);\n\n  API.call(this, options);\n};\nutil.inherits(Client, API);\n\nClient.prototype._onConnect = function() {\n  var worker = this._proxy || this._driver;\n  worker.start();\n};\n\nClient.prototype._configureProxy = function(proxy, originTLS) {\n  var uri    = url.parse(this.url),\n      secure = SECURE_PROTOCOLS.indexOf(uri.protocol) >= 0,\n      self   = this,\n      name;\n\n  this._proxy = this._driver.proxy(proxy.origin);\n\n  if (proxy.headers) {\n    for (name in proxy.headers) this._proxy.setHeader(name, proxy.headers[name]);\n  }\n\n  this._proxy.pipe(this._stream, {end: false});\n  this._stream.pipe(this._proxy);\n\n  this._proxy.on('connect', function() {\n    if (secure) {\n      var options = {socket: self._stream, servername: uri.hostname};\n      for (name in originTLS) options[name] = originTLS[name];\n      self._stream = tls.connect(options);\n      self._configureStream();\n    }\n    self._driver.io.pipe(self._stream);\n    self._stream.pipe(self._driver.io);\n    self._driver.start();\n  });\n\n  this._proxy.on('error', function(error) {\n    self._driver.emit('error', error);\n  });\n};\n\nmodule.exports = Client;\n"]},"metadata":{},"sourceType":"script"}