{"ast":null,"code":"var childProcess = require('child_process');\n\nvar pkgUp = require('pkg-up');\n\nvar path = require('path');\n\nvar fs = require('fs');\n\nvar BrowserslistError = require('./error');\n\nfunction detectLockfile() {\n  var packagePath = pkgUp.sync();\n\n  if (!packagePath) {\n    throw new BrowserslistError('Cannot find package.json. ' + 'Is it a right project to run npx browserslist --update-db?');\n  }\n\n  var rootDir = path.dirname(packagePath);\n  var lockfileNpm = path.join(rootDir, 'package-lock.json');\n  var lockfileYarn = path.join(rootDir, 'yarn.lock');\n  var lockfilePnpm = path.join(rootDir, 'pnpm-lock.yaml');\n\n  if (fs.existsSync(lockfileNpm)) {\n    return {\n      mode: 'npm',\n      file: lockfileNpm\n    };\n  } else if (fs.existsSync(lockfileYarn)) {\n    return {\n      mode: 'yarn',\n      file: lockfileYarn\n    };\n  } else if (fs.existsSync(lockfilePnpm)) {\n    return {\n      mode: 'pnpm',\n      file: lockfilePnpm\n    };\n  } else {\n    throw new BrowserslistError('No lockfile found. Run \"npm install\", \"yarn install\" or \"pnpm install\"');\n  }\n}\n\nfunction getCurrentVersion(lock) {\n  var match;\n\n  if (lock.mode === 'npm') {\n    var dependencies = JSON.parse(lock.content).dependencies;\n\n    if (dependencies && dependencies['caniuse-lite']) {\n      return dependencies['caniuse-lite'].version;\n    }\n  } else if (lock.mode === 'yarn') {\n    match = /caniuse-lite@[^:]+:\\n\\s+version\\s+\"([^\"]+)\"/.exec(lock.content);\n    if (match[1]) return match[1];\n  } else if (lock.mode === 'pnpm') {\n    match = /\\/caniuse-lite\\/([^:]+):/.exec(lock.content);\n    if (match[1]) return match[1];\n  }\n\n  return null;\n}\n\nfunction getLastestInfo() {\n  return JSON.parse(childProcess.execSync('npm show caniuse-lite --json').toString());\n}\n\nfunction updateLockfile(lock, latest) {\n  if (lock.mode === 'npm') {\n    var fixed = deletePackage(JSON.parse(lock.content));\n    return JSON.stringify(fixed, null, '  ');\n  } else {\n    var lines = lock.content.split('\\n');\n    var i;\n\n    if (lock.mode === 'yarn') {\n      for (i = 0; i < lines.length; i++) {\n        if (lines[i].indexOf('caniuse-lite@') !== -1) {\n          lines[i + 1] = lines[i + 1].replace(/version \"[^\"]+\"/, 'version \"' + latest.version + '\"');\n          lines[i + 2] = lines[i + 2].replace(/resolved \"[^\"]+\"/, 'resolved \"' + latest.dist.tarball + '\"');\n          lines[i + 3] = lines[i + 3].replace(/integrity .+/, 'integrity ' + latest.dist.integrity);\n          i += 4;\n        }\n      }\n    } else if (lock.mode === 'pnpm') {\n      for (i = 0; i < lines.length; i++) {\n        if (lines[i].indexOf('caniuse-lite:') >= 0) {\n          lines[i] = lines[i].replace(/: .*$/, ': ' + latest.version);\n        } else if (lines[i].indexOf('/caniuse-lite') >= 0) {\n          lines[i] = lines[i].replace(/\\/[^/:]+:/, '/' + latest.version + ':');\n\n          for (i = i + 1; i < lines.length; i++) {\n            if (lines[i].indexOf('integrity: ') !== -1) {\n              lines[i] = lines[i].replace(/integrity: .+/, 'integrity: ' + latest.dist.integrity);\n            } else if (lines[i].indexOf(' /') !== -1) {\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    return lines.join('\\n');\n  }\n}\n\nfunction deletePackage(node) {\n  if (node.dependencies) {\n    delete node.dependencies['caniuse-lite'];\n\n    for (var i in node.dependencies) {\n      node.dependencies[i] = deletePackage(node.dependencies[i]);\n    }\n  }\n\n  return node;\n}\n\nmodule.exports = function updateDB(print) {\n  var lock = detectLockfile();\n  lock.content = fs.readFileSync(lock.file).toString();\n  var current = getCurrentVersion(lock);\n  var latest = getLastestInfo();\n\n  if (typeof current === 'string') {\n    print('Current version: ' + current + '\\n');\n  }\n\n  print('New version: ' + latest.version + '\\n' + 'Updating caniuse-lite…\\n');\n  fs.writeFileSync(lock.file, updateLockfile(lock, latest));\n  childProcess.execSync(lock.mode + ' install');\n  print('caniuse-lite has been successfully updated');\n};","map":{"version":3,"sources":["/Users/nguyenquytoan/Desktop/PTUDW-17TN-Nhom05-USFL/react-usfl/PTUDW-17TN-Nhom05/node_modules/react-dev-utils/node_modules/browserslist/update-db.js"],"names":["childProcess","require","pkgUp","path","fs","BrowserslistError","detectLockfile","packagePath","sync","rootDir","dirname","lockfileNpm","join","lockfileYarn","lockfilePnpm","existsSync","mode","file","getCurrentVersion","lock","match","dependencies","JSON","parse","content","version","exec","getLastestInfo","execSync","toString","updateLockfile","latest","fixed","deletePackage","stringify","lines","split","i","length","indexOf","replace","dist","tarball","integrity","node","module","exports","updateDB","print","readFileSync","current","writeFileSync"],"mappings":"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","sourcesContent":["var childProcess = require('child_process')\nvar pkgUp = require('pkg-up')\nvar path = require('path')\nvar fs = require('fs')\n\nvar BrowserslistError = require('./error')\n\nfunction detectLockfile () {\n  var packagePath = pkgUp.sync()\n  if (!packagePath) {\n    throw new BrowserslistError(\n      'Cannot find package.json. ' +\n      'Is it a right project to run npx browserslist --update-db?'\n    )\n  }\n\n  var rootDir = path.dirname(packagePath)\n  var lockfileNpm = path.join(rootDir, 'package-lock.json')\n  var lockfileYarn = path.join(rootDir, 'yarn.lock')\n  var lockfilePnpm = path.join(rootDir, 'pnpm-lock.yaml')\n\n  if (fs.existsSync(lockfileNpm)) {\n    return { mode: 'npm', file: lockfileNpm }\n  } else if (fs.existsSync(lockfileYarn)) {\n    return { mode: 'yarn', file: lockfileYarn }\n  } else if (fs.existsSync(lockfilePnpm)) {\n    return { mode: 'pnpm', file: lockfilePnpm }\n  } else {\n    throw new BrowserslistError(\n      'No lockfile found. Run \"npm install\", \"yarn install\" or \"pnpm install\"'\n    )\n  }\n}\n\nfunction getCurrentVersion (lock) {\n  var match\n  if (lock.mode === 'npm') {\n    var dependencies = JSON.parse(lock.content).dependencies\n    if (dependencies && dependencies['caniuse-lite']) {\n      return dependencies['caniuse-lite'].version\n    }\n  } else if (lock.mode === 'yarn') {\n    match = /caniuse-lite@[^:]+:\\n\\s+version\\s+\"([^\"]+)\"/.exec(lock.content)\n    if (match[1]) return match[1]\n  } else if (lock.mode === 'pnpm') {\n    match = /\\/caniuse-lite\\/([^:]+):/.exec(lock.content)\n    if (match[1]) return match[1]\n  }\n  return null\n}\n\nfunction getLastestInfo () {\n  return JSON.parse(\n    childProcess.execSync('npm show caniuse-lite --json').toString()\n  )\n}\n\nfunction updateLockfile (lock, latest) {\n  if (lock.mode === 'npm') {\n    var fixed = deletePackage(JSON.parse(lock.content))\n    return JSON.stringify(fixed, null, '  ')\n  } else {\n    var lines = lock.content.split('\\n')\n    var i\n    if (lock.mode === 'yarn') {\n      for (i = 0; i < lines.length; i++) {\n        if (lines[i].indexOf('caniuse-lite@') !== -1) {\n          lines[i + 1] = lines[i + 1].replace(\n            /version \"[^\"]+\"/, 'version \"' + latest.version + '\"'\n          )\n          lines[i + 2] = lines[i + 2].replace(\n            /resolved \"[^\"]+\"/, 'resolved \"' + latest.dist.tarball + '\"'\n          )\n          lines[i + 3] = lines[i + 3].replace(\n            /integrity .+/, 'integrity ' + latest.dist.integrity\n          )\n          i += 4\n        }\n      }\n    } else if (lock.mode === 'pnpm') {\n      for (i = 0; i < lines.length; i++) {\n        if (lines[i].indexOf('caniuse-lite:') >= 0) {\n          lines[i] = lines[i].replace(/: .*$/, ': ' + latest.version)\n        } else if (lines[i].indexOf('/caniuse-lite') >= 0) {\n          lines[i] = lines[i].replace(/\\/[^/:]+:/, '/' + latest.version + ':')\n          for (i = i + 1; i < lines.length; i++) {\n            if (lines[i].indexOf('integrity: ') !== -1) {\n              lines[i] = lines[i].replace(\n                /integrity: .+/, 'integrity: ' + latest.dist.integrity\n              )\n            } else if (lines[i].indexOf(' /') !== -1) {\n              break\n            }\n          }\n        }\n      }\n    }\n    return lines.join('\\n')\n  }\n}\n\nfunction deletePackage (node) {\n  if (node.dependencies) {\n    delete node.dependencies['caniuse-lite']\n    for (var i in node.dependencies) {\n      node.dependencies[i] = deletePackage(node.dependencies[i])\n    }\n  }\n  return node\n}\n\nmodule.exports = function updateDB (print) {\n  var lock = detectLockfile()\n  lock.content = fs.readFileSync(lock.file).toString()\n\n  var current = getCurrentVersion(lock)\n  var latest = getLastestInfo()\n\n  if (typeof current === 'string') {\n    print('Current version: ' + current + '\\n')\n  }\n  print(\n    'New version: ' + latest.version + '\\n' +\n    'Updating caniuse-lite…\\n'\n  )\n\n  fs.writeFileSync(lock.file, updateLockfile(lock, latest))\n  childProcess.execSync(lock.mode + ' install')\n\n  print('caniuse-lite has been successfully updated')\n}\n"]},"metadata":{},"sourceType":"script"}