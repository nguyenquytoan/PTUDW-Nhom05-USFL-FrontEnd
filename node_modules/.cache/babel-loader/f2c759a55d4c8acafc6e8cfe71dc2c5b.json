{"ast":null,"code":"import originalThen from './then';\nimport originalResolve from './promise/resolve';\nimport instrument from './instrument';\nimport { config } from './config';\nimport Promise from './promise';\n\nfunction withOwnPromise() {\n  return new TypeError('A promises callback cannot return that same promise.');\n}\n\nfunction objectOrFunction(x) {\n  let type = typeof x;\n  return x !== null && (type === 'object' || type === 'function');\n}\n\nexport function noop() {}\nexport const PENDING = void 0;\nexport const FULFILLED = 1;\nexport const REJECTED = 2;\n\nfunction tryThen(then, value, fulfillmentHandler, rejectionHandler) {\n  try {\n    then.call(value, fulfillmentHandler, rejectionHandler);\n  } catch (e) {\n    return e;\n  }\n}\n\nfunction handleForeignThenable(promise, thenable, then) {\n  config.async(promise => {\n    let sealed = false;\n    let error = tryThen(then, thenable, value => {\n      if (sealed) {\n        return;\n      }\n\n      sealed = true;\n\n      if (thenable === value) {\n        fulfill(promise, value);\n      } else {\n        resolve(promise, value);\n      }\n    }, reason => {\n      if (sealed) {\n        return;\n      }\n\n      sealed = true;\n      reject(promise, reason);\n    }, 'Settle: ' + (promise._label || ' unknown promise'));\n\n    if (!sealed && error) {\n      sealed = true;\n      reject(promise, error);\n    }\n  }, promise);\n}\n\nfunction handleOwnThenable(promise, thenable) {\n  if (thenable._state === FULFILLED) {\n    fulfill(promise, thenable._result);\n  } else if (thenable._state === REJECTED) {\n    thenable._onError = null;\n    reject(promise, thenable._result);\n  } else {\n    subscribe(thenable, undefined, value => {\n      if (thenable === value) {\n        fulfill(promise, value);\n      } else {\n        resolve(promise, value);\n      }\n    }, reason => reject(promise, reason));\n  }\n}\n\nexport function handleMaybeThenable(promise, maybeThenable, then) {\n  let isOwnThenable = maybeThenable.constructor === promise.constructor && then === originalThen && promise.constructor.resolve === originalResolve;\n\n  if (isOwnThenable) {\n    handleOwnThenable(promise, maybeThenable);\n  } else if (typeof then === 'function') {\n    handleForeignThenable(promise, maybeThenable, then);\n  } else {\n    fulfill(promise, maybeThenable);\n  }\n}\nexport function resolve(promise, value) {\n  if (promise === value) {\n    fulfill(promise, value);\n  } else if (objectOrFunction(value)) {\n    let then;\n\n    try {\n      then = value.then;\n    } catch (error) {\n      reject(promise, error);\n      return;\n    }\n\n    handleMaybeThenable(promise, value, then);\n  } else {\n    fulfill(promise, value);\n  }\n}\nexport function publishRejection(promise) {\n  if (promise._onError) {\n    promise._onError(promise._result);\n  }\n\n  publish(promise);\n}\nexport function fulfill(promise, value) {\n  if (promise._state !== PENDING) {\n    return;\n  }\n\n  promise._result = value;\n  promise._state = FULFILLED;\n\n  if (promise._subscribers.length === 0) {\n    if (config.instrument) {\n      instrument('fulfilled', promise);\n    }\n  } else {\n    config.async(publish, promise);\n  }\n}\nexport function reject(promise, reason) {\n  if (promise._state !== PENDING) {\n    return;\n  }\n\n  promise._state = REJECTED;\n  promise._result = reason;\n  config.async(publishRejection, promise);\n}\nexport function subscribe(parent, child, onFulfillment, onRejection) {\n  let subscribers = parent._subscribers;\n  let length = subscribers.length;\n  parent._onError = null;\n  subscribers[length] = child;\n  subscribers[length + FULFILLED] = onFulfillment;\n  subscribers[length + REJECTED] = onRejection;\n\n  if (length === 0 && parent._state) {\n    config.async(publish, parent);\n  }\n}\nexport function publish(promise) {\n  let subscribers = promise._subscribers;\n  let settled = promise._state;\n\n  if (config.instrument) {\n    instrument(settled === FULFILLED ? 'fulfilled' : 'rejected', promise);\n  }\n\n  if (subscribers.length === 0) {\n    return;\n  }\n\n  let child,\n      callback,\n      result = promise._result;\n\n  for (let i = 0; i < subscribers.length; i += 3) {\n    child = subscribers[i];\n    callback = subscribers[i + settled];\n\n    if (child) {\n      invokeCallback(settled, child, callback, result);\n    } else {\n      callback(result);\n    }\n  }\n\n  promise._subscribers.length = 0;\n}\nexport function invokeCallback(state, promise, callback, result) {\n  let hasCallback = typeof callback === 'function';\n  let value,\n      succeeded = true,\n      error;\n\n  if (hasCallback) {\n    try {\n      value = callback(result);\n    } catch (e) {\n      succeeded = false;\n      error = e;\n    }\n  } else {\n    value = result;\n  }\n\n  if (promise._state !== PENDING) {// noop\n  } else if (value === promise) {\n    reject(promise, withOwnPromise());\n  } else if (succeeded === false) {\n    reject(promise, error);\n  } else if (hasCallback) {\n    resolve(promise, value);\n  } else if (state === FULFILLED) {\n    fulfill(promise, value);\n  } else if (state === REJECTED) {\n    reject(promise, value);\n  }\n}\nexport function initializePromise(promise, resolver) {\n  let resolved = false;\n\n  try {\n    resolver(value => {\n      if (resolved) {\n        return;\n      }\n\n      resolved = true;\n      resolve(promise, value);\n    }, reason => {\n      if (resolved) {\n        return;\n      }\n\n      resolved = true;\n      reject(promise, reason);\n    });\n  } catch (e) {\n    reject(promise, e);\n  }\n}","map":{"version":3,"sources":["/Users/nguyenquytoan/Desktop/PTUDW-17TN-Nhom05-USFL/react-usfl/PTUDW-17TN-Nhom05/node_modules/rsvp/lib/rsvp/-internal.js"],"names":["originalThen","originalResolve","instrument","config","Promise","withOwnPromise","TypeError","objectOrFunction","x","type","noop","PENDING","FULFILLED","REJECTED","tryThen","then","value","fulfillmentHandler","rejectionHandler","call","e","handleForeignThenable","promise","thenable","async","sealed","error","fulfill","resolve","reason","reject","_label","handleOwnThenable","_state","_result","_onError","subscribe","undefined","handleMaybeThenable","maybeThenable","isOwnThenable","constructor","publishRejection","publish","_subscribers","length","parent","child","onFulfillment","onRejection","subscribers","settled","callback","result","i","invokeCallback","state","hasCallback","succeeded","initializePromise","resolver","resolved"],"mappings":"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","sourcesContent":["import originalThen from './then';\nimport originalResolve from './promise/resolve';\nimport instrument from './instrument';\n\nimport { config } from './config';\nimport Promise from './promise';\n\nfunction withOwnPromise() {\n  return new TypeError('A promises callback cannot return that same promise.');\n}\n\nfunction objectOrFunction(x) {\n  let type = typeof x;\n  return x !== null && (type === 'object' || type === 'function');\n}\n\nexport function noop() {}\n\nexport const PENDING   = void 0;\nexport const FULFILLED = 1;\nexport const REJECTED  = 2;\n\nfunction tryThen(then, value, fulfillmentHandler, rejectionHandler) {\n  try {\n    then.call(value, fulfillmentHandler, rejectionHandler);\n  } catch(e) {\n    return e;\n  }\n}\nfunction handleForeignThenable(promise, thenable, then) {\n  config.async(promise => {\n    let sealed = false;\n    let error = tryThen(then,\n      thenable,\n      value => {\n        if (sealed) { return; }\n        sealed = true;\n        if (thenable === value) {\n          fulfill(promise, value);\n        } else {\n          resolve(promise, value);\n        }\n      },\n      reason => {\n        if (sealed) { return; }\n        sealed = true;\n\n        reject(promise, reason);\n      },\n      'Settle: ' + (promise._label || ' unknown promise')\n    );\n    if (!sealed && error) {\n      sealed = true;\n      reject(promise, error);\n    }\n  }, promise);\n}\n\nfunction handleOwnThenable(promise, thenable) {\n  if (thenable._state === FULFILLED) {\n    fulfill(promise, thenable._result);\n  } else if (thenable._state === REJECTED) {\n    thenable._onError = null;\n    reject(promise, thenable._result);\n  } else {\n    subscribe(thenable, undefined, value => {\n      if (thenable === value) {\n        fulfill(promise, value);\n      } else {\n        resolve(promise, value);\n      }\n    }, reason => reject(promise, reason));\n  }\n}\n\nexport function handleMaybeThenable(promise, maybeThenable, then) {\n  let isOwnThenable =\n    maybeThenable.constructor === promise.constructor &&\n    then === originalThen &&\n    promise.constructor.resolve === originalResolve;\n\n  if (isOwnThenable) {\n    handleOwnThenable(promise, maybeThenable);\n  } else if (typeof then === 'function') {\n    handleForeignThenable(promise, maybeThenable, then);\n  } else {\n    fulfill(promise, maybeThenable);\n  }\n}\n\nexport function resolve(promise, value) {\n  if (promise === value) {\n    fulfill(promise, value);\n  } else if (objectOrFunction(value)) {\n    let then;\n    try {\n      then = value.then;\n    } catch (error) {\n      reject(promise, error);\n      return;\n    }\n    handleMaybeThenable(promise, value, then);\n  } else {\n    fulfill(promise, value);\n  }\n}\n\nexport function publishRejection(promise) {\n  if (promise._onError) {\n    promise._onError(promise._result);\n  }\n\n  publish(promise);\n}\n\nexport function fulfill(promise, value) {\n  if (promise._state !== PENDING) { return; }\n\n  promise._result = value;\n  promise._state = FULFILLED;\n\n  if (promise._subscribers.length === 0) {\n    if (config.instrument) {\n      instrument('fulfilled', promise);\n    }\n  } else {\n    config.async(publish, promise);\n  }\n}\n\nexport function reject(promise, reason) {\n  if (promise._state !== PENDING) { return; }\n  promise._state = REJECTED;\n  promise._result = reason;\n  config.async(publishRejection, promise);\n}\n\nexport function subscribe(parent, child, onFulfillment, onRejection) {\n  let subscribers = parent._subscribers;\n  let length = subscribers.length;\n\n  parent._onError = null;\n\n  subscribers[length] = child;\n  subscribers[length + FULFILLED] = onFulfillment;\n  subscribers[length + REJECTED]  = onRejection;\n\n  if (length === 0 && parent._state) {\n    config.async(publish, parent);\n  }\n}\n\nexport function publish(promise) {\n  let subscribers = promise._subscribers;\n  let settled = promise._state;\n\n  if (config.instrument) {\n    instrument(settled === FULFILLED ? 'fulfilled' : 'rejected', promise);\n  }\n\n  if (subscribers.length === 0) { return; }\n\n  let child, callback, result = promise._result;\n\n  for (let i = 0; i < subscribers.length; i += 3) {\n    child = subscribers[i];\n    callback = subscribers[i + settled];\n\n    if (child) {\n      invokeCallback(settled, child, callback, result);\n    } else {\n      callback(result);\n    }\n  }\n\n  promise._subscribers.length = 0;\n}\n\nexport function invokeCallback(state, promise, callback, result) {\n  let hasCallback = typeof callback === 'function';\n  let value, succeeded = true, error;\n\n  if (hasCallback) {\n    try {\n      value = callback(result)\n    } catch (e) {\n      succeeded = false;\n      error = e;\n    }\n  } else {\n    value = result;\n  }\n\n  if (promise._state !== PENDING) {\n    // noop\n  } else if (value === promise) {\n    reject(promise, withOwnPromise());\n  } else if (succeeded === false) {\n    reject(promise, error);\n  } else if (hasCallback) {\n    resolve(promise, value);\n  } else if (state === FULFILLED) {\n    fulfill(promise, value);\n  } else if (state === REJECTED) {\n    reject(promise, value);\n  }\n}\n\nexport function initializePromise(promise, resolver) {\n  let resolved = false;\n  try {\n    resolver(value => {\n      if (resolved) { return; }\n      resolved = true;\n      resolve(promise, value);\n    }, reason => {\n      if (resolved) { return; }\n      resolved = true;\n      reject(promise, reason);\n    });\n  } catch(e) {\n    reject(promise, e);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}