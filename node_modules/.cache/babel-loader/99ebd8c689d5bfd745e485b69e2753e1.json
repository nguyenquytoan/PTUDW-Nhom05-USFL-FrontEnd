{"ast":null,"code":"var fs = require('fs');\n\nvar path = require('path');\n\nvar applySourceMaps = require('./apply-source-maps');\n\nvar extractImportUrlAndMedia = require('./extract-import-url-and-media');\n\nvar isAllowedResource = require('./is-allowed-resource');\n\nvar loadOriginalSources = require('./load-original-sources');\n\nvar normalizePath = require('./normalize-path');\n\nvar rebase = require('./rebase');\n\nvar rebaseLocalMap = require('./rebase-local-map');\n\nvar rebaseRemoteMap = require('./rebase-remote-map');\n\nvar restoreImport = require('./restore-import');\n\nvar tokenize = require('../tokenizer/tokenize');\n\nvar Token = require('../tokenizer/token');\n\nvar Marker = require('../tokenizer/marker');\n\nvar hasProtocol = require('../utils/has-protocol');\n\nvar isImport = require('../utils/is-import');\n\nvar isRemoteResource = require('../utils/is-remote-resource');\n\nvar UNKNOWN_URI = 'uri:unknown';\n\nfunction readSources(input, context, callback) {\n  return doReadSources(input, context, function (tokens) {\n    return applySourceMaps(tokens, context, function () {\n      return loadOriginalSources(context, function () {\n        return callback(tokens);\n      });\n    });\n  });\n}\n\nfunction doReadSources(input, context, callback) {\n  if (typeof input == 'string') {\n    return fromString(input, context, callback);\n  } else if (Buffer.isBuffer(input)) {\n    return fromString(input.toString(), context, callback);\n  } else if (Array.isArray(input)) {\n    return fromArray(input, context, callback);\n  } else if (typeof input == 'object') {\n    return fromHash(input, context, callback);\n  }\n}\n\nfunction fromString(input, context, callback) {\n  context.source = undefined;\n  context.sourcesContent[undefined] = input;\n  context.stats.originalSize += input.length;\n  return fromStyles(input, context, {\n    inline: context.options.inline\n  }, callback);\n}\n\nfunction fromArray(input, context, callback) {\n  var inputAsImports = input.reduce(function (accumulator, uriOrHash) {\n    if (typeof uriOrHash === 'string') {\n      return addStringSource(uriOrHash, accumulator);\n    } else {\n      return addHashSource(uriOrHash, context, accumulator);\n    }\n  }, []);\n  return fromStyles(inputAsImports.join(''), context, {\n    inline: ['all']\n  }, callback);\n}\n\nfunction fromHash(input, context, callback) {\n  var inputAsImports = addHashSource(input, context, []);\n  return fromStyles(inputAsImports.join(''), context, {\n    inline: ['all']\n  }, callback);\n}\n\nfunction addStringSource(input, imports) {\n  imports.push(restoreAsImport(normalizeUri(input)));\n  return imports;\n}\n\nfunction addHashSource(input, context, imports) {\n  var uri;\n  var normalizedUri;\n  var source;\n\n  for (uri in input) {\n    source = input[uri];\n    normalizedUri = normalizeUri(uri);\n    imports.push(restoreAsImport(normalizedUri));\n    context.sourcesContent[normalizedUri] = source.styles;\n\n    if (source.sourceMap) {\n      trackSourceMap(source.sourceMap, normalizedUri, context);\n    }\n  }\n\n  return imports;\n}\n\nfunction normalizeUri(uri) {\n  var currentPath = path.resolve('');\n  var absoluteUri;\n  var relativeToCurrentPath;\n  var normalizedUri;\n\n  if (isRemoteResource(uri)) {\n    return uri;\n  }\n\n  absoluteUri = path.isAbsolute(uri) ? uri : path.resolve(uri);\n  relativeToCurrentPath = path.relative(currentPath, absoluteUri);\n  normalizedUri = normalizePath(relativeToCurrentPath);\n  return normalizedUri;\n}\n\nfunction trackSourceMap(sourceMap, uri, context) {\n  var parsedMap = typeof sourceMap == 'string' ? JSON.parse(sourceMap) : sourceMap;\n  var rebasedMap = isRemoteResource(uri) ? rebaseRemoteMap(parsedMap, uri) : rebaseLocalMap(parsedMap, uri || UNKNOWN_URI, context.options.rebaseTo);\n  context.inputSourceMapTracker.track(uri, rebasedMap);\n}\n\nfunction restoreAsImport(uri) {\n  return restoreImport('url(' + uri + ')', '') + Marker.SEMICOLON;\n}\n\nfunction fromStyles(styles, context, parentInlinerContext, callback) {\n  var tokens;\n  var rebaseConfig = {};\n\n  if (!context.source) {\n    rebaseConfig.fromBase = path.resolve('');\n    rebaseConfig.toBase = context.options.rebaseTo;\n  } else if (isRemoteResource(context.source)) {\n    rebaseConfig.fromBase = context.source;\n    rebaseConfig.toBase = context.source;\n  } else if (path.isAbsolute(context.source)) {\n    rebaseConfig.fromBase = path.dirname(context.source);\n    rebaseConfig.toBase = context.options.rebaseTo;\n  } else {\n    rebaseConfig.fromBase = path.dirname(path.resolve(context.source));\n    rebaseConfig.toBase = context.options.rebaseTo;\n  }\n\n  tokens = tokenize(styles, context);\n  tokens = rebase(tokens, context.options.rebase, context.validator, rebaseConfig);\n  return allowsAnyImports(parentInlinerContext.inline) ? inline(tokens, context, parentInlinerContext, callback) : callback(tokens);\n}\n\nfunction allowsAnyImports(inline) {\n  return !(inline.length == 1 && inline[0] == 'none');\n}\n\nfunction inline(tokens, externalContext, parentInlinerContext, callback) {\n  var inlinerContext = {\n    afterContent: false,\n    callback: callback,\n    errors: externalContext.errors,\n    externalContext: externalContext,\n    fetch: externalContext.options.fetch,\n    inlinedStylesheets: parentInlinerContext.inlinedStylesheets || externalContext.inlinedStylesheets,\n    inline: parentInlinerContext.inline,\n    inlineRequest: externalContext.options.inlineRequest,\n    inlineTimeout: externalContext.options.inlineTimeout,\n    isRemote: parentInlinerContext.isRemote || false,\n    localOnly: externalContext.localOnly,\n    outputTokens: [],\n    rebaseTo: externalContext.options.rebaseTo,\n    sourceTokens: tokens,\n    warnings: externalContext.warnings\n  };\n  return doInlineImports(inlinerContext);\n}\n\nfunction doInlineImports(inlinerContext) {\n  var token;\n  var i, l;\n\n  for (i = 0, l = inlinerContext.sourceTokens.length; i < l; i++) {\n    token = inlinerContext.sourceTokens[i];\n\n    if (token[0] == Token.AT_RULE && isImport(token[1])) {\n      inlinerContext.sourceTokens.splice(0, i);\n      return inlineStylesheet(token, inlinerContext);\n    } else if (token[0] == Token.AT_RULE || token[0] == Token.COMMENT) {\n      inlinerContext.outputTokens.push(token);\n    } else {\n      inlinerContext.outputTokens.push(token);\n      inlinerContext.afterContent = true;\n    }\n  }\n\n  inlinerContext.sourceTokens = [];\n  return inlinerContext.callback(inlinerContext.outputTokens);\n}\n\nfunction inlineStylesheet(token, inlinerContext) {\n  var uriAndMediaQuery = extractImportUrlAndMedia(token[1]);\n  var uri = uriAndMediaQuery[0];\n  var mediaQuery = uriAndMediaQuery[1];\n  var metadata = token[2];\n  return isRemoteResource(uri) ? inlineRemoteStylesheet(uri, mediaQuery, metadata, inlinerContext) : inlineLocalStylesheet(uri, mediaQuery, metadata, inlinerContext);\n}\n\nfunction inlineRemoteStylesheet(uri, mediaQuery, metadata, inlinerContext) {\n  var isAllowed = isAllowedResource(uri, true, inlinerContext.inline);\n  var originalUri = uri;\n  var isLoaded = (uri in inlinerContext.externalContext.sourcesContent);\n  var isRuntimeResource = !hasProtocol(uri);\n\n  if (inlinerContext.inlinedStylesheets.indexOf(uri) > -1) {\n    inlinerContext.warnings.push('Ignoring remote @import of \"' + uri + '\" as it has already been imported.');\n    inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n    return doInlineImports(inlinerContext);\n  } else if (inlinerContext.localOnly && inlinerContext.afterContent) {\n    inlinerContext.warnings.push('Ignoring remote @import of \"' + uri + '\" as no callback given and after other content.');\n    inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n    return doInlineImports(inlinerContext);\n  } else if (isRuntimeResource) {\n    inlinerContext.warnings.push('Skipping remote @import of \"' + uri + '\" as no protocol given.');\n    inlinerContext.outputTokens = inlinerContext.outputTokens.concat(inlinerContext.sourceTokens.slice(0, 1));\n    inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n    return doInlineImports(inlinerContext);\n  } else if (inlinerContext.localOnly && !isLoaded) {\n    inlinerContext.warnings.push('Skipping remote @import of \"' + uri + '\" as no callback given.');\n    inlinerContext.outputTokens = inlinerContext.outputTokens.concat(inlinerContext.sourceTokens.slice(0, 1));\n    inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n    return doInlineImports(inlinerContext);\n  } else if (!isAllowed && inlinerContext.afterContent) {\n    inlinerContext.warnings.push('Ignoring remote @import of \"' + uri + '\" as resource is not allowed and after other content.');\n    inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n    return doInlineImports(inlinerContext);\n  } else if (!isAllowed) {\n    inlinerContext.warnings.push('Skipping remote @import of \"' + uri + '\" as resource is not allowed.');\n    inlinerContext.outputTokens = inlinerContext.outputTokens.concat(inlinerContext.sourceTokens.slice(0, 1));\n    inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n    return doInlineImports(inlinerContext);\n  }\n\n  inlinerContext.inlinedStylesheets.push(uri);\n\n  function whenLoaded(error, importedStyles) {\n    if (error) {\n      inlinerContext.errors.push('Broken @import declaration of \"' + uri + '\" - ' + error);\n      return process.nextTick(function () {\n        inlinerContext.outputTokens = inlinerContext.outputTokens.concat(inlinerContext.sourceTokens.slice(0, 1));\n        inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n        doInlineImports(inlinerContext);\n      });\n    }\n\n    inlinerContext.inline = inlinerContext.externalContext.options.inline;\n    inlinerContext.isRemote = true;\n    inlinerContext.externalContext.source = originalUri;\n    inlinerContext.externalContext.sourcesContent[uri] = importedStyles;\n    inlinerContext.externalContext.stats.originalSize += importedStyles.length;\n    return fromStyles(importedStyles, inlinerContext.externalContext, inlinerContext, function (importedTokens) {\n      importedTokens = wrapInMedia(importedTokens, mediaQuery, metadata);\n      inlinerContext.outputTokens = inlinerContext.outputTokens.concat(importedTokens);\n      inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n      return doInlineImports(inlinerContext);\n    });\n  }\n\n  return isLoaded ? whenLoaded(null, inlinerContext.externalContext.sourcesContent[uri]) : inlinerContext.fetch(uri, inlinerContext.inlineRequest, inlinerContext.inlineTimeout, whenLoaded);\n}\n\nfunction inlineLocalStylesheet(uri, mediaQuery, metadata, inlinerContext) {\n  var currentPath = path.resolve('');\n  var absoluteUri = path.isAbsolute(uri) ? path.resolve(currentPath, uri[0] == '/' ? uri.substring(1) : uri) : path.resolve(inlinerContext.rebaseTo, uri);\n  var relativeToCurrentPath = path.relative(currentPath, absoluteUri);\n  var importedStyles;\n  var isAllowed = isAllowedResource(uri, false, inlinerContext.inline);\n  var normalizedPath = normalizePath(relativeToCurrentPath);\n  var isLoaded = (normalizedPath in inlinerContext.externalContext.sourcesContent);\n\n  if (inlinerContext.inlinedStylesheets.indexOf(absoluteUri) > -1) {\n    inlinerContext.warnings.push('Ignoring local @import of \"' + uri + '\" as it has already been imported.');\n  } else if (!isLoaded && (!fs.existsSync(absoluteUri) || !fs.statSync(absoluteUri).isFile())) {\n    inlinerContext.errors.push('Ignoring local @import of \"' + uri + '\" as resource is missing.');\n  } else if (!isAllowed && inlinerContext.afterContent) {\n    inlinerContext.warnings.push('Ignoring local @import of \"' + uri + '\" as resource is not allowed and after other content.');\n  } else if (inlinerContext.afterContent) {\n    inlinerContext.warnings.push('Ignoring local @import of \"' + uri + '\" as after other content.');\n  } else if (!isAllowed) {\n    inlinerContext.warnings.push('Skipping local @import of \"' + uri + '\" as resource is not allowed.');\n    inlinerContext.outputTokens = inlinerContext.outputTokens.concat(inlinerContext.sourceTokens.slice(0, 1));\n  } else {\n    importedStyles = isLoaded ? inlinerContext.externalContext.sourcesContent[normalizedPath] : fs.readFileSync(absoluteUri, 'utf-8');\n    inlinerContext.inlinedStylesheets.push(absoluteUri);\n    inlinerContext.inline = inlinerContext.externalContext.options.inline;\n    inlinerContext.externalContext.source = normalizedPath;\n    inlinerContext.externalContext.sourcesContent[normalizedPath] = importedStyles;\n    inlinerContext.externalContext.stats.originalSize += importedStyles.length;\n    return fromStyles(importedStyles, inlinerContext.externalContext, inlinerContext, function (importedTokens) {\n      importedTokens = wrapInMedia(importedTokens, mediaQuery, metadata);\n      inlinerContext.outputTokens = inlinerContext.outputTokens.concat(importedTokens);\n      inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n      return doInlineImports(inlinerContext);\n    });\n  }\n\n  inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n  return doInlineImports(inlinerContext);\n}\n\nfunction wrapInMedia(tokens, mediaQuery, metadata) {\n  if (mediaQuery) {\n    return [[Token.NESTED_BLOCK, [[Token.NESTED_BLOCK_SCOPE, '@media ' + mediaQuery, metadata]], tokens]];\n  } else {\n    return tokens;\n  }\n}\n\nmodule.exports = readSources;","map":{"version":3,"sources":["/Users/nguyenquytoan/Desktop/PTUDW-17TN-Nhom05-USFL/react-usfl/PTUDW-17TN-Nhom05/node_modules/clean-css/lib/reader/read-sources.js"],"names":["fs","require","path","applySourceMaps","extractImportUrlAndMedia","isAllowedResource","loadOriginalSources","normalizePath","rebase","rebaseLocalMap","rebaseRemoteMap","restoreImport","tokenize","Token","Marker","hasProtocol","isImport","isRemoteResource","UNKNOWN_URI","readSources","input","context","callback","doReadSources","tokens","fromString","Buffer","isBuffer","toString","Array","isArray","fromArray","fromHash","source","undefined","sourcesContent","stats","originalSize","length","fromStyles","inline","options","inputAsImports","reduce","accumulator","uriOrHash","addStringSource","addHashSource","join","imports","push","restoreAsImport","normalizeUri","uri","normalizedUri","styles","sourceMap","trackSourceMap","currentPath","resolve","absoluteUri","relativeToCurrentPath","isAbsolute","relative","parsedMap","JSON","parse","rebasedMap","rebaseTo","inputSourceMapTracker","track","SEMICOLON","parentInlinerContext","rebaseConfig","fromBase","toBase","dirname","validator","allowsAnyImports","externalContext","inlinerContext","afterContent","errors","fetch","inlinedStylesheets","inlineRequest","inlineTimeout","isRemote","localOnly","outputTokens","sourceTokens","warnings","doInlineImports","token","i","l","AT_RULE","splice","inlineStylesheet","COMMENT","uriAndMediaQuery","mediaQuery","metadata","inlineRemoteStylesheet","inlineLocalStylesheet","isAllowed","originalUri","isLoaded","isRuntimeResource","indexOf","slice","concat","whenLoaded","error","importedStyles","process","nextTick","importedTokens","wrapInMedia","substring","normalizedPath","existsSync","statSync","isFile","readFileSync","NESTED_BLOCK","NESTED_BLOCK_SCOPE","module","exports"],"mappings":"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","sourcesContent":["var fs = require('fs');\nvar path = require('path');\n\nvar applySourceMaps = require('./apply-source-maps');\nvar extractImportUrlAndMedia = require('./extract-import-url-and-media');\nvar isAllowedResource = require('./is-allowed-resource');\nvar loadOriginalSources = require('./load-original-sources');\nvar normalizePath = require('./normalize-path');\nvar rebase = require('./rebase');\nvar rebaseLocalMap = require('./rebase-local-map');\nvar rebaseRemoteMap = require('./rebase-remote-map');\nvar restoreImport = require('./restore-import');\n\nvar tokenize = require('../tokenizer/tokenize');\nvar Token = require('../tokenizer/token');\nvar Marker = require('../tokenizer/marker');\nvar hasProtocol = require('../utils/has-protocol');\nvar isImport = require('../utils/is-import');\nvar isRemoteResource = require('../utils/is-remote-resource');\n\nvar UNKNOWN_URI = 'uri:unknown';\n\nfunction readSources(input, context, callback) {\n  return doReadSources(input, context, function (tokens) {\n    return applySourceMaps(tokens, context, function () {\n      return loadOriginalSources(context, function () { return callback(tokens); });\n    });\n  });\n}\n\nfunction doReadSources(input, context, callback) {\n  if (typeof input == 'string') {\n    return fromString(input, context, callback);\n  } else if (Buffer.isBuffer(input)) {\n    return fromString(input.toString(), context, callback);\n  } else if (Array.isArray(input)) {\n    return fromArray(input, context, callback);\n  } else if (typeof input == 'object') {\n    return fromHash(input, context, callback);\n  }\n}\n\nfunction fromString(input, context, callback) {\n  context.source = undefined;\n  context.sourcesContent[undefined] = input;\n  context.stats.originalSize += input.length;\n\n  return fromStyles(input, context, { inline: context.options.inline }, callback);\n}\n\nfunction fromArray(input, context, callback) {\n  var inputAsImports = input.reduce(function (accumulator, uriOrHash) {\n    if (typeof uriOrHash === 'string') {\n      return addStringSource(uriOrHash, accumulator);\n    } else {\n      return addHashSource(uriOrHash, context, accumulator);\n    }\n\n  }, []);\n\n  return fromStyles(inputAsImports.join(''), context, { inline: ['all'] }, callback);\n}\n\nfunction fromHash(input, context, callback) {\n  var inputAsImports = addHashSource(input, context, []);\n  return fromStyles(inputAsImports.join(''), context, { inline: ['all'] }, callback);\n}\n\nfunction addStringSource(input, imports) {\n  imports.push(restoreAsImport(normalizeUri(input)));\n  return imports;\n}\n\nfunction addHashSource(input, context, imports) {\n  var uri;\n  var normalizedUri;\n  var source;\n\n  for (uri in input) {\n    source = input[uri];\n    normalizedUri = normalizeUri(uri);\n\n    imports.push(restoreAsImport(normalizedUri));\n\n    context.sourcesContent[normalizedUri] = source.styles;\n\n    if (source.sourceMap) {\n      trackSourceMap(source.sourceMap, normalizedUri, context);\n    }\n  }\n\n  return imports;\n}\n\nfunction normalizeUri(uri) {\n  var currentPath = path.resolve('');\n  var absoluteUri;\n  var relativeToCurrentPath;\n  var normalizedUri;\n\n  if (isRemoteResource(uri)) {\n    return uri;\n  }\n\n  absoluteUri = path.isAbsolute(uri) ?\n    uri :\n    path.resolve(uri);\n  relativeToCurrentPath = path.relative(currentPath, absoluteUri);\n  normalizedUri = normalizePath(relativeToCurrentPath);\n\n  return normalizedUri;\n}\n\nfunction trackSourceMap(sourceMap, uri, context) {\n  var parsedMap = typeof sourceMap == 'string' ?\n      JSON.parse(sourceMap) :\n      sourceMap;\n  var rebasedMap = isRemoteResource(uri) ?\n    rebaseRemoteMap(parsedMap, uri) :\n    rebaseLocalMap(parsedMap, uri || UNKNOWN_URI, context.options.rebaseTo);\n\n  context.inputSourceMapTracker.track(uri, rebasedMap);\n}\n\nfunction restoreAsImport(uri) {\n  return restoreImport('url(' + uri + ')', '') + Marker.SEMICOLON;\n}\n\nfunction fromStyles(styles, context, parentInlinerContext, callback) {\n  var tokens;\n  var rebaseConfig = {};\n\n  if (!context.source) {\n    rebaseConfig.fromBase = path.resolve('');\n    rebaseConfig.toBase = context.options.rebaseTo;\n  } else if (isRemoteResource(context.source)) {\n    rebaseConfig.fromBase = context.source;\n    rebaseConfig.toBase = context.source;\n  } else if (path.isAbsolute(context.source)) {\n    rebaseConfig.fromBase = path.dirname(context.source);\n    rebaseConfig.toBase = context.options.rebaseTo;\n  } else {\n    rebaseConfig.fromBase = path.dirname(path.resolve(context.source));\n    rebaseConfig.toBase = context.options.rebaseTo;\n  }\n\n  tokens = tokenize(styles, context);\n  tokens = rebase(tokens, context.options.rebase, context.validator, rebaseConfig);\n\n  return allowsAnyImports(parentInlinerContext.inline) ?\n    inline(tokens, context, parentInlinerContext, callback) :\n    callback(tokens);\n}\n\nfunction allowsAnyImports(inline) {\n  return !(inline.length == 1 && inline[0] == 'none');\n}\n\nfunction inline(tokens, externalContext, parentInlinerContext, callback) {\n  var inlinerContext = {\n    afterContent: false,\n    callback: callback,\n    errors: externalContext.errors,\n    externalContext: externalContext,\n    fetch: externalContext.options.fetch,\n    inlinedStylesheets: parentInlinerContext.inlinedStylesheets || externalContext.inlinedStylesheets,\n    inline: parentInlinerContext.inline,\n    inlineRequest: externalContext.options.inlineRequest,\n    inlineTimeout: externalContext.options.inlineTimeout,\n    isRemote: parentInlinerContext.isRemote || false,\n    localOnly: externalContext.localOnly,\n    outputTokens: [],\n    rebaseTo: externalContext.options.rebaseTo,\n    sourceTokens: tokens,\n    warnings: externalContext.warnings\n  };\n\n  return doInlineImports(inlinerContext);\n}\n\nfunction doInlineImports(inlinerContext) {\n  var token;\n  var i, l;\n\n  for (i = 0, l = inlinerContext.sourceTokens.length; i < l; i++) {\n    token = inlinerContext.sourceTokens[i];\n\n    if (token[0] == Token.AT_RULE && isImport(token[1])) {\n      inlinerContext.sourceTokens.splice(0, i);\n      return inlineStylesheet(token, inlinerContext);\n    } else if (token[0] == Token.AT_RULE || token[0] == Token.COMMENT) {\n      inlinerContext.outputTokens.push(token);\n    } else {\n      inlinerContext.outputTokens.push(token);\n      inlinerContext.afterContent = true;\n    }\n  }\n\n  inlinerContext.sourceTokens = [];\n  return inlinerContext.callback(inlinerContext.outputTokens);\n}\n\nfunction inlineStylesheet(token, inlinerContext) {\n  var uriAndMediaQuery = extractImportUrlAndMedia(token[1]);\n  var uri = uriAndMediaQuery[0];\n  var mediaQuery = uriAndMediaQuery[1];\n  var metadata = token[2];\n\n  return isRemoteResource(uri) ?\n    inlineRemoteStylesheet(uri, mediaQuery, metadata, inlinerContext) :\n    inlineLocalStylesheet(uri, mediaQuery, metadata, inlinerContext);\n}\n\nfunction inlineRemoteStylesheet(uri, mediaQuery, metadata, inlinerContext) {\n  var isAllowed = isAllowedResource(uri, true, inlinerContext.inline);\n  var originalUri = uri;\n  var isLoaded = uri in inlinerContext.externalContext.sourcesContent;\n  var isRuntimeResource = !hasProtocol(uri);\n\n  if (inlinerContext.inlinedStylesheets.indexOf(uri) > -1) {\n    inlinerContext.warnings.push('Ignoring remote @import of \"' + uri + '\" as it has already been imported.');\n    inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n    return doInlineImports(inlinerContext);\n  } else if (inlinerContext.localOnly && inlinerContext.afterContent) {\n    inlinerContext.warnings.push('Ignoring remote @import of \"' + uri + '\" as no callback given and after other content.');\n    inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n    return doInlineImports(inlinerContext);\n  } else if (isRuntimeResource) {\n    inlinerContext.warnings.push('Skipping remote @import of \"' + uri + '\" as no protocol given.');\n    inlinerContext.outputTokens = inlinerContext.outputTokens.concat(inlinerContext.sourceTokens.slice(0, 1));\n    inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n    return doInlineImports(inlinerContext);\n  } else if (inlinerContext.localOnly && !isLoaded) {\n    inlinerContext.warnings.push('Skipping remote @import of \"' + uri + '\" as no callback given.');\n    inlinerContext.outputTokens = inlinerContext.outputTokens.concat(inlinerContext.sourceTokens.slice(0, 1));\n    inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n    return doInlineImports(inlinerContext);\n  } else if (!isAllowed && inlinerContext.afterContent) {\n    inlinerContext.warnings.push('Ignoring remote @import of \"' + uri + '\" as resource is not allowed and after other content.');\n    inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n    return doInlineImports(inlinerContext);\n  } else if (!isAllowed) {\n    inlinerContext.warnings.push('Skipping remote @import of \"' + uri + '\" as resource is not allowed.');\n    inlinerContext.outputTokens = inlinerContext.outputTokens.concat(inlinerContext.sourceTokens.slice(0, 1));\n    inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n    return doInlineImports(inlinerContext);\n  }\n\n  inlinerContext.inlinedStylesheets.push(uri);\n\n  function whenLoaded(error, importedStyles) {\n    if (error) {\n      inlinerContext.errors.push('Broken @import declaration of \"' + uri + '\" - ' + error);\n\n      return process.nextTick(function () {\n        inlinerContext.outputTokens = inlinerContext.outputTokens.concat(inlinerContext.sourceTokens.slice(0, 1));\n        inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n        doInlineImports(inlinerContext);\n      });\n    }\n\n    inlinerContext.inline = inlinerContext.externalContext.options.inline;\n    inlinerContext.isRemote = true;\n\n    inlinerContext.externalContext.source = originalUri;\n    inlinerContext.externalContext.sourcesContent[uri] = importedStyles;\n    inlinerContext.externalContext.stats.originalSize += importedStyles.length;\n\n    return fromStyles(importedStyles, inlinerContext.externalContext, inlinerContext, function (importedTokens) {\n      importedTokens = wrapInMedia(importedTokens, mediaQuery, metadata);\n\n      inlinerContext.outputTokens = inlinerContext.outputTokens.concat(importedTokens);\n      inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n\n      return doInlineImports(inlinerContext);\n    });\n  }\n\n  return isLoaded ?\n    whenLoaded(null, inlinerContext.externalContext.sourcesContent[uri]) :\n    inlinerContext.fetch(uri, inlinerContext.inlineRequest, inlinerContext.inlineTimeout, whenLoaded);\n}\n\nfunction inlineLocalStylesheet(uri, mediaQuery, metadata, inlinerContext) {\n  var currentPath = path.resolve('');\n  var absoluteUri = path.isAbsolute(uri) ?\n    path.resolve(currentPath, uri[0] == '/' ? uri.substring(1) : uri) :\n    path.resolve(inlinerContext.rebaseTo, uri);\n  var relativeToCurrentPath = path.relative(currentPath, absoluteUri);\n  var importedStyles;\n  var isAllowed = isAllowedResource(uri, false, inlinerContext.inline);\n  var normalizedPath = normalizePath(relativeToCurrentPath);\n  var isLoaded = normalizedPath in inlinerContext.externalContext.sourcesContent;\n\n  if (inlinerContext.inlinedStylesheets.indexOf(absoluteUri) > -1) {\n    inlinerContext.warnings.push('Ignoring local @import of \"' + uri + '\" as it has already been imported.');\n  } else if (!isLoaded && (!fs.existsSync(absoluteUri) || !fs.statSync(absoluteUri).isFile())) {\n    inlinerContext.errors.push('Ignoring local @import of \"' + uri + '\" as resource is missing.');\n  } else if (!isAllowed && inlinerContext.afterContent) {\n    inlinerContext.warnings.push('Ignoring local @import of \"' + uri + '\" as resource is not allowed and after other content.');\n  } else if (inlinerContext.afterContent) {\n    inlinerContext.warnings.push('Ignoring local @import of \"' + uri + '\" as after other content.');\n  } else if (!isAllowed) {\n    inlinerContext.warnings.push('Skipping local @import of \"' + uri + '\" as resource is not allowed.');\n    inlinerContext.outputTokens = inlinerContext.outputTokens.concat(inlinerContext.sourceTokens.slice(0, 1));\n  } else {\n    importedStyles = isLoaded ?\n      inlinerContext.externalContext.sourcesContent[normalizedPath] :\n      fs.readFileSync(absoluteUri, 'utf-8');\n\n    inlinerContext.inlinedStylesheets.push(absoluteUri);\n    inlinerContext.inline = inlinerContext.externalContext.options.inline;\n\n    inlinerContext.externalContext.source = normalizedPath;\n    inlinerContext.externalContext.sourcesContent[normalizedPath] = importedStyles;\n    inlinerContext.externalContext.stats.originalSize += importedStyles.length;\n\n    return fromStyles(importedStyles, inlinerContext.externalContext, inlinerContext, function (importedTokens) {\n      importedTokens = wrapInMedia(importedTokens, mediaQuery, metadata);\n\n      inlinerContext.outputTokens = inlinerContext.outputTokens.concat(importedTokens);\n      inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n\n      return doInlineImports(inlinerContext);\n    });\n  }\n\n  inlinerContext.sourceTokens = inlinerContext.sourceTokens.slice(1);\n\n  return doInlineImports(inlinerContext);\n}\n\nfunction wrapInMedia(tokens, mediaQuery, metadata) {\n  if (mediaQuery) {\n    return [[Token.NESTED_BLOCK, [[Token.NESTED_BLOCK_SCOPE, '@media ' + mediaQuery, metadata]], tokens]];\n  } else {\n    return tokens;\n  }\n}\n\nmodule.exports = readSources;\n"]},"metadata":{},"sourceType":"script"}