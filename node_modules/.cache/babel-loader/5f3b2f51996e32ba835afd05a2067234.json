{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Subject_1 = require(\"../Subject\");\n\nvar Subscription_1 = require(\"../Subscription\");\n\nvar OuterSubscriber_1 = require(\"../OuterSubscriber\");\n\nvar subscribeToResult_1 = require(\"../util/subscribeToResult\");\n\nfunction windowToggle(openings, closingSelector) {\n  return function (source) {\n    return source.lift(new WindowToggleOperator(openings, closingSelector));\n  };\n}\n\nexports.windowToggle = windowToggle;\n\nvar WindowToggleOperator = function () {\n  function WindowToggleOperator(openings, closingSelector) {\n    this.openings = openings;\n    this.closingSelector = closingSelector;\n  }\n\n  WindowToggleOperator.prototype.call = function (subscriber, source) {\n    return source.subscribe(new WindowToggleSubscriber(subscriber, this.openings, this.closingSelector));\n  };\n\n  return WindowToggleOperator;\n}();\n\nvar WindowToggleSubscriber = function (_super) {\n  __extends(WindowToggleSubscriber, _super);\n\n  function WindowToggleSubscriber(destination, openings, closingSelector) {\n    var _this = _super.call(this, destination) || this;\n\n    _this.openings = openings;\n    _this.closingSelector = closingSelector;\n    _this.contexts = [];\n\n    _this.add(_this.openSubscription = subscribeToResult_1.subscribeToResult(_this, openings, openings));\n\n    return _this;\n  }\n\n  WindowToggleSubscriber.prototype._next = function (value) {\n    var contexts = this.contexts;\n\n    if (contexts) {\n      var len = contexts.length;\n\n      for (var i = 0; i < len; i++) {\n        contexts[i].window.next(value);\n      }\n    }\n  };\n\n  WindowToggleSubscriber.prototype._error = function (err) {\n    var contexts = this.contexts;\n    this.contexts = null;\n\n    if (contexts) {\n      var len = contexts.length;\n      var index = -1;\n\n      while (++index < len) {\n        var context_1 = contexts[index];\n        context_1.window.error(err);\n        context_1.subscription.unsubscribe();\n      }\n    }\n\n    _super.prototype._error.call(this, err);\n  };\n\n  WindowToggleSubscriber.prototype._complete = function () {\n    var contexts = this.contexts;\n    this.contexts = null;\n\n    if (contexts) {\n      var len = contexts.length;\n      var index = -1;\n\n      while (++index < len) {\n        var context_2 = contexts[index];\n        context_2.window.complete();\n        context_2.subscription.unsubscribe();\n      }\n    }\n\n    _super.prototype._complete.call(this);\n  };\n\n  WindowToggleSubscriber.prototype._unsubscribe = function () {\n    var contexts = this.contexts;\n    this.contexts = null;\n\n    if (contexts) {\n      var len = contexts.length;\n      var index = -1;\n\n      while (++index < len) {\n        var context_3 = contexts[index];\n        context_3.window.unsubscribe();\n        context_3.subscription.unsubscribe();\n      }\n    }\n  };\n\n  WindowToggleSubscriber.prototype.notifyNext = function (outerValue, innerValue, outerIndex, innerIndex, innerSub) {\n    if (outerValue === this.openings) {\n      var closingNotifier = void 0;\n\n      try {\n        var closingSelector = this.closingSelector;\n        closingNotifier = closingSelector(innerValue);\n      } catch (e) {\n        return this.error(e);\n      }\n\n      var window_1 = new Subject_1.Subject();\n      var subscription = new Subscription_1.Subscription();\n      var context_4 = {\n        window: window_1,\n        subscription: subscription\n      };\n      this.contexts.push(context_4);\n      var innerSubscription = subscribeToResult_1.subscribeToResult(this, closingNotifier, context_4);\n\n      if (innerSubscription.closed) {\n        this.closeWindow(this.contexts.length - 1);\n      } else {\n        innerSubscription.context = context_4;\n        subscription.add(innerSubscription);\n      }\n\n      this.destination.next(window_1);\n    } else {\n      this.closeWindow(this.contexts.indexOf(outerValue));\n    }\n  };\n\n  WindowToggleSubscriber.prototype.notifyError = function (err) {\n    this.error(err);\n  };\n\n  WindowToggleSubscriber.prototype.notifyComplete = function (inner) {\n    if (inner !== this.openSubscription) {\n      this.closeWindow(this.contexts.indexOf(inner.context));\n    }\n  };\n\n  WindowToggleSubscriber.prototype.closeWindow = function (index) {\n    if (index === -1) {\n      return;\n    }\n\n    var contexts = this.contexts;\n    var context = contexts[index];\n    var window = context.window,\n        subscription = context.subscription;\n    contexts.splice(index, 1);\n    window.complete();\n    subscription.unsubscribe();\n  };\n\n  return WindowToggleSubscriber;\n}(OuterSubscriber_1.OuterSubscriber);","map":{"version":3,"sources":["../../src/internal/operators/windowToggle.ts"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Subject_1 = require(\"../Subject\");\nvar Subscription_1 = require(\"../Subscription\");\nvar OuterSubscriber_1 = require(\"../OuterSubscriber\");\nvar subscribeToResult_1 = require(\"../util/subscribeToResult\");\nfunction windowToggle(openings, closingSelector) {\n    return function (source) { return source.lift(new WindowToggleOperator(openings, closingSelector)); };\n}\nexports.windowToggle = windowToggle;\nvar WindowToggleOperator = (function () {\n    function WindowToggleOperator(openings, closingSelector) {\n        this.openings = openings;\n        this.closingSelector = closingSelector;\n    }\n    WindowToggleOperator.prototype.call = function (subscriber, source) {\n        return source.subscribe(new WindowToggleSubscriber(subscriber, this.openings, this.closingSelector));\n    };\n    return WindowToggleOperator;\n}());\nvar WindowToggleSubscriber = (function (_super) {\n    __extends(WindowToggleSubscriber, _super);\n    function WindowToggleSubscriber(destination, openings, closingSelector) {\n        var _this = _super.call(this, destination) || this;\n        _this.openings = openings;\n        _this.closingSelector = closingSelector;\n        _this.contexts = [];\n        _this.add(_this.openSubscription = subscribeToResult_1.subscribeToResult(_this, openings, openings));\n        return _this;\n    }\n    WindowToggleSubscriber.prototype._next = function (value) {\n        var contexts = this.contexts;\n        if (contexts) {\n            var len = contexts.length;\n            for (var i = 0; i < len; i++) {\n                contexts[i].window.next(value);\n            }\n        }\n    };\n    WindowToggleSubscriber.prototype._error = function (err) {\n        var contexts = this.contexts;\n        this.contexts = null;\n        if (contexts) {\n            var len = contexts.length;\n            var index = -1;\n            while (++index < len) {\n                var context_1 = contexts[index];\n                context_1.window.error(err);\n                context_1.subscription.unsubscribe();\n            }\n        }\n        _super.prototype._error.call(this, err);\n    };\n    WindowToggleSubscriber.prototype._complete = function () {\n        var contexts = this.contexts;\n        this.contexts = null;\n        if (contexts) {\n            var len = contexts.length;\n            var index = -1;\n            while (++index < len) {\n                var context_2 = contexts[index];\n                context_2.window.complete();\n                context_2.subscription.unsubscribe();\n            }\n        }\n        _super.prototype._complete.call(this);\n    };\n    WindowToggleSubscriber.prototype._unsubscribe = function () {\n        var contexts = this.contexts;\n        this.contexts = null;\n        if (contexts) {\n            var len = contexts.length;\n            var index = -1;\n            while (++index < len) {\n                var context_3 = contexts[index];\n                context_3.window.unsubscribe();\n                context_3.subscription.unsubscribe();\n            }\n        }\n    };\n    WindowToggleSubscriber.prototype.notifyNext = function (outerValue, innerValue, outerIndex, innerIndex, innerSub) {\n        if (outerValue === this.openings) {\n            var closingNotifier = void 0;\n            try {\n                var closingSelector = this.closingSelector;\n                closingNotifier = closingSelector(innerValue);\n            }\n            catch (e) {\n                return this.error(e);\n            }\n            var window_1 = new Subject_1.Subject();\n            var subscription = new Subscription_1.Subscription();\n            var context_4 = { window: window_1, subscription: subscription };\n            this.contexts.push(context_4);\n            var innerSubscription = subscribeToResult_1.subscribeToResult(this, closingNotifier, context_4);\n            if (innerSubscription.closed) {\n                this.closeWindow(this.contexts.length - 1);\n            }\n            else {\n                innerSubscription.context = context_4;\n                subscription.add(innerSubscription);\n            }\n            this.destination.next(window_1);\n        }\n        else {\n            this.closeWindow(this.contexts.indexOf(outerValue));\n        }\n    };\n    WindowToggleSubscriber.prototype.notifyError = function (err) {\n        this.error(err);\n    };\n    WindowToggleSubscriber.prototype.notifyComplete = function (inner) {\n        if (inner !== this.openSubscription) {\n            this.closeWindow(this.contexts.indexOf(inner.context));\n        }\n    };\n    WindowToggleSubscriber.prototype.closeWindow = function (index) {\n        if (index === -1) {\n            return;\n        }\n        var contexts = this.contexts;\n        var context = contexts[index];\n        var window = context.window, subscription = context.subscription;\n        contexts.splice(index, 1);\n        window.complete();\n        subscription.unsubscribe();\n    };\n    return WindowToggleSubscriber;\n}(OuterSubscriber_1.OuterSubscriber));\n//# sourceMappingURL=windowToggle.js.map"]},"metadata":{},"sourceType":"script"}