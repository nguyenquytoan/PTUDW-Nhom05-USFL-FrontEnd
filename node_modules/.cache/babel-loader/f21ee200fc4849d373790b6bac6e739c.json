{"ast":null,"code":"var path = require('path');\n\nvar fs = require('fs');\n\nvar test = require('tape');\n\nvar map = require('array.prototype.map');\n\nvar resolve = require('../');\n\nvar symlinkDir = path.join(__dirname, 'resolver', 'symlinked', 'symlink');\nvar packageDir = path.join(__dirname, 'resolver', 'symlinked', '_', 'node_modules', 'package');\nvar modADir = path.join(__dirname, 'symlinks', 'source', 'node_modules', 'mod-a');\nvar symlinkModADir = path.join(__dirname, 'symlinks', 'dest', 'node_modules', 'mod-a');\n\ntry {\n  fs.unlinkSync(symlinkDir);\n} catch (err) {}\n\ntry {\n  fs.unlinkSync(packageDir);\n} catch (err) {}\n\ntry {\n  fs.unlinkSync(modADir);\n} catch (err) {}\n\ntry {\n  fs.unlinkSync(symlinkModADir);\n} catch (err) {}\n\ntry {\n  fs.symlinkSync('./_/symlink_target', symlinkDir, 'dir');\n} catch (err) {\n  // if fails then it is probably on Windows and lets try to create a junction\n  fs.symlinkSync(path.join(__dirname, 'resolver', 'symlinked', '_', 'symlink_target') + '\\\\', symlinkDir, 'junction');\n}\n\ntry {\n  fs.symlinkSync('../../package', packageDir, 'dir');\n} catch (err) {\n  // if fails then it is probably on Windows and lets try to create a junction\n  fs.symlinkSync(path.join(__dirname, '..', '..', 'package') + '\\\\', packageDir, 'junction');\n}\n\ntry {\n  fs.symlinkSync('../../source/node_modules/mod-a', symlinkModADir, 'dir');\n} catch (err) {\n  // if fails then it is probably on Windows and lets try to create a junction\n  fs.symlinkSync(path.join(__dirname, '..', '..', 'source', 'node_modules', 'mod-a') + '\\\\', symlinkModADir, 'junction');\n}\n\ntest('symlink', function (t) {\n  t.plan(2);\n  resolve('foo', {\n    basedir: symlinkDir,\n    preserveSymlinks: false\n  }, function (err, res, pkg) {\n    t.error(err);\n    t.equal(res, path.join(__dirname, 'resolver', 'symlinked', '_', 'node_modules', 'foo.js'));\n  });\n});\ntest('sync symlink when preserveSymlinks = true', function (t) {\n  t.plan(4);\n  resolve('foo', {\n    basedir: symlinkDir\n  }, function (err, res, pkg) {\n    t.ok(err, 'there is an error');\n    t.notOk(res, 'no result');\n    t.equal(err && err.code, 'MODULE_NOT_FOUND', 'error code matches require.resolve');\n    t.equal(err && err.message, 'Cannot find module \\'foo\\' from \\'' + symlinkDir + '\\'', 'can not find nonexistent module');\n  });\n});\ntest('sync symlink', function (t) {\n  var start = new Date();\n  t.doesNotThrow(function () {\n    t.equal(resolve.sync('foo', {\n      basedir: symlinkDir,\n      preserveSymlinks: false\n    }), path.join(__dirname, 'resolver', 'symlinked', '_', 'node_modules', 'foo.js'));\n  });\n  t.ok(new Date() - start < 50, 'resolve.sync timedout');\n  t.end();\n});\ntest('sync symlink when preserveSymlinks = true', function (t) {\n  t.throws(function () {\n    resolve.sync('foo', {\n      basedir: symlinkDir\n    });\n  }, /Cannot find module 'foo'/);\n  t.end();\n});\ntest('sync symlink from node_modules to other dir when preserveSymlinks = false', function (t) {\n  var basedir = path.join(__dirname, 'resolver', 'symlinked', '_');\n  var fn = resolve.sync('package', {\n    basedir: basedir,\n    preserveSymlinks: false\n  });\n  t.equal(fn, path.resolve(__dirname, 'resolver/symlinked/package/bar.js'));\n  t.end();\n});\ntest('async symlink from node_modules to other dir when preserveSymlinks = false', function (t) {\n  t.plan(2);\n  var basedir = path.join(__dirname, 'resolver', 'symlinked', '_');\n  resolve('package', {\n    basedir: basedir,\n    preserveSymlinks: false\n  }, function (err, result) {\n    t.notOk(err, 'no error');\n    t.equal(result, path.resolve(__dirname, 'resolver/symlinked/package/bar.js'));\n  });\n});\ntest('packageFilter', function (t) {\n  function relative(x) {\n    return path.relative(__dirname, x);\n  }\n\n  function testPackageFilter(preserveSymlinks) {\n    return function (st) {\n      st.plan('is 1.x' ? 3 : 5); // eslint-disable-line no-constant-condition\n\n      var destMain = 'symlinks/dest/node_modules/mod-a/index.js';\n      var destPkg = 'symlinks/dest/node_modules/mod-a/package.json';\n      var sourceMain = 'symlinks/source/node_modules/mod-a/index.js';\n      var sourcePkg = 'symlinks/source/node_modules/mod-a/package.json';\n      var destDir = path.join(__dirname, 'symlinks', 'dest');\n      /* eslint multiline-comment-style: 0 */\n\n      /* v2.x will restore these tests\n      var packageFilterPath = [];\n      var actualPath = resolve.sync('mod-a', {\n          basedir: destDir,\n          preserveSymlinks: preserveSymlinks,\n          packageFilter: function (pkg, pkgfile, dir) {\n              packageFilterPath.push(pkgfile);\n          }\n      });\n      st.equal(\n          relative(actualPath),\n          path.normalize(preserveSymlinks ? destMain : sourceMain),\n          'sync: actual path is correct'\n      );\n      st.deepEqual(\n          map(packageFilterPath, relative),\n          map(preserveSymlinks ? [destPkg, destPkg] : [sourcePkg, sourcePkg], path.normalize),\n          'sync: packageFilter pkgfile arg is correct'\n      );\n      */\n\n      var asyncPackageFilterPath = [];\n      resolve('mod-a', {\n        basedir: destDir,\n        preserveSymlinks: preserveSymlinks,\n        packageFilter: function (pkg, pkgfile) {\n          asyncPackageFilterPath.push(pkgfile);\n        }\n      }, function (err, actualPath) {\n        st.error(err, 'no error');\n        st.equal(relative(actualPath), path.normalize(preserveSymlinks ? destMain : sourceMain), 'async: actual path is correct');\n        st.deepEqual(map(asyncPackageFilterPath, relative), map(preserveSymlinks ? [destPkg, destPkg, destPkg] : [sourcePkg, sourcePkg, sourcePkg], path.normalize), 'async: packageFilter pkgfile arg is correct');\n      });\n    };\n  }\n\n  t.test('preserveSymlinks: false', testPackageFilter(false));\n  t.test('preserveSymlinks: true', testPackageFilter(true));\n  t.end();\n});","map":{"version":3,"sources":["/Users/nguyenquytoan/Desktop/PTUDW-17TN-Nhom05-USFL/react-usfl/PTUDW-17TN-Nhom05/node_modules/resolve/test/symlinks.js"],"names":["path","require","fs","test","map","resolve","symlinkDir","join","__dirname","packageDir","modADir","symlinkModADir","unlinkSync","err","symlinkSync","t","plan","basedir","preserveSymlinks","res","pkg","error","equal","ok","notOk","code","message","start","Date","doesNotThrow","sync","end","throws","fn","result","relative","x","testPackageFilter","st","destMain","destPkg","sourceMain","sourcePkg","destDir","asyncPackageFilterPath","packageFilter","pkgfile","push","actualPath","normalize","deepEqual"],"mappings":"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","sourcesContent":["var path = require('path');\nvar fs = require('fs');\nvar test = require('tape');\nvar map = require('array.prototype.map');\nvar resolve = require('../');\n\nvar symlinkDir = path.join(__dirname, 'resolver', 'symlinked', 'symlink');\nvar packageDir = path.join(__dirname, 'resolver', 'symlinked', '_', 'node_modules', 'package');\nvar modADir = path.join(__dirname, 'symlinks', 'source', 'node_modules', 'mod-a');\nvar symlinkModADir = path.join(__dirname, 'symlinks', 'dest', 'node_modules', 'mod-a');\ntry {\n    fs.unlinkSync(symlinkDir);\n} catch (err) {}\ntry {\n    fs.unlinkSync(packageDir);\n} catch (err) {}\ntry {\n    fs.unlinkSync(modADir);\n} catch (err) {}\ntry {\n    fs.unlinkSync(symlinkModADir);\n} catch (err) {}\n\ntry {\n    fs.symlinkSync('./_/symlink_target', symlinkDir, 'dir');\n} catch (err) {\n    // if fails then it is probably on Windows and lets try to create a junction\n    fs.symlinkSync(path.join(__dirname, 'resolver', 'symlinked', '_', 'symlink_target') + '\\\\', symlinkDir, 'junction');\n}\ntry {\n    fs.symlinkSync('../../package', packageDir, 'dir');\n} catch (err) {\n    // if fails then it is probably on Windows and lets try to create a junction\n    fs.symlinkSync(path.join(__dirname, '..', '..', 'package') + '\\\\', packageDir, 'junction');\n}\ntry {\n    fs.symlinkSync('../../source/node_modules/mod-a', symlinkModADir, 'dir');\n} catch (err) {\n    // if fails then it is probably on Windows and lets try to create a junction\n    fs.symlinkSync(path.join(__dirname, '..', '..', 'source', 'node_modules', 'mod-a') + '\\\\', symlinkModADir, 'junction');\n}\n\ntest('symlink', function (t) {\n    t.plan(2);\n\n    resolve('foo', { basedir: symlinkDir, preserveSymlinks: false }, function (err, res, pkg) {\n        t.error(err);\n        t.equal(res, path.join(__dirname, 'resolver', 'symlinked', '_', 'node_modules', 'foo.js'));\n    });\n});\n\ntest('sync symlink when preserveSymlinks = true', function (t) {\n    t.plan(4);\n\n    resolve('foo', { basedir: symlinkDir }, function (err, res, pkg) {\n        t.ok(err, 'there is an error');\n        t.notOk(res, 'no result');\n\n        t.equal(err && err.code, 'MODULE_NOT_FOUND', 'error code matches require.resolve');\n        t.equal(\n            err && err.message,\n            'Cannot find module \\'foo\\' from \\'' + symlinkDir + '\\'',\n            'can not find nonexistent module'\n        );\n    });\n});\n\ntest('sync symlink', function (t) {\n    var start = new Date();\n    t.doesNotThrow(function () {\n        t.equal(resolve.sync('foo', { basedir: symlinkDir, preserveSymlinks: false }), path.join(__dirname, 'resolver', 'symlinked', '_', 'node_modules', 'foo.js'));\n    });\n    t.ok(new Date() - start < 50, 'resolve.sync timedout');\n    t.end();\n});\n\ntest('sync symlink when preserveSymlinks = true', function (t) {\n    t.throws(function () {\n        resolve.sync('foo', { basedir: symlinkDir });\n    }, /Cannot find module 'foo'/);\n    t.end();\n});\n\ntest('sync symlink from node_modules to other dir when preserveSymlinks = false', function (t) {\n    var basedir = path.join(__dirname, 'resolver', 'symlinked', '_');\n    var fn = resolve.sync('package', { basedir: basedir, preserveSymlinks: false });\n\n    t.equal(fn, path.resolve(__dirname, 'resolver/symlinked/package/bar.js'));\n    t.end();\n});\n\ntest('async symlink from node_modules to other dir when preserveSymlinks = false', function (t) {\n    t.plan(2);\n    var basedir = path.join(__dirname, 'resolver', 'symlinked', '_');\n    resolve('package', { basedir: basedir, preserveSymlinks: false }, function (err, result) {\n        t.notOk(err, 'no error');\n        t.equal(result, path.resolve(__dirname, 'resolver/symlinked/package/bar.js'));\n    });\n});\n\ntest('packageFilter', function (t) {\n    function relative(x) {\n        return path.relative(__dirname, x);\n    }\n\n    function testPackageFilter(preserveSymlinks) {\n        return function (st) {\n            st.plan('is 1.x' ? 3 : 5); // eslint-disable-line no-constant-condition\n\n            var destMain = 'symlinks/dest/node_modules/mod-a/index.js';\n            var destPkg = 'symlinks/dest/node_modules/mod-a/package.json';\n            var sourceMain = 'symlinks/source/node_modules/mod-a/index.js';\n            var sourcePkg = 'symlinks/source/node_modules/mod-a/package.json';\n            var destDir = path.join(__dirname, 'symlinks', 'dest');\n\n            /* eslint multiline-comment-style: 0 */\n            /* v2.x will restore these tests\n            var packageFilterPath = [];\n            var actualPath = resolve.sync('mod-a', {\n                basedir: destDir,\n                preserveSymlinks: preserveSymlinks,\n                packageFilter: function (pkg, pkgfile, dir) {\n                    packageFilterPath.push(pkgfile);\n                }\n            });\n            st.equal(\n                relative(actualPath),\n                path.normalize(preserveSymlinks ? destMain : sourceMain),\n                'sync: actual path is correct'\n            );\n            st.deepEqual(\n                map(packageFilterPath, relative),\n                map(preserveSymlinks ? [destPkg, destPkg] : [sourcePkg, sourcePkg], path.normalize),\n                'sync: packageFilter pkgfile arg is correct'\n            );\n            */\n\n            var asyncPackageFilterPath = [];\n            resolve(\n                'mod-a',\n                {\n                    basedir: destDir,\n                    preserveSymlinks: preserveSymlinks,\n                    packageFilter: function (pkg, pkgfile) {\n                        asyncPackageFilterPath.push(pkgfile);\n                    }\n                },\n                function (err, actualPath) {\n                    st.error(err, 'no error');\n                    st.equal(\n                        relative(actualPath),\n                        path.normalize(preserveSymlinks ? destMain : sourceMain),\n                        'async: actual path is correct'\n                    );\n                    st.deepEqual(\n                        map(asyncPackageFilterPath, relative),\n                        map(\n                            preserveSymlinks ? [destPkg, destPkg, destPkg] : [sourcePkg, sourcePkg, sourcePkg],\n                            path.normalize\n                        ),\n                        'async: packageFilter pkgfile arg is correct'\n                    );\n                }\n            );\n        };\n    }\n\n    t.test('preserveSymlinks: false', testPackageFilter(false));\n\n    t.test('preserveSymlinks: true', testPackageFilter(true));\n\n    t.end();\n});\n"]},"metadata":{},"sourceType":"script"}