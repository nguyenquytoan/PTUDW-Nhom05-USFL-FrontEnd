{"ast":null,"code":"'use strict';\n\nconst debug = require('debug')('detect-port');\n\nconst net = require('net');\n\nconst address = require('address');\n\nmodule.exports = (port, host, callback) => {\n  if (typeof port === 'function') {\n    callback = port;\n    port = null;\n  } else if (typeof host === 'function') {\n    callback = host;\n    host = null;\n  }\n\n  port = parseInt(port) || 0;\n  let maxPort = port + 10;\n\n  if (maxPort > 65535) {\n    maxPort = 65535;\n  }\n\n  debug('detect free port between [%s, %s)', port, maxPort);\n\n  if (typeof callback === 'function') {\n    return tryListen(host, port, maxPort, callback);\n  } // promise\n\n\n  return new Promise((resolve, reject) => {\n    tryListen(host, port, maxPort, (error, realPort) => {\n      if (error) {\n        reject(error);\n      } else {\n        resolve(realPort);\n      }\n    });\n  });\n};\n\nfunction tryListen(host, port, maxPort, callback) {\n  function handleError() {\n    port++;\n\n    if (port >= maxPort) {\n      debug('port: %s >= maxPort: %s, give up and use random port', port, maxPort);\n      port = 0;\n      maxPort = 0;\n    }\n\n    tryListen(host, port, maxPort, callback);\n  } // 1. check specified host (or null)\n\n\n  listen(port, host, (err, realPort) => {\n    // ignore random listening\n    if (port === 0) {\n      return callback(err, realPort);\n    }\n\n    if (err) {\n      return handleError(err);\n    } // 2. check default host\n\n\n    listen(port, null, err => {\n      if (err) {\n        return handleError(err);\n      } // 3. check localhost\n\n\n      listen(port, 'localhost', err => {\n        if (err) {\n          return handleError(err);\n        } // 4. check current ip\n\n\n        let ip;\n\n        try {\n          ip = address.ip();\n        } catch (err) {\n          // Skip the `ip` check if `address.ip()` fails\n          return callback(null, realPort);\n        }\n\n        listen(port, ip, (err, realPort) => {\n          if (err) {\n            return handleError(err);\n          }\n\n          callback(null, realPort);\n        });\n      });\n    });\n  });\n}\n\nfunction listen(port, hostname, callback) {\n  const server = new net.Server();\n  server.on('error', err => {\n    debug('listen %s:%s error: %s', hostname, port, err);\n    server.close();\n\n    if (err.code === 'ENOTFOUND') {\n      debug('ignore dns ENOTFOUND error, get free %s:%s', hostname, port);\n      return callback(null, port);\n    }\n\n    return callback(err);\n  });\n  server.listen(port, hostname, () => {\n    port = server.address().port;\n    server.close();\n    debug('get free %s:%s', hostname, port);\n    return callback(null, port);\n  });\n}","map":{"version":3,"sources":["/Users/nguyenquytoan/Desktop/PTUDW-17TN-Nhom05-USFL/react-usfl/PTUDW-17TN-Nhom05/node_modules/detect-port-alt/lib/detect-port.js"],"names":["debug","require","net","address","module","exports","port","host","callback","parseInt","maxPort","tryListen","Promise","resolve","reject","error","realPort","handleError","listen","err","ip","hostname","server","Server","on","close","code"],"mappings":"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","sourcesContent":["'use strict';\n\nconst debug = require('debug')('detect-port');\nconst net = require('net');\nconst address = require('address');\n\nmodule.exports = (port, host, callback) => {\n  if (typeof port === 'function') {\n    callback = port;\n    port = null;\n  } else if (typeof host === 'function') {\n    callback = host;\n    host = null;\n  }\n  port = parseInt(port) || 0;\n  let maxPort = port + 10;\n  if (maxPort > 65535) {\n    maxPort = 65535;\n  }\n  debug('detect free port between [%s, %s)', port, maxPort);\n  if (typeof callback === 'function') {\n    return tryListen(host, port, maxPort, callback);\n  }\n  // promise\n  return new Promise((resolve, reject) => {\n    tryListen(host, port, maxPort, (error, realPort) => {\n      if (error) {\n        reject(error);\n      } else {\n        resolve(realPort);\n      }\n    });\n  });\n};\n\nfunction tryListen(host, port, maxPort, callback) {\n  function handleError() {\n    port++;\n    if (port >= maxPort) {\n      debug(\n        'port: %s >= maxPort: %s, give up and use random port',\n        port,\n        maxPort\n      );\n      port = 0;\n      maxPort = 0;\n    }\n    tryListen(host, port, maxPort, callback);\n  }\n\n  // 1. check specified host (or null)\n  listen(port, host, (err, realPort) => {\n    // ignore random listening\n    if (port === 0) {\n      return callback(err, realPort);\n    }\n\n    if (err) {\n      return handleError(err);\n    }\n\n    // 2. check default host\n    listen(port, null, err => {\n      if (err) {\n        return handleError(err);\n      }\n\n      // 3. check localhost\n      listen(port, 'localhost', err => {\n        if (err) {\n          return handleError(err);\n        }\n\n        // 4. check current ip\n        let ip;\n        try {\n          ip = address.ip();\n        } catch (err) {\n          // Skip the `ip` check if `address.ip()` fails\n          return callback(null, realPort);\n        }\n\n        listen(port, ip, (err, realPort) => {\n          if (err) {\n            return handleError(err);\n          }\n\n          callback(null, realPort);\n        });\n      });\n    });\n  });\n}\n\nfunction listen(port, hostname, callback) {\n  const server = new net.Server();\n\n  server.on('error', err => {\n    debug('listen %s:%s error: %s', hostname, port, err);\n    server.close();\n    if (err.code === 'ENOTFOUND') {\n      debug('ignore dns ENOTFOUND error, get free %s:%s', hostname, port);\n      return callback(null, port);\n    }\n    return callback(err);\n  });\n\n  server.listen(port, hostname, () => {\n    port = server.address().port;\n    server.close();\n    debug('get free %s:%s', hostname, port);\n    return callback(null, port);\n  });\n}\n"]},"metadata":{},"sourceType":"script"}