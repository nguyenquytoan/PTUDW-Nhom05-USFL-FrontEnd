{"ast":null,"code":"// Generated by CoffeeScript 1.12.7\n(function () {\n  var GenericApp, execute_request, fake_response, fs, http, querystring, url, utils;\n  url = require('url');\n  querystring = require('querystring');\n  fs = require('fs');\n  http = require('http');\n  utils = require('./utils');\n\n  execute_request = function (app, funs, req, res, data) {\n    var fun, results, x;\n\n    try {\n      results = [];\n\n      while (funs.length > 0) {\n        fun = funs.shift();\n        req.last_fun = fun;\n        results.push(data = app[fun](req, res, data, req.next_filter));\n      }\n\n      return results;\n    } catch (error1) {\n      x = error1;\n\n      if (typeof x === 'object' && 'status' in x) {\n        if (x.status === 0) {\n          return;\n        } else if ('handle_' + x.status in app) {\n          app['handle_' + x.status](req, res, x);\n        } else {\n          app['handle_error'](req, res, x);\n        }\n      } else {\n        app['handle_error'](req, res, x);\n      }\n\n      return app['log_request'](req, res, true);\n    }\n  };\n\n  fake_response = function (req, res) {\n    var headers;\n    headers = {\n      'Connection': 'close'\n    };\n\n    res.writeHead = function (status, user_headers) {\n      var k, r, x;\n\n      if (user_headers == null) {\n        user_headers = {};\n      }\n\n      r = [];\n      r.push('HTTP/' + req.httpVersion + ' ' + status + ' ' + http.STATUS_CODES[status]);\n      utils.objectExtend(headers, user_headers);\n\n      for (k in headers) {\n        r.push(k + ': ' + headers[k]);\n      }\n\n      r = r.concat(['', '']);\n\n      try {\n        res.write(r.join('\\r\\n'));\n      } catch (error1) {\n        x = error1;\n      }\n\n      try {\n        return res.end();\n      } catch (error1) {\n        x = error1;\n      }\n    };\n\n    return res.setHeader = function (k, v) {\n      return headers[k] = v;\n    };\n  };\n\n  exports.generateHandler = function (app, dispatcher) {\n    return function (req, res, head) {\n      var allowed_methods, found, funs, i, j, l, len, m, method, path, ref, row;\n\n      if (typeof res.writeHead === \"undefined\") {\n        fake_response(req, res);\n      }\n\n      utils.objectExtend(req, url.parse(req.url, true));\n      req.start_date = new Date();\n      found = false;\n      allowed_methods = [];\n\n      for (j = 0, len = dispatcher.length; j < len; j++) {\n        row = dispatcher[j];\n        method = row[0], path = row[1], funs = row[2];\n\n        if (path.constructor !== Array) {\n          path = [path];\n        }\n\n        m = req.pathname.match(path[0]);\n\n        if (!m) {\n          continue;\n        }\n\n        if (!req.method.match(new RegExp(method))) {\n          allowed_methods.push(method);\n          continue;\n        }\n\n        for (i = l = 1, ref = path.length; 1 <= ref ? l < ref : l > ref; i = 1 <= ref ? ++l : --l) {\n          req[path[i]] = m[i];\n        }\n\n        funs = funs.slice(0);\n        funs.push('log_request');\n\n        req.next_filter = function (data) {\n          return execute_request(app, funs, req, res, data);\n        };\n\n        req.next_filter(head);\n        found = true;\n        break;\n      }\n\n      if (!found) {\n        if (allowed_methods.length !== 0) {\n          app['handle_405'](req, res, allowed_methods);\n        } else {\n          app['handle_404'](req, res);\n        }\n\n        app['log_request'](req, res, true);\n      }\n    };\n  };\n\n  exports.GenericApp = GenericApp = function () {\n    function GenericApp() {}\n\n    GenericApp.prototype.handle_404 = function (req, res, x) {\n      if (res.finished) {\n        return x;\n      }\n\n      res.writeHead(404, {});\n      res.end();\n      return true;\n    };\n\n    GenericApp.prototype.handle_405 = function (req, res, methods) {\n      res.writeHead(405, {\n        'Allow': methods.join(', ')\n      });\n      res.end();\n      return true;\n    };\n\n    GenericApp.prototype.handle_error = function (req, res, x) {\n      if (res.finished) {\n        return x;\n      }\n\n      if (typeof x === 'object' && 'status' in x) {\n        res.writeHead(x.status, {});\n        res.end(x.message || \"\");\n      } else {\n        try {\n          res.writeHead(500, {});\n          res.end(\"500 - Internal Server Error\");\n        } catch (error1) {\n          x = error1;\n        }\n\n        this.log('error', 'Exception on \"' + req.method + ' ' + req.href + '\" in filter \"' + req.last_fun + '\":\\n' + (x.stack || x));\n      }\n\n      return true;\n    };\n\n    GenericApp.prototype.log_request = function (req, res, data) {\n      var td;\n      td = new Date() - req.start_date;\n      this.log('info', req.method + ' ' + req.url + ' ' + td + 'ms ' + (res.finished ? res.statusCode : '(unfinished)'));\n      return data;\n    };\n\n    GenericApp.prototype.log = function (severity, line) {\n      return console.log(line);\n    };\n\n    GenericApp.prototype.expose_html = function (req, res, content) {\n      if (res.finished) {\n        return content;\n      }\n\n      if (!res.getHeader('Content-Type')) {\n        res.setHeader('Content-Type', 'text/html; charset=UTF-8');\n      }\n\n      return this.expose(req, res, content);\n    };\n\n    GenericApp.prototype.expose_json = function (req, res, content) {\n      if (res.finished) {\n        return content;\n      }\n\n      if (!res.getHeader('Content-Type')) {\n        res.setHeader('Content-Type', 'application/json');\n      }\n\n      return this.expose(req, res, JSON.stringify(content));\n    };\n\n    GenericApp.prototype.expose = function (req, res, content) {\n      if (res.finished) {\n        return content;\n      }\n\n      if (content && !res.getHeader('Content-Type')) {\n        res.setHeader('Content-Type', 'text/plain');\n      }\n\n      if (content) {\n        res.setHeader('Content-Length', content.length);\n      }\n\n      res.writeHead(res.statusCode);\n      res.end(content, 'utf8');\n      return true;\n    };\n\n    GenericApp.prototype.serve_file = function (req, res, filename, next_filter) {\n      var a;\n\n      a = function (error, content) {\n        if (error) {\n          res.writeHead(500);\n          res.end(\"can't read file\");\n        } else {\n          res.setHeader('Content-length', content.length);\n          res.writeHead(res.statusCode, res.headers);\n          res.end(content, 'utf8');\n        }\n\n        return next_filter(true);\n      };\n\n      fs.readFile(filename, a);\n      throw {\n        status: 0\n      };\n    };\n\n    GenericApp.prototype.cache_for = function (req, res, content) {\n      var exp;\n      res.cache_for = res.cache_for || 365 * 24 * 60 * 60;\n      res.setHeader('Cache-Control', 'public, max-age=' + res.cache_for);\n      exp = new Date();\n      exp.setTime(exp.getTime() + res.cache_for * 1000);\n      res.setHeader('Expires', exp.toGMTString());\n      return content;\n    };\n\n    GenericApp.prototype.h_no_cache = function (req, res, content) {\n      res.setHeader('Cache-Control', 'no-store, no-cache, no-transform, must-revalidate, max-age=0');\n      return content;\n    };\n\n    GenericApp.prototype.expect_form = function (req, res, _data, next_filter) {\n      var data;\n      data = new Buffer(0);\n      req.on('data', function (_this) {\n        return function (d) {\n          return data = utils.buffer_concat(data, new Buffer(d, 'binary'));\n        };\n      }(this));\n      req.on('end', function (_this) {\n        return function () {\n          var q;\n          data = data.toString('utf-8');\n\n          switch ((req.headers['content-type'] || '').split(';')[0]) {\n            case 'application/x-www-form-urlencoded':\n              q = querystring.parse(data);\n              break;\n\n            case 'text/plain':\n            case '':\n              q = data;\n              break;\n\n            default:\n              _this.log('error', \"Unsupported content-type \" + req.headers['content-type']);\n\n              q = void 0;\n          }\n\n          return next_filter(q);\n        };\n      }(this));\n      throw {\n        status: 0\n      };\n    };\n\n    GenericApp.prototype.expect_xhr = function (req, res, _data, next_filter) {\n      var data;\n      data = new Buffer(0);\n      req.on('data', function (_this) {\n        return function (d) {\n          return data = utils.buffer_concat(data, new Buffer(d, 'binary'));\n        };\n      }(this));\n      req.on('end', function (_this) {\n        return function () {\n          var q;\n          data = data.toString('utf-8');\n\n          switch ((req.headers['content-type'] || '').split(';')[0]) {\n            case 'text/plain':\n            case 'T':\n            case 'application/json':\n            case 'application/xml':\n            case '':\n            case 'text/xml':\n              q = data;\n              break;\n\n            default:\n              _this.log('error', 'Unsupported content-type ' + req.headers['content-type']);\n\n              q = void 0;\n          }\n\n          return next_filter(q);\n        };\n      }(this));\n      throw {\n        status: 0\n      };\n    };\n\n    return GenericApp;\n  }();\n}).call(this);","map":{"version":3,"sources":["/Users/nguyenquytoan/Desktop/PTUDW-17TN-Nhom05-USFL/react-usfl/PTUDW-17TN-Nhom05/node_modules/sockjs/lib/webjs.js"],"names":["GenericApp","execute_request","fake_response","fs","http","querystring","url","utils","require","app","funs","req","res","data","fun","results","x","length","shift","last_fun","push","next_filter","error1","status","headers","writeHead","user_headers","k","r","httpVersion","STATUS_CODES","objectExtend","concat","write","join","end","setHeader","v","exports","generateHandler","dispatcher","head","allowed_methods","found","i","j","l","len","m","method","path","ref","row","parse","start_date","Date","constructor","Array","pathname","match","RegExp","slice","prototype","handle_404","finished","handle_405","methods","handle_error","message","log","href","stack","log_request","td","statusCode","severity","line","console","expose_html","content","getHeader","expose","expose_json","JSON","stringify","serve_file","filename","a","error","readFile","cache_for","exp","setTime","getTime","toGMTString","h_no_cache","expect_form","_data","Buffer","on","_this","d","buffer_concat","q","toString","split","expect_xhr","call"],"mappings":"AAAA;AACA,CAAC,YAAW;AACV,MAAIA,UAAJ,EAAgBC,eAAhB,EAAiCC,aAAjC,EAAgDC,EAAhD,EAAoDC,IAApD,EAA0DC,WAA1D,EAAuEC,GAAvE,EAA4EC,KAA5E;AAEAD,EAAAA,GAAG,GAAGE,OAAO,CAAC,KAAD,CAAb;AAEAH,EAAAA,WAAW,GAAGG,OAAO,CAAC,aAAD,CAArB;AAEAL,EAAAA,EAAE,GAAGK,OAAO,CAAC,IAAD,CAAZ;AAEAJ,EAAAA,IAAI,GAAGI,OAAO,CAAC,MAAD,CAAd;AAEAD,EAAAA,KAAK,GAAGC,OAAO,CAAC,SAAD,CAAf;;AAEAP,EAAAA,eAAe,GAAG,UAASQ,GAAT,EAAcC,IAAd,EAAoBC,GAApB,EAAyBC,GAAzB,EAA8BC,IAA9B,EAAoC;AACpD,QAAIC,GAAJ,EAASC,OAAT,EAAkBC,CAAlB;;AACA,QAAI;AACFD,MAAAA,OAAO,GAAG,EAAV;;AACA,aAAOL,IAAI,CAACO,MAAL,GAAc,CAArB,EAAwB;AACtBH,QAAAA,GAAG,GAAGJ,IAAI,CAACQ,KAAL,EAAN;AACAP,QAAAA,GAAG,CAACQ,QAAJ,GAAeL,GAAf;AACAC,QAAAA,OAAO,CAACK,IAAR,CAAaP,IAAI,GAAGJ,GAAG,CAACK,GAAD,CAAH,CAASH,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyBF,GAAG,CAACU,WAA7B,CAApB;AACD;;AACD,aAAON,OAAP;AACD,KARD,CAQE,OAAOO,MAAP,EAAe;AACfN,MAAAA,CAAC,GAAGM,MAAJ;;AACA,UAAI,OAAON,CAAP,KAAa,QAAb,IAAyB,YAAYA,CAAzC,EAA4C;AAC1C,YAAIA,CAAC,CAACO,MAAF,KAAa,CAAjB,EAAoB;AAClB;AACD,SAFD,MAEO,IAAI,YAAYP,CAAC,CAACO,MAAd,IAAwBd,GAA5B,EAAiC;AACtCA,UAAAA,GAAG,CAAC,YAAYO,CAAC,CAACO,MAAf,CAAH,CAA0BZ,GAA1B,EAA+BC,GAA/B,EAAoCI,CAApC;AACD,SAFM,MAEA;AACLP,UAAAA,GAAG,CAAC,cAAD,CAAH,CAAoBE,GAApB,EAAyBC,GAAzB,EAA8BI,CAA9B;AACD;AACF,OARD,MAQO;AACLP,QAAAA,GAAG,CAAC,cAAD,CAAH,CAAoBE,GAApB,EAAyBC,GAAzB,EAA8BI,CAA9B;AACD;;AACD,aAAOP,GAAG,CAAC,aAAD,CAAH,CAAmBE,GAAnB,EAAwBC,GAAxB,EAA6B,IAA7B,CAAP;AACD;AACF,GAzBD;;AA2BAV,EAAAA,aAAa,GAAG,UAASS,GAAT,EAAcC,GAAd,EAAmB;AACjC,QAAIY,OAAJ;AACAA,IAAAA,OAAO,GAAG;AACR,oBAAc;AADN,KAAV;;AAGAZ,IAAAA,GAAG,CAACa,SAAJ,GAAgB,UAASF,MAAT,EAAiBG,YAAjB,EAA+B;AAC7C,UAAIC,CAAJ,EAAOC,CAAP,EAAUZ,CAAV;;AACA,UAAIU,YAAY,IAAI,IAApB,EAA0B;AACxBA,QAAAA,YAAY,GAAG,EAAf;AACD;;AACDE,MAAAA,CAAC,GAAG,EAAJ;AACAA,MAAAA,CAAC,CAACR,IAAF,CAAO,UAAUT,GAAG,CAACkB,WAAd,GAA4B,GAA5B,GAAkCN,MAAlC,GAA2C,GAA3C,GAAiDnB,IAAI,CAAC0B,YAAL,CAAkBP,MAAlB,CAAxD;AACAhB,MAAAA,KAAK,CAACwB,YAAN,CAAmBP,OAAnB,EAA4BE,YAA5B;;AACA,WAAKC,CAAL,IAAUH,OAAV,EAAmB;AACjBI,QAAAA,CAAC,CAACR,IAAF,CAAOO,CAAC,GAAG,IAAJ,GAAWH,OAAO,CAACG,CAAD,CAAzB;AACD;;AACDC,MAAAA,CAAC,GAAGA,CAAC,CAACI,MAAF,CAAS,CAAC,EAAD,EAAK,EAAL,CAAT,CAAJ;;AACA,UAAI;AACFpB,QAAAA,GAAG,CAACqB,KAAJ,CAAUL,CAAC,CAACM,IAAF,CAAO,MAAP,CAAV;AACD,OAFD,CAEE,OAAOZ,MAAP,EAAe;AACfN,QAAAA,CAAC,GAAGM,MAAJ;AACD;;AACD,UAAI;AACF,eAAOV,GAAG,CAACuB,GAAJ,EAAP;AACD,OAFD,CAEE,OAAOb,MAAP,EAAe;AACfN,QAAAA,CAAC,GAAGM,MAAJ;AACD;AACF,KAtBD;;AAuBA,WAAOV,GAAG,CAACwB,SAAJ,GAAgB,UAAST,CAAT,EAAYU,CAAZ,EAAe;AACpC,aAAOb,OAAO,CAACG,CAAD,CAAP,GAAaU,CAApB;AACD,KAFD;AAGD,GA/BD;;AAiCAC,EAAAA,OAAO,CAACC,eAAR,GAA0B,UAAS9B,GAAT,EAAc+B,UAAd,EAA0B;AAClD,WAAO,UAAS7B,GAAT,EAAcC,GAAd,EAAmB6B,IAAnB,EAAyB;AAC9B,UAAIC,eAAJ,EAAqBC,KAArB,EAA4BjC,IAA5B,EAAkCkC,CAAlC,EAAqCC,CAArC,EAAwCC,CAAxC,EAA2CC,GAA3C,EAAgDC,CAAhD,EAAmDC,MAAnD,EAA2DC,IAA3D,EAAiEC,GAAjE,EAAsEC,GAAtE;;AACA,UAAI,OAAOxC,GAAG,CAACa,SAAX,KAAyB,WAA7B,EAA0C;AACxCvB,QAAAA,aAAa,CAACS,GAAD,EAAMC,GAAN,CAAb;AACD;;AACDL,MAAAA,KAAK,CAACwB,YAAN,CAAmBpB,GAAnB,EAAwBL,GAAG,CAAC+C,KAAJ,CAAU1C,GAAG,CAACL,GAAd,EAAmB,IAAnB,CAAxB;AACAK,MAAAA,GAAG,CAAC2C,UAAJ,GAAiB,IAAIC,IAAJ,EAAjB;AACAZ,MAAAA,KAAK,GAAG,KAAR;AACAD,MAAAA,eAAe,GAAG,EAAlB;;AACA,WAAKG,CAAC,GAAG,CAAJ,EAAOE,GAAG,GAAGP,UAAU,CAACvB,MAA7B,EAAqC4B,CAAC,GAAGE,GAAzC,EAA8CF,CAAC,EAA/C,EAAmD;AACjDO,QAAAA,GAAG,GAAGZ,UAAU,CAACK,CAAD,CAAhB;AACAI,QAAAA,MAAM,GAAGG,GAAG,CAAC,CAAD,CAAZ,EAAiBF,IAAI,GAAGE,GAAG,CAAC,CAAD,CAA3B,EAAgC1C,IAAI,GAAG0C,GAAG,CAAC,CAAD,CAA1C;;AACA,YAAIF,IAAI,CAACM,WAAL,KAAqBC,KAAzB,EAAgC;AAC9BP,UAAAA,IAAI,GAAG,CAACA,IAAD,CAAP;AACD;;AACDF,QAAAA,CAAC,GAAGrC,GAAG,CAAC+C,QAAJ,CAAaC,KAAb,CAAmBT,IAAI,CAAC,CAAD,CAAvB,CAAJ;;AACA,YAAI,CAACF,CAAL,EAAQ;AACN;AACD;;AACD,YAAI,CAACrC,GAAG,CAACsC,MAAJ,CAAWU,KAAX,CAAiB,IAAIC,MAAJ,CAAWX,MAAX,CAAjB,CAAL,EAA2C;AACzCP,UAAAA,eAAe,CAACtB,IAAhB,CAAqB6B,MAArB;AACA;AACD;;AACD,aAAKL,CAAC,GAAGE,CAAC,GAAG,CAAR,EAAWK,GAAG,GAAGD,IAAI,CAACjC,MAA3B,EAAmC,KAAKkC,GAAL,GAAWL,CAAC,GAAGK,GAAf,GAAqBL,CAAC,GAAGK,GAA5D,EAAiEP,CAAC,GAAG,KAAKO,GAAL,GAAW,EAAEL,CAAb,GAAiB,EAAEA,CAAxF,EAA2F;AACzFnC,UAAAA,GAAG,CAACuC,IAAI,CAACN,CAAD,CAAL,CAAH,GAAeI,CAAC,CAACJ,CAAD,CAAhB;AACD;;AACDlC,QAAAA,IAAI,GAAGA,IAAI,CAACmD,KAAL,CAAW,CAAX,CAAP;AACAnD,QAAAA,IAAI,CAACU,IAAL,CAAU,aAAV;;AACAT,QAAAA,GAAG,CAACU,WAAJ,GAAkB,UAASR,IAAT,EAAe;AAC/B,iBAAOZ,eAAe,CAACQ,GAAD,EAAMC,IAAN,EAAYC,GAAZ,EAAiBC,GAAjB,EAAsBC,IAAtB,CAAtB;AACD,SAFD;;AAGAF,QAAAA,GAAG,CAACU,WAAJ,CAAgBoB,IAAhB;AACAE,QAAAA,KAAK,GAAG,IAAR;AACA;AACD;;AACD,UAAI,CAACA,KAAL,EAAY;AACV,YAAID,eAAe,CAACzB,MAAhB,KAA2B,CAA/B,EAAkC;AAChCR,UAAAA,GAAG,CAAC,YAAD,CAAH,CAAkBE,GAAlB,EAAuBC,GAAvB,EAA4B8B,eAA5B;AACD,SAFD,MAEO;AACLjC,UAAAA,GAAG,CAAC,YAAD,CAAH,CAAkBE,GAAlB,EAAuBC,GAAvB;AACD;;AACDH,QAAAA,GAAG,CAAC,aAAD,CAAH,CAAmBE,GAAnB,EAAwBC,GAAxB,EAA6B,IAA7B;AACD;AACF,KA3CD;AA4CD,GA7CD;;AA+CA0B,EAAAA,OAAO,CAACtC,UAAR,GAAqBA,UAAU,GAAI,YAAW;AAC5C,aAASA,UAAT,GAAsB,CAAE;;AAExBA,IAAAA,UAAU,CAAC8D,SAAX,CAAqBC,UAArB,GAAkC,UAASpD,GAAT,EAAcC,GAAd,EAAmBI,CAAnB,EAAsB;AACtD,UAAIJ,GAAG,CAACoD,QAAR,EAAkB;AAChB,eAAOhD,CAAP;AACD;;AACDJ,MAAAA,GAAG,CAACa,SAAJ,CAAc,GAAd,EAAmB,EAAnB;AACAb,MAAAA,GAAG,CAACuB,GAAJ;AACA,aAAO,IAAP;AACD,KAPD;;AASAnC,IAAAA,UAAU,CAAC8D,SAAX,CAAqBG,UAArB,GAAkC,UAAStD,GAAT,EAAcC,GAAd,EAAmBsD,OAAnB,EAA4B;AAC5DtD,MAAAA,GAAG,CAACa,SAAJ,CAAc,GAAd,EAAmB;AACjB,iBAASyC,OAAO,CAAChC,IAAR,CAAa,IAAb;AADQ,OAAnB;AAGAtB,MAAAA,GAAG,CAACuB,GAAJ;AACA,aAAO,IAAP;AACD,KAND;;AAQAnC,IAAAA,UAAU,CAAC8D,SAAX,CAAqBK,YAArB,GAAoC,UAASxD,GAAT,EAAcC,GAAd,EAAmBI,CAAnB,EAAsB;AACxD,UAAIJ,GAAG,CAACoD,QAAR,EAAkB;AAChB,eAAOhD,CAAP;AACD;;AACD,UAAI,OAAOA,CAAP,KAAa,QAAb,IAAyB,YAAYA,CAAzC,EAA4C;AAC1CJ,QAAAA,GAAG,CAACa,SAAJ,CAAcT,CAAC,CAACO,MAAhB,EAAwB,EAAxB;AACAX,QAAAA,GAAG,CAACuB,GAAJ,CAAQnB,CAAC,CAACoD,OAAF,IAAa,EAArB;AACD,OAHD,MAGO;AACL,YAAI;AACFxD,UAAAA,GAAG,CAACa,SAAJ,CAAc,GAAd,EAAmB,EAAnB;AACAb,UAAAA,GAAG,CAACuB,GAAJ,CAAQ,6BAAR;AACD,SAHD,CAGE,OAAOb,MAAP,EAAe;AACfN,UAAAA,CAAC,GAAGM,MAAJ;AACD;;AACD,aAAK+C,GAAL,CAAS,OAAT,EAAkB,mBAAmB1D,GAAG,CAACsC,MAAvB,GAAgC,GAAhC,GAAsCtC,GAAG,CAAC2D,IAA1C,GAAiD,eAAjD,GAAmE3D,GAAG,CAACQ,QAAvE,GAAkF,MAAlF,IAA4FH,CAAC,CAACuD,KAAF,IAAWvD,CAAvG,CAAlB;AACD;;AACD,aAAO,IAAP;AACD,KAjBD;;AAmBAhB,IAAAA,UAAU,CAAC8D,SAAX,CAAqBU,WAArB,GAAmC,UAAS7D,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AAC1D,UAAI4D,EAAJ;AACAA,MAAAA,EAAE,GAAI,IAAIlB,IAAJ,EAAD,GAAe5C,GAAG,CAAC2C,UAAxB;AACA,WAAKe,GAAL,CAAS,MAAT,EAAiB1D,GAAG,CAACsC,MAAJ,GAAa,GAAb,GAAmBtC,GAAG,CAACL,GAAvB,GAA6B,GAA7B,GAAmCmE,EAAnC,GAAwC,KAAxC,IAAiD7D,GAAG,CAACoD,QAAJ,GAAepD,GAAG,CAAC8D,UAAnB,GAAgC,cAAjF,CAAjB;AACA,aAAO7D,IAAP;AACD,KALD;;AAOAb,IAAAA,UAAU,CAAC8D,SAAX,CAAqBO,GAArB,GAA2B,UAASM,QAAT,EAAmBC,IAAnB,EAAyB;AAClD,aAAOC,OAAO,CAACR,GAAR,CAAYO,IAAZ,CAAP;AACD,KAFD;;AAIA5E,IAAAA,UAAU,CAAC8D,SAAX,CAAqBgB,WAArB,GAAmC,UAASnE,GAAT,EAAcC,GAAd,EAAmBmE,OAAnB,EAA4B;AAC7D,UAAInE,GAAG,CAACoD,QAAR,EAAkB;AAChB,eAAOe,OAAP;AACD;;AACD,UAAI,CAACnE,GAAG,CAACoE,SAAJ,CAAc,cAAd,CAAL,EAAoC;AAClCpE,QAAAA,GAAG,CAACwB,SAAJ,CAAc,cAAd,EAA8B,0BAA9B;AACD;;AACD,aAAO,KAAK6C,MAAL,CAAYtE,GAAZ,EAAiBC,GAAjB,EAAsBmE,OAAtB,CAAP;AACD,KARD;;AAUA/E,IAAAA,UAAU,CAAC8D,SAAX,CAAqBoB,WAArB,GAAmC,UAASvE,GAAT,EAAcC,GAAd,EAAmBmE,OAAnB,EAA4B;AAC7D,UAAInE,GAAG,CAACoD,QAAR,EAAkB;AAChB,eAAOe,OAAP;AACD;;AACD,UAAI,CAACnE,GAAG,CAACoE,SAAJ,CAAc,cAAd,CAAL,EAAoC;AAClCpE,QAAAA,GAAG,CAACwB,SAAJ,CAAc,cAAd,EAA8B,kBAA9B;AACD;;AACD,aAAO,KAAK6C,MAAL,CAAYtE,GAAZ,EAAiBC,GAAjB,EAAsBuE,IAAI,CAACC,SAAL,CAAeL,OAAf,CAAtB,CAAP;AACD,KARD;;AAUA/E,IAAAA,UAAU,CAAC8D,SAAX,CAAqBmB,MAArB,GAA8B,UAAStE,GAAT,EAAcC,GAAd,EAAmBmE,OAAnB,EAA4B;AACxD,UAAInE,GAAG,CAACoD,QAAR,EAAkB;AAChB,eAAOe,OAAP;AACD;;AACD,UAAIA,OAAO,IAAI,CAACnE,GAAG,CAACoE,SAAJ,CAAc,cAAd,CAAhB,EAA+C;AAC7CpE,QAAAA,GAAG,CAACwB,SAAJ,CAAc,cAAd,EAA8B,YAA9B;AACD;;AACD,UAAI2C,OAAJ,EAAa;AACXnE,QAAAA,GAAG,CAACwB,SAAJ,CAAc,gBAAd,EAAgC2C,OAAO,CAAC9D,MAAxC;AACD;;AACDL,MAAAA,GAAG,CAACa,SAAJ,CAAcb,GAAG,CAAC8D,UAAlB;AACA9D,MAAAA,GAAG,CAACuB,GAAJ,CAAQ4C,OAAR,EAAiB,MAAjB;AACA,aAAO,IAAP;AACD,KAbD;;AAeA/E,IAAAA,UAAU,CAAC8D,SAAX,CAAqBuB,UAArB,GAAkC,UAAS1E,GAAT,EAAcC,GAAd,EAAmB0E,QAAnB,EAA6BjE,WAA7B,EAA0C;AAC1E,UAAIkE,CAAJ;;AACAA,MAAAA,CAAC,GAAG,UAASC,KAAT,EAAgBT,OAAhB,EAAyB;AAC3B,YAAIS,KAAJ,EAAW;AACT5E,UAAAA,GAAG,CAACa,SAAJ,CAAc,GAAd;AACAb,UAAAA,GAAG,CAACuB,GAAJ,CAAQ,iBAAR;AACD,SAHD,MAGO;AACLvB,UAAAA,GAAG,CAACwB,SAAJ,CAAc,gBAAd,EAAgC2C,OAAO,CAAC9D,MAAxC;AACAL,UAAAA,GAAG,CAACa,SAAJ,CAAcb,GAAG,CAAC8D,UAAlB,EAA8B9D,GAAG,CAACY,OAAlC;AACAZ,UAAAA,GAAG,CAACuB,GAAJ,CAAQ4C,OAAR,EAAiB,MAAjB;AACD;;AACD,eAAO1D,WAAW,CAAC,IAAD,CAAlB;AACD,OAVD;;AAWAlB,MAAAA,EAAE,CAACsF,QAAH,CAAYH,QAAZ,EAAsBC,CAAtB;AACA,YAAM;AACJhE,QAAAA,MAAM,EAAE;AADJ,OAAN;AAGD,KAjBD;;AAmBAvB,IAAAA,UAAU,CAAC8D,SAAX,CAAqB4B,SAArB,GAAiC,UAAS/E,GAAT,EAAcC,GAAd,EAAmBmE,OAAnB,EAA4B;AAC3D,UAAIY,GAAJ;AACA/E,MAAAA,GAAG,CAAC8E,SAAJ,GAAgB9E,GAAG,CAAC8E,SAAJ,IAAiB,MAAM,EAAN,GAAW,EAAX,GAAgB,EAAjD;AACA9E,MAAAA,GAAG,CAACwB,SAAJ,CAAc,eAAd,EAA+B,qBAAqBxB,GAAG,CAAC8E,SAAxD;AACAC,MAAAA,GAAG,GAAG,IAAIpC,IAAJ,EAAN;AACAoC,MAAAA,GAAG,CAACC,OAAJ,CAAYD,GAAG,CAACE,OAAJ,KAAgBjF,GAAG,CAAC8E,SAAJ,GAAgB,IAA5C;AACA9E,MAAAA,GAAG,CAACwB,SAAJ,CAAc,SAAd,EAAyBuD,GAAG,CAACG,WAAJ,EAAzB;AACA,aAAOf,OAAP;AACD,KARD;;AAUA/E,IAAAA,UAAU,CAAC8D,SAAX,CAAqBiC,UAArB,GAAkC,UAASpF,GAAT,EAAcC,GAAd,EAAmBmE,OAAnB,EAA4B;AAC5DnE,MAAAA,GAAG,CAACwB,SAAJ,CAAc,eAAd,EAA+B,8DAA/B;AACA,aAAO2C,OAAP;AACD,KAHD;;AAKA/E,IAAAA,UAAU,CAAC8D,SAAX,CAAqBkC,WAArB,GAAmC,UAASrF,GAAT,EAAcC,GAAd,EAAmBqF,KAAnB,EAA0B5E,WAA1B,EAAuC;AACxE,UAAIR,IAAJ;AACAA,MAAAA,IAAI,GAAG,IAAIqF,MAAJ,CAAW,CAAX,CAAP;AACAvF,MAAAA,GAAG,CAACwF,EAAJ,CAAO,MAAP,EAAgB,UAASC,KAAT,EAAgB;AAC9B,eAAO,UAASC,CAAT,EAAY;AACjB,iBAAOxF,IAAI,GAAGN,KAAK,CAAC+F,aAAN,CAAoBzF,IAApB,EAA0B,IAAIqF,MAAJ,CAAWG,CAAX,EAAc,QAAd,CAA1B,CAAd;AACD,SAFD;AAGD,OAJc,CAIZ,IAJY,CAAf;AAKA1F,MAAAA,GAAG,CAACwF,EAAJ,CAAO,KAAP,EAAe,UAASC,KAAT,EAAgB;AAC7B,eAAO,YAAW;AAChB,cAAIG,CAAJ;AACA1F,UAAAA,IAAI,GAAGA,IAAI,CAAC2F,QAAL,CAAc,OAAd,CAAP;;AACA,kBAAQ,CAAC7F,GAAG,CAACa,OAAJ,CAAY,cAAZ,KAA+B,EAAhC,EAAoCiF,KAApC,CAA0C,GAA1C,EAA+C,CAA/C,CAAR;AACE,iBAAK,mCAAL;AACEF,cAAAA,CAAC,GAAGlG,WAAW,CAACgD,KAAZ,CAAkBxC,IAAlB,CAAJ;AACA;;AACF,iBAAK,YAAL;AACA,iBAAK,EAAL;AACE0F,cAAAA,CAAC,GAAG1F,IAAJ;AACA;;AACF;AACEuF,cAAAA,KAAK,CAAC/B,GAAN,CAAU,OAAV,EAAmB,8BAA8B1D,GAAG,CAACa,OAAJ,CAAY,cAAZ,CAAjD;;AACA+E,cAAAA,CAAC,GAAG,KAAK,CAAT;AAVJ;;AAYA,iBAAOlF,WAAW,CAACkF,CAAD,CAAlB;AACD,SAhBD;AAiBD,OAlBa,CAkBX,IAlBW,CAAd;AAmBA,YAAM;AACJhF,QAAAA,MAAM,EAAE;AADJ,OAAN;AAGD,KA9BD;;AAgCAvB,IAAAA,UAAU,CAAC8D,SAAX,CAAqB4C,UAArB,GAAkC,UAAS/F,GAAT,EAAcC,GAAd,EAAmBqF,KAAnB,EAA0B5E,WAA1B,EAAuC;AACvE,UAAIR,IAAJ;AACAA,MAAAA,IAAI,GAAG,IAAIqF,MAAJ,CAAW,CAAX,CAAP;AACAvF,MAAAA,GAAG,CAACwF,EAAJ,CAAO,MAAP,EAAgB,UAASC,KAAT,EAAgB;AAC9B,eAAO,UAASC,CAAT,EAAY;AACjB,iBAAOxF,IAAI,GAAGN,KAAK,CAAC+F,aAAN,CAAoBzF,IAApB,EAA0B,IAAIqF,MAAJ,CAAWG,CAAX,EAAc,QAAd,CAA1B,CAAd;AACD,SAFD;AAGD,OAJc,CAIZ,IAJY,CAAf;AAKA1F,MAAAA,GAAG,CAACwF,EAAJ,CAAO,KAAP,EAAe,UAASC,KAAT,EAAgB;AAC7B,eAAO,YAAW;AAChB,cAAIG,CAAJ;AACA1F,UAAAA,IAAI,GAAGA,IAAI,CAAC2F,QAAL,CAAc,OAAd,CAAP;;AACA,kBAAQ,CAAC7F,GAAG,CAACa,OAAJ,CAAY,cAAZ,KAA+B,EAAhC,EAAoCiF,KAApC,CAA0C,GAA1C,EAA+C,CAA/C,CAAR;AACE,iBAAK,YAAL;AACA,iBAAK,GAAL;AACA,iBAAK,kBAAL;AACA,iBAAK,iBAAL;AACA,iBAAK,EAAL;AACA,iBAAK,UAAL;AACEF,cAAAA,CAAC,GAAG1F,IAAJ;AACA;;AACF;AACEuF,cAAAA,KAAK,CAAC/B,GAAN,CAAU,OAAV,EAAmB,8BAA8B1D,GAAG,CAACa,OAAJ,CAAY,cAAZ,CAAjD;;AACA+E,cAAAA,CAAC,GAAG,KAAK,CAAT;AAXJ;;AAaA,iBAAOlF,WAAW,CAACkF,CAAD,CAAlB;AACD,SAjBD;AAkBD,OAnBa,CAmBX,IAnBW,CAAd;AAoBA,YAAM;AACJhF,QAAAA,MAAM,EAAE;AADJ,OAAN;AAGD,KA/BD;;AAiCA,WAAOvB,UAAP;AAED,GA1LiC,EAAlC;AA4LD,CApTD,EAoTG2G,IApTH,CAoTQ,IApTR","sourcesContent":["// Generated by CoffeeScript 1.12.7\n(function() {\n  var GenericApp, execute_request, fake_response, fs, http, querystring, url, utils;\n\n  url = require('url');\n\n  querystring = require('querystring');\n\n  fs = require('fs');\n\n  http = require('http');\n\n  utils = require('./utils');\n\n  execute_request = function(app, funs, req, res, data) {\n    var fun, results, x;\n    try {\n      results = [];\n      while (funs.length > 0) {\n        fun = funs.shift();\n        req.last_fun = fun;\n        results.push(data = app[fun](req, res, data, req.next_filter));\n      }\n      return results;\n    } catch (error1) {\n      x = error1;\n      if (typeof x === 'object' && 'status' in x) {\n        if (x.status === 0) {\n          return;\n        } else if ('handle_' + x.status in app) {\n          app['handle_' + x.status](req, res, x);\n        } else {\n          app['handle_error'](req, res, x);\n        }\n      } else {\n        app['handle_error'](req, res, x);\n      }\n      return app['log_request'](req, res, true);\n    }\n  };\n\n  fake_response = function(req, res) {\n    var headers;\n    headers = {\n      'Connection': 'close'\n    };\n    res.writeHead = function(status, user_headers) {\n      var k, r, x;\n      if (user_headers == null) {\n        user_headers = {};\n      }\n      r = [];\n      r.push('HTTP/' + req.httpVersion + ' ' + status + ' ' + http.STATUS_CODES[status]);\n      utils.objectExtend(headers, user_headers);\n      for (k in headers) {\n        r.push(k + ': ' + headers[k]);\n      }\n      r = r.concat(['', '']);\n      try {\n        res.write(r.join('\\r\\n'));\n      } catch (error1) {\n        x = error1;\n      }\n      try {\n        return res.end();\n      } catch (error1) {\n        x = error1;\n      }\n    };\n    return res.setHeader = function(k, v) {\n      return headers[k] = v;\n    };\n  };\n\n  exports.generateHandler = function(app, dispatcher) {\n    return function(req, res, head) {\n      var allowed_methods, found, funs, i, j, l, len, m, method, path, ref, row;\n      if (typeof res.writeHead === \"undefined\") {\n        fake_response(req, res);\n      }\n      utils.objectExtend(req, url.parse(req.url, true));\n      req.start_date = new Date();\n      found = false;\n      allowed_methods = [];\n      for (j = 0, len = dispatcher.length; j < len; j++) {\n        row = dispatcher[j];\n        method = row[0], path = row[1], funs = row[2];\n        if (path.constructor !== Array) {\n          path = [path];\n        }\n        m = req.pathname.match(path[0]);\n        if (!m) {\n          continue;\n        }\n        if (!req.method.match(new RegExp(method))) {\n          allowed_methods.push(method);\n          continue;\n        }\n        for (i = l = 1, ref = path.length; 1 <= ref ? l < ref : l > ref; i = 1 <= ref ? ++l : --l) {\n          req[path[i]] = m[i];\n        }\n        funs = funs.slice(0);\n        funs.push('log_request');\n        req.next_filter = function(data) {\n          return execute_request(app, funs, req, res, data);\n        };\n        req.next_filter(head);\n        found = true;\n        break;\n      }\n      if (!found) {\n        if (allowed_methods.length !== 0) {\n          app['handle_405'](req, res, allowed_methods);\n        } else {\n          app['handle_404'](req, res);\n        }\n        app['log_request'](req, res, true);\n      }\n    };\n  };\n\n  exports.GenericApp = GenericApp = (function() {\n    function GenericApp() {}\n\n    GenericApp.prototype.handle_404 = function(req, res, x) {\n      if (res.finished) {\n        return x;\n      }\n      res.writeHead(404, {});\n      res.end();\n      return true;\n    };\n\n    GenericApp.prototype.handle_405 = function(req, res, methods) {\n      res.writeHead(405, {\n        'Allow': methods.join(', ')\n      });\n      res.end();\n      return true;\n    };\n\n    GenericApp.prototype.handle_error = function(req, res, x) {\n      if (res.finished) {\n        return x;\n      }\n      if (typeof x === 'object' && 'status' in x) {\n        res.writeHead(x.status, {});\n        res.end(x.message || \"\");\n      } else {\n        try {\n          res.writeHead(500, {});\n          res.end(\"500 - Internal Server Error\");\n        } catch (error1) {\n          x = error1;\n        }\n        this.log('error', 'Exception on \"' + req.method + ' ' + req.href + '\" in filter \"' + req.last_fun + '\":\\n' + (x.stack || x));\n      }\n      return true;\n    };\n\n    GenericApp.prototype.log_request = function(req, res, data) {\n      var td;\n      td = (new Date()) - req.start_date;\n      this.log('info', req.method + ' ' + req.url + ' ' + td + 'ms ' + (res.finished ? res.statusCode : '(unfinished)'));\n      return data;\n    };\n\n    GenericApp.prototype.log = function(severity, line) {\n      return console.log(line);\n    };\n\n    GenericApp.prototype.expose_html = function(req, res, content) {\n      if (res.finished) {\n        return content;\n      }\n      if (!res.getHeader('Content-Type')) {\n        res.setHeader('Content-Type', 'text/html; charset=UTF-8');\n      }\n      return this.expose(req, res, content);\n    };\n\n    GenericApp.prototype.expose_json = function(req, res, content) {\n      if (res.finished) {\n        return content;\n      }\n      if (!res.getHeader('Content-Type')) {\n        res.setHeader('Content-Type', 'application/json');\n      }\n      return this.expose(req, res, JSON.stringify(content));\n    };\n\n    GenericApp.prototype.expose = function(req, res, content) {\n      if (res.finished) {\n        return content;\n      }\n      if (content && !res.getHeader('Content-Type')) {\n        res.setHeader('Content-Type', 'text/plain');\n      }\n      if (content) {\n        res.setHeader('Content-Length', content.length);\n      }\n      res.writeHead(res.statusCode);\n      res.end(content, 'utf8');\n      return true;\n    };\n\n    GenericApp.prototype.serve_file = function(req, res, filename, next_filter) {\n      var a;\n      a = function(error, content) {\n        if (error) {\n          res.writeHead(500);\n          res.end(\"can't read file\");\n        } else {\n          res.setHeader('Content-length', content.length);\n          res.writeHead(res.statusCode, res.headers);\n          res.end(content, 'utf8');\n        }\n        return next_filter(true);\n      };\n      fs.readFile(filename, a);\n      throw {\n        status: 0\n      };\n    };\n\n    GenericApp.prototype.cache_for = function(req, res, content) {\n      var exp;\n      res.cache_for = res.cache_for || 365 * 24 * 60 * 60;\n      res.setHeader('Cache-Control', 'public, max-age=' + res.cache_for);\n      exp = new Date();\n      exp.setTime(exp.getTime() + res.cache_for * 1000);\n      res.setHeader('Expires', exp.toGMTString());\n      return content;\n    };\n\n    GenericApp.prototype.h_no_cache = function(req, res, content) {\n      res.setHeader('Cache-Control', 'no-store, no-cache, no-transform, must-revalidate, max-age=0');\n      return content;\n    };\n\n    GenericApp.prototype.expect_form = function(req, res, _data, next_filter) {\n      var data;\n      data = new Buffer(0);\n      req.on('data', (function(_this) {\n        return function(d) {\n          return data = utils.buffer_concat(data, new Buffer(d, 'binary'));\n        };\n      })(this));\n      req.on('end', (function(_this) {\n        return function() {\n          var q;\n          data = data.toString('utf-8');\n          switch ((req.headers['content-type'] || '').split(';')[0]) {\n            case 'application/x-www-form-urlencoded':\n              q = querystring.parse(data);\n              break;\n            case 'text/plain':\n            case '':\n              q = data;\n              break;\n            default:\n              _this.log('error', \"Unsupported content-type \" + req.headers['content-type']);\n              q = void 0;\n          }\n          return next_filter(q);\n        };\n      })(this));\n      throw {\n        status: 0\n      };\n    };\n\n    GenericApp.prototype.expect_xhr = function(req, res, _data, next_filter) {\n      var data;\n      data = new Buffer(0);\n      req.on('data', (function(_this) {\n        return function(d) {\n          return data = utils.buffer_concat(data, new Buffer(d, 'binary'));\n        };\n      })(this));\n      req.on('end', (function(_this) {\n        return function() {\n          var q;\n          data = data.toString('utf-8');\n          switch ((req.headers['content-type'] || '').split(';')[0]) {\n            case 'text/plain':\n            case 'T':\n            case 'application/json':\n            case 'application/xml':\n            case '':\n            case 'text/xml':\n              q = data;\n              break;\n            default:\n              _this.log('error', 'Unsupported content-type ' + req.headers['content-type']);\n              q = void 0;\n          }\n          return next_filter(q);\n        };\n      })(this));\n      throw {\n        status: 0\n      };\n    };\n\n    return GenericApp;\n\n  })();\n\n}).call(this);\n"]},"metadata":{},"sourceType":"script"}